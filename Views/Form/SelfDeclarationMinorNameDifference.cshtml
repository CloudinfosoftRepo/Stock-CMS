<html lang="en" ng-app="Stock-CMS">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Self-declaration for minor difference in name</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        h1 {
            color: black;
            font-family: "Bookman Old Style", serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 11.5pt;
        }

        .s1 {
            color: black;
            font-family: "Times New Roman", serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 11pt;
        }

        h2 {
            color: black;
            font-family: "Times New Roman", serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 11pt;
        }

        p {
            color: black;
            font-family: "Bookman Old Style", serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 12pt;
            margin: 0pt;
        }

        .s4 {
            color: black;
            font-family: "Bookman Old Style", serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 8pt;
            vertical-align: 4pt;
        }

        .s5 {
            color: black;
            font-family: "Times New Roman", serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 7pt;
            vertical-align: 3pt;
        }

        li {
            display: block;
        }

        #l1 {
            padding-left: 0pt;
            counter-reset: c1 1;
        }

            #l1 > li > *:first-child:before {
                counter-increment: c1;
                content: counter(c1, decimal) ". ";
                color: black;
                font-family: "Bookman Old Style", serif;
                font-style: normal;
                font-weight: normal;
                text-decoration: none;
                font-size: 12pt;
            }

            #l1 > li:first-child > *:first-child:before {
                counter-increment: c1 0;
            }
    </style>
</head>
<body style="padding: 5% 5% 0 5% ;" ng-controller="FormController">
    <div class="row align-items-center">
        <!-- Arrow Icon aligned to the left -->
        <a class="col-md-1 text-start" style="font-size:35px;" ng-click="navtogenerateform()">
            <i class="bi bi-arrow-left"></i>
        </a>

        <!-- Centered Heading -->
        <div class="col-md-10 text-center">
            <h3>Self-declaration for minor difference in name</h3>
        </div>
    </div>
    <div ng-if="hDiv">
        <form name="gForm" ng-submit="genrateForm()">
            <div class="row">
                @* <div class="col-md-4"> *@
                <div class="form-group mb-3 ">
                        <label for="seletedid" class="form-label">select customer</label>
                        <select class="form-select w-auto" ng-options="f.id as f.name for f in docs" ng-model="seletedid" ng-change="loadCustomers(seletedid)">
                            <option selected disabled value="">Select customer</option>
                        </select>
                    </div>
                <div class="form-group mb-3 col-md-4">
                        <label for="nameasperCertificate" class="form-label">Name as per Certificate</label>
                        <input type="text" ng-model="data.nameasperCertificate" class="form-control search-orders" placeholder="Name as per Certificate">
                    </div>
                </div>
                <div class="text-center m-2 col-md-4">
                    <button type="submit" class="btn" style="background-color:#003980; color:white;">
                        Genrate Form
                    </button>
                </div>
            @* </div> *@
        </form>
    </div>
    <div id="printForm">
    <h1 style="
        padding-top: 1pt;
        padding-left: 38pt;
        text-indent: 0pt;
        text-align: left;
      ">
        Self-declaration for minor difference in name (not for change of name)
    </h1>
    <p style="padding-top: 1pt; text-indent: 0pt; text-align: left"><br /></p>
    <p class="s1" style="padding-left: 5pt; text-indent: 0pt; text-align: left">
            To<br />
            {{data.officename}},<br />
            {{data.officeaddress}}
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>

        <h3 style="
        padding-top: 12pt;
        padding-left: 12pt;
        text-indent: 0pt;
        text-align: left;
font-size:medium;
      ">
            Name of Company:{{data.officename}},
        </h3>
        <h3 style="padding:0 350px 0 12pt; text-indent: 0pt; text-align: left;font-size:medium;">
            
        </h3>
    <p style="padding-top: 2pt; text-indent: 0pt; text-align: left"><br /></p>
    <h2 style="padding-left: 6pt; text-indent: 0pt; text-align: left">
        Folio Number :
        <u>
                {{data.folioNo}}
        </u>
    </h2>
    <p style="padding-top: 2pt; text-indent: 0pt; text-align: left"><br /></p>
    <h2 style="padding-left: 5pt; text-indent: 0pt; text-align: left">
        Number of shares :
        <u>{{data.qty}}</u>
    </h2>
    <p style="padding-top: 7pt; text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 6pt; text-indent: 0pt;line-height: 2; text-align: justify">
        I/We<u>{{data.customerName}}</u>And<u>{{data.holders}} </u> Indian
        inhabitant, residing at<u>{{data.address}}</u> do hereby solemnly affirm and say that:
    </p>

    <p style="padding-top: 8pt; text-indent: 0pt; text-align: left;"><br /></p>
    <ol id="l1">
        <li data-list-text="1.">
            <p style="
            padding-left: 42pt;
            text-indent: -18pt;
            line-height: 138%;
            text-align: left;
            line-height: 1.8;
          ">
                Above mentioned shares/deb/bonds/unit were acquired by me/us for
                valuable consideration out of my/our own investment / funds.
            </p>
        </li>
        <li data-list-text="2.">
            <p style="
            padding-top: 1pt;
            padding-left: 41pt;
            text-indent: -18pt;
            text-align: left;
            line-height: 1.8;
          ">
                As per PAN / Demat account Name of sole/1<span class="s4">st</span>/2<span class="s4">nd</span> holder is <u>{{data.customerName}}</u>.
            </p>

        </li>
        <li data-list-text="3.">
            <p style="
            padding-top: 6pt;
            padding-left: 41pt;
            text-indent: -18pt;
            text-align: left;
            line-height: 1.8;
          ">
                    As per share certificate Name of sole/1<span class="s4">st</span>/2<span class="s4">nd</span> holder is <u>{{data.nameasperCertificate}}</u>which is incorrect.
            </p>
        </li>
        <li data-list-text="4.">
            <p style="
            padding-top: 6pt;
            padding-left: 42pt;
            text-indent: -18pt;
            line-height: 138%;
            text-align: left;
            line-height: 1.8;
          ">
                Name on Share certificate(s)/PAN/Client master list as mentioned above
                is one and the same person.
            </p>
        </li>
    </ol>
    <p style="padding-top: 6pt; text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-top: 6pt; text-indent: 0pt; text-align: left"><br /></p>
    <h2 style="padding-left: 5pt; text-indent: 0pt; text-align: left">
        Sole/1<span class="s5">st</span> holder
    </h2>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <h2 style="padding-left: 6pt; text-indent: 0pt; text-align: left">
        Signature Date
    </h2>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p class="s1" style="padding-left: 5pt; text-indent: 0pt; text-align: left">
        Note: Name of shareholder(s) should be as per PAN and Client Master list.
    </p>
     </div>
    <button class="btn btn-store" ng-click="printDiv('printForm')">Print</button>
</body>

<script>
    angular.module('Stock-CMS', []).controller('FormController', function ($scope, $http,$timeout) {
        $scope.customers = [];
                     $scope.hDiv = true;
            var params = new URLSearchParams(window.location.search);
            var id = params.get('id');
            var id2 = params.get('id2');
        var isProcessing = false;

        // showLoader();

         // Load Customers
         $scope.loadCustomers = function (sid) {
         if(id){
             var docid = $scope.seletedid == undefined ? 0 : $scope.seletedid;
             var currentDate = new Date();
         var monthsOfYear = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
             $scope.hDiv = true;
        $http.get('/Enquiry/GetStocksById/'+id).then(function (response) {
            var result = response.data;
             let holders = [
                        result.firstHolder || '',
                        result.secondHolder || '',
                        result.thirdHolder || ''
                    ].filter(holder => holder.trim() !== '');
            $http.get('/doc/getDocs/' +  result.customer.id).then(function (response) {
                 $scope.docs = response.data;
                var doc = $scope.docs.find(x => x.id === sid);
            $scope.data = {
               customerName : doc.name,
               qty:result.qty,
               folioNo : result.folioNo,
               address : doc.addressAsPerAadhar,
               officename : result.companyName,
               officeaddress: '1101, Crescenzo, G-Block, Opp. MCA Club, Bandra-Kurla Complex, Bandra (East), Mumbai, Maharashtra, 400051',
               date:new Date(),
               nameasperCertificate:'',
                holders : holders.length > 0 ? `${holders.join(') (')}` : ''
            };

            hideLoader();
            }, function (error) {
                console.error('Error loading Docs:', error);
                hideLoader();
            });
        }, function (error) {
            console.error('Error loading customers:', error);
            hideLoader();
        });
        }

        if(id2){
             $scope.hDiv = false;
        $http.get('/Form/GetGenratedFormById/'+id2).then(function (response) {
            var result = response.data;
            var obj = JSON.parse(result.jsonString);
            $scope.data = {
                customerName: obj.customerName,
                folioNo : obj.folioNo,
                qty : obj.qty,
                address:obj.address,
                officename: obj.officename,
                officeaddress: obj.officeaddress,
                clientid:obj.clientid,
                date:new Date(obj.date),
                holders: obj.holders,
                nameasperCertificate: obj.nameasperCertificate,

            };
                            id = result.stockId;

            checkData();
            hideLoader();
        }, function (error) {
            console.error('Error loading customers:', error);
            hideLoader();
        });
        }
    };

                    function checkData() {
        if ($scope.data !== undefined) {
            // Delay the printDiv execution until the next digest cycle
            $timeout(function() {
                $scope.printDiv('printForm');
            }, 0);  // 0 delay to ensure it runs after the view update
        } else {
            setTimeout(checkData, 1000); // Retry after 1000ms if data is not yet available
        }
    }

        $scope.navtogenerateform = function () {
        window.open('/Form/GenerateForm/'+id, '_self');
    };

    //Genrate Form
     $scope.genrateForm = function () {
         if(id){
         let jsonString = JSON.stringify($scope.data, null, 2);
         var data ={
             formName : 'SelfDeclaration Minor Name Difference',
             StockId : id,
             url : `/Form/SelfDeclarationMinorNameDifference?id2=`,
             jsonString : jsonString,
             ClientName: $scope.data.customerName,
             IsActive : true
         }

         const url = '/Form/GenrateForm';
            $http.post(url, data).then(function (response) {
                if (response.data.success) {
                    Swal.fire({
                        title: 'Success',
                        text: response.data.message || 'Operation successful!',
                        icon: 'success',
                        confirmButtonText: 'OK'
                    });
                    // $scope.loadCustomers();
                                            window.open(response.data.data.url + response.data.data.id,'_self')

                } else {
                    Swal.fire({
                        title: 'Error!',
                        text: response.data.message || 'There was an issue adding the customer.',
                        icon: 'error',
                        confirmButtonText: 'Try Again'
                    });
                }
                isProcessing = false;
            }, function (error) {
                Swal.fire({
                    title: 'Error',
                    text: 'An error occurred.',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
                isProcessing = false;
            });
        //console.log(dataString);
        }
     }

        // Load Customers
        // $scope.loadCustomers = function () {
        //     $http.get('/Master/GetCustomers').then(function (response) {
        //         $scope.customers = response.data[0];
        //         hideLoader();
        //     }, function (error) {
        //         console.error('Error loading customers:', error);
        //         hideLoader();
        //     });
        // };

        // $scope.loadDocs = function () {
        //     if (true) {
        //         $http.get('/doc/getDocs/' + 1).then(function (response) {
        //             $scope.docs = response.data;
        //             hideLoader();
        //         }, function (error) {
        //             console.error('Error loading Docs:', error);
        //             hideLoader();
        //         });
        //     }
        // };

        //Function
        $scope.printDiv = function (divId) {
                var css ='<style type="text/css"> * { margin: 0; padding: 0; text-indent: 0; } h1 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 22pt; } .h2, h2 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; } .s1 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 16pt; } .s2 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; } .s3 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 11pt; } .s4 { color: black; font-family: Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; } .s5 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 14pt; } .s6 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; } .s7 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12px; } h3 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: underline; font-size: 11pt; } p { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; margin: 0pt; } .s8 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; } .s9 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: underline; font-size: 12pt; } .s10 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: underline; font-size: 11pt; } .s11 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; } .s12 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; } .s13 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; } table, tbody { vertical-align: top; overflow: visible; }</style>';
            var innerContents = document.getElementById(divId).innerHTML;
            var popupWinindow = window.open('', '_blank', 'width=600,height=700,scrollbars=no,menubar=no,toolbar=no,location=no,status=no,titlebar=no');
            popupWinindow.document.open();
            popupWinindow.document.write('<html><head><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">' + css + '</ head > <body style="padding: 0 5% 0 5%;"onload="window.print()">' + innerContents + '</html>');
            popupWinindow.document.close();
        };
        //Initialize
        $scope.loadCustomers();
        // $scope.loadDocs();
    });
</script>
</html>
