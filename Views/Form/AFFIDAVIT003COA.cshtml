<html lang="en" ng-app="Stock-CMS">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>AFFIDAVIT (003) COA New</title>
    <style type="text/css">
        * {
          margin: 0;
          padding: 0;
          text-indent: 0;
        }
        .p,
        p {
          color: black;
          font-family: Calibri, sans-serif;
          font-style: normal;
          font-weight: normal;
          text-decoration: none;
          font-size: 11pt;
          margin: 0pt;
        }
        .s1 {
          color: black;
          font-family: Calibri, sans-serif;
          font-style: normal;
          font-weight: normal;
          text-decoration: none;
          font-size: 11pt;
        }
        .s2 {
          color: #f00;
          font-family: Calibri, sans-serif;
          font-style: normal;
          font-weight: normal;
          text-decoration: none;
          font-size: 11pt;
        }
        .s3 {
          color: black;
          font-family: Calibri, sans-serif;
          font-style: normal;
          font-weight: normal;
          text-decoration: underline;
          font-size: 11pt;
        }
        li {
          display: block;
        }
        #l1 {
          padding-left: 0pt;
          counter-reset: c1 1;
        }
        #l1 > li > *:first-child:before {
          counter-increment: c1;
          content: counter(c1, decimal) ". ";
          color: black;
          font-family: Calibri, sans-serif;
          font-style: normal;
          font-weight: normal;
          text-decoration: none;
          font-size: 11pt;
        }
        #l1 > li:first-child > *:first-child:before {
          counter-increment: c1 0;
        }
    </style>
</head>
<body style="padding-left: 10%;" ng-controller="FormsController">
    <div class="row align-items-center">
        <!-- Arrow Icon aligned to the left -->
        <a class="col-md-1 text-start" style="font-size:35px;" ng-click="navtogenerateform()">
            <i class="bi bi-arrow-left"></i>
        </a>

        <!-- Centered Heading -->
        <div class="col-md-10 text-center">
            <h3>AFFIDAVIT (003) COA New</h3>
        </div>
    </div>

     <div ng-if="hDiv">
        <form name="gForm" ng-submit="genrateForm()">
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group mb-3">
                        <label for="seletedId" class="form-label">select customer</label>
                        <select class="form-select w-auto" ng-options="f.id as f.name for f in doc" ng-model="seletedId" ng-change="loadCustomers(seletedId)">
                            <option selected disabled value="">Select customer</option>
                        </select>
                    </div>
                </div>
                <div class="text-center m-2 col-md-4">
                    <button type="submit" class="btn" style="background-color:#003980; color:white;">
                        Genrate Form
                    </button>
                </div>
            </div>
        </form>
    </div>
    <div id="printForm">
    <p style="padding-top: 2pt; text-indent: 0pt; text-align: center">
        AFFIDAVIT
    </p>
    <p style="padding-top: 9pt; text-indent: 0pt; text-align: center">
        FOR CHANGE OF ADDRESS
    </p>
    <p style="
        padding-top: 9pt;
        padding-left: 25pt;
        text-indent: 0pt;
        text-align: justify;
      ">
            <span class="p">I, {{data.customerName}} {{data.relationship}} </span><span class="s1" style="background-color: #ff0">Shri </span><span class="p">{{data.sonof}} aged {{data.age}} years, correspondence address</span> {{data.address}}<span style="color: #000">
                , solemnly affirm and declare in favour of the Company M/s Chambal
                Fertilisers and Chemical Limited.
            </span>
    </p>
@*     <p class="s2"
       style="
        padding-top: 1pt;
        padding-left: 5pt;
        text-indent: 0pt;
        line-height: 108%;
        text-align: justify;
      ">
       
    </p> *@
    <ol id="l1">
        <li data-list-text="1.">
            <p style="
            padding-top: 7pt;
            padding-left: 41pt;
            text-indent: -18pt;
            line-height: 108%;
            text-align: justify;
          ">
                    I {{data.customerName}}, am the sole shareholder of equity shares in Chambal
                    Fertilisers and Chemicals Limited under Folio no.{{data.folioNo}} (if shares hold in
                physical folio) / DPID &amp; Client Id {{data.dpid}}, {{data.clientid}} (if shares hold
                in demat account).
            </p>
            <p style="padding-top: 1pt; text-indent: 0pt; text-align: left">
                <br />
            </p>
        </li>
        <li data-list-text="2.">
            <p style="
            padding-left: 41pt;
            text-indent: -18pt;
            line-height: 108%;
            text-align: justify;
          ">
                That I am residing at the above address have changed my addresses in
                    past {{data.yearssinceaddresschange}} years, I was having following address , as my old address :
            </p>
            <p style="padding-top: 1pt; text-indent: 0pt; text-align: left">
                <br />
            </p>
            <p style="
            padding-left: 41pt;
            text-indent: 0pt;
            line-height: 108%;
            text-align: left;
          ">
                    Address in Client Master List : {{data.address}} <br />
                    Address in Aadhaar Card : {{data.aadharaddress}}<br />
                    Address in Voter id : {{data.voteraddress}}<br />
                    Address in Records of the Company{{data.address}}
            </p>
            <p style="
            padding-left: 41pt;
            text-indent: 0pt;
            line-height: 13pt;
            text-align: left;
          ">
                
            </p>
            <p style="padding-top: 2pt; text-indent: 0pt; text-align: left">
                <br />
            </p>
        </li>
        <li data-list-text="3.">
            <p style="
            padding-left: 41pt;
            text-indent: -18pt;
            line-height: 108%;
            text-align: left;
          ">
                That my old / new addresses also appearing in the Aadhaar card &amp;
                Client Master List/ voter id.
            </p>
        </li>
        <li data-list-text="4.">
            <p style="
            padding-left: 40pt;
            text-indent: -17pt;
            line-height: 13pt;
            text-align: left;
          ">
                That the above shares were acquired by me out of my own investment
                funds.
            </p>
        </li>
        <li data-list-text="5.">
            <p style="
            padding-top: 1pt;
            padding-left: 40pt;
            text-indent: -17pt;
            text-align: left;
          ">
                I further confirm having my new address given above duly signed by me
                on this affidavit.
            </p>
        </li>
    </ol>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 406pt; text-indent: 0pt; text-align: left">
        DEPONENT
    </p>
    <p class="s3"
       style="padding-top: 9pt; text-indent: 0pt; text-align: center">
        VERIFICATION
    </p>
    <p style="
        padding-top: 9pt;
        padding-left: 5pt;
        text-indent: 0pt;
        line-height: 108%;
        text-align: justify;
      ">
        I solemnly affirm that the statement contained in the above paragraph is
        true to the best of my knowledge, information and belief and that nothing
        material has been concealed from being disclosed.
    </p>
    <p style="
        padding-top: 7pt;
        padding-left: 5pt;
        text-indent: 0pt;
        text-align: justify;
      ">
        I am executing this declaration to be submitted to the concerned
        authorities for change of address.
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="
        padding-left: 5pt;
        text-indent: 0pt;
        line-height: 167%;
        text-align: left;
      ">
        Solemnly declared and affirmed on identification at New Delhi on this
           <u> &emsp;&emsp;</u>, {{data.month}} day of {{data.year}}
    </p>
    <p style="padding-top: 9pt; text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 406pt; text-indent: 0pt; text-align: left">
        DEPONENT
    </p>
    </div>
    <button class="btn btn-store" ng-click="printDiv('printForm')">Print</button>
</body>

<script>
    angular.module('Stock-CMS', []).controller('FormsController', function ($scope, $http, $timeout) {
        // $scope.customers = [];
         $scope.data = undefined;
            $scope.hDiv = true;
            var params = new URLSearchParams(window.location.search);
            var id = params.get('id');
            var id2 = params.get('id2');
        var isProcessing = false;

        // showLoader();

        // Load Customers
        // $scope.loadCustomers = function () {
        //     $http.get('/Master/GetCustomers').then(function (response) {
        //         $scope.customers = response.data[0];
        //         hideLoader();
        //     }, function (error) {
        //         console.error('Error loading customers:', error);
        //         hideLoader();
        //     });
        // };

        // $scope.loadDocs = function () {
        //     if (true) {
        //         $http.get('/doc/getDocs/' + 1).then(function (response) {
        //             $scope.docs = response.data;
        //             hideLoader();
        //         }, function (error) {
        //             console.error('Error loading Docs:', error);
        //             hideLoader();
        //         });
        //     }
        // };

                // Load Customers

        $scope.loadCustomers = function (sid) {
            
             if(id){
                 var currentDate = new Date();
             var monthsOfYear = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                 $scope.hDiv = true;
            $http.get('/Enquiry/GetStocksById/'+id).then(function (response) {
                var result = response.data;
                 $http.get('/doc/getDocs/' + result.customer.id).then(function (response) {
                    $scope.doc = response.data;
                    var docs = $scope.doc.find(x => x.id === sid);
                    var Age = $scope.calculateAge(docs.dob);
                    

                $scope.data = {
                   customerName : docs.name,
                   age : Age,
                   relationship: docs.relationship,
                   sonof: docs.relativesName,
                   yearssinceaddresschange: 2,
                   folioNo : result.folioNo,
                   address : docs.addressAsPerAadhar,
                   aadharaddress: docs.addressAsPerAadhar,
                   voteraddress: docs.addressAsPerVoterId,
                   dpid: docs.dpid,
                   clientid: docs.clientId,
                   day: currentDate.getDate(),
                   month: monthsOfYear[currentDate.getMonth()],
                   year: currentDate.getFullYear()
                };

                hideLoader();
                }, function (error) {
                    console.error('Error loading Docs:', error);
                    hideLoader();
                });
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }

            if(id2){
                 $scope.hDiv = false;
            $http.get('/Form/GetGenratedFormById/'+id2).then(function (response) {
                var result = response.data;
                var obj = JSON.parse(result.jsonString);
                $scope.data = {
                    customerName: obj.customerName,
                    age:obj.age,
                    relationship: obj.relationship,
                    sonof:obj.sonof,
                    yearssinceaddresschange:obj.yearssinceaddresschange,
                    folioNo:obj.folioNo,
                    address:obj.address,
                    aadharaddress: obj.aadharaddress,
                    dpid:obj.dpid,
                    clientid:obj.clientid,
                    day:obj.day,
                    month:obj.month,
                    year: obj.year
                };
                id = result.stockId;
               checkData();
                hideLoader();
                    

            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }
        };

                function checkData() {
        if ($scope.data !== undefined) {
            // Delay the printDiv execution until the next digest cycle
            $timeout(function() {
                $scope.printDiv('printForm');
            }, 0);  // 0 delay to ensure it runs after the view update
        } else {
            setTimeout(checkData, 1000); // Retry after 1000ms if data is not yet available
        }
    }

          $scope.calculateAge = function(dob) {
      if (!dob) {
        return '';
      }
      var birthDate = new Date(dob);
      var currentDate = new Date();
      var age = currentDate.getFullYear() - birthDate.getFullYear();
      var m = currentDate.getMonth() - birthDate.getMonth();

      // Adjust age if the current month is before the birth month or if the birth day hasn't occurred yet
      if (m < 0 || (m === 0 && currentDate.getDate() < birthDate.getDate())) {
        age--;
      }
      return age;
    };

        //Genrate Form
         $scope.genrateForm = function () {
             if(id){
             let jsonString = JSON.stringify($scope.data, null, 2);
             var data ={
                 formName : 'AFFIDAVIT 003 COA',
                 StockId : id,
                 url : `/Form/AFFIDAVIT003COA?id2=`,
                 jsonString : jsonString,
                 IsActive : true,
                 ClientName: $scope.data.customerName,
             }

             const url = '/Form/GenrateForm';
                $http.post(url, data).then(function (response) {
                    if (response.data.success) {
                        Swal.fire({
                            title: 'Success',
                            text: response.data.message || 'Operation successful!',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        });
                        // $scope.loadCustomers();
                        window.open(response.data.data.url + response.data.data.id,'_self')
                    } else {
                        Swal.fire({
                            title: 'Error!',
                            text: response.data.message || 'There was an issue adding the customer.',
                            icon: 'error',
                            confirmButtonText: 'Try Again'
                        });
                    }
                    isProcessing = false;
                }, function (error) {
                    Swal.fire({
                        title: 'Error',
                        text: 'An error occurred.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                    isProcessing = false;
                });
            //console.log(dataString);
            }
         }

    $scope.navtogenerateform = function () {
        window.open('/Form/GenerateForm/'+id, '_self');
    };

        //Function
        $scope.printDiv = function (divId) {
            var innerContents = document.getElementById(divId).innerHTML;
            var popupWinindow = window.open('', '_blank', 'width=600,height=700,scrollbars=no,menubar=no,toolbar=no,location=no,status=no,titlebar=no');
            popupWinindow.document.open();
            popupWinindow.document.write('<html><head><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"><style type="text/css"> * { margin: 0; padding: 0; text-indent: 0; } .p, p { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; margin: 0pt; } .s1 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; } .s2 { color: #f00; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; } .s3 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 11pt; } li { display: block; } #l1 { padding-left: 0pt; counter-reset: c1 1; } #l1 > li > *:first-child:before { counter-increment: c1; content: counter(c1, decimal) ". "; color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; } #l1 > li:first-child > *:first-child:before { counter-increment: c1 0; } </style></head><body onload="window.print()">' + innerContents + '</html>');
            popupWinindow.document.close();
        };
        //Initialize
        $scope.loadCustomers(null);
        // $scope.loadDocs();
    });
</script>

</html>
