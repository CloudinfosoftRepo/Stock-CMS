<html lang="en" ng-app="Stock-CMS">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>AFFIDAVIT - change of address</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        p {
            color: black;
            font-family: Calibri, sans-serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 12pt;
            margin: 0pt;
        }

        h2 {
            color: black;
            font-family: Calibri, sans-serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 11pt;
        }

        .s1 {
            color: black;
            font-family: Calibri, sans-serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 12pt;
        }

        .s2 {
            color: black;
            font-family: Calibri, sans-serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 12pt;
        }

        .s3 {
            color: black;
            font-family: Cambria, serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 12pt;
        }

        .s4 {
            color: black;
            font-family: Cambria, serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 11pt;
        }

        .s5 {
            color: black;
            font-family: Calibri, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 12pt;
        }

        table,
        tbody {
            vertical-align: top;
            overflow: visible;
        }
    </style>
</head>
<body style="padding-left: 10%;" ng-controller="FormController">
    <div ng-if="hDiv">
        <form name="gForm" ng-submit="genrateForm()">
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group mb-3">
                        <label for="address" class="form-label">Address</label>
                        <textarea id="address" ng-model="data.newAddress"
                                  class="form-control" style="height: 100px; width: 100%;" placeholder="Old Address" rows="5" cols="5" required></textarea>
                    </div>
                </div>
                <div class="text-center m-2 col-md-4">
                    <button type="submit" class="btn" style="background-color:#003980; color:white;">
                        Genrate Form
                    </button>
                </div>
            </div>

        </form>
    </div>
    <hr />
    <div id="printForm">
        <p style="padding-top: 1pt; text-indent: 0pt; text-align: center">
            AFFIDAVIT (FOR CHANGE OF ADDRESS)
        </p>
        <p style="padding-top: 12pt; text-indent: 0pt; text-align: center">
            (TO BE EXECUTED ON NON JUDICIAL STAMP PAPER FOR Rs. 50/-)
        </p>
        <h2 style="
        padding-top: 12pt;
        padding-left: 12pt;
        text-indent: 0pt;
        text-align: left;
      ">
            TO,
        </h2>
        <h2 style="
        padding-top: 12pt;
        padding-left: 12pt;
        text-indent: 0pt;
        text-align: left;
      ">
            Unit: <span class="s1">{{data.companyName}}</span>
        </h2>
        <h2 style="
        padding-top: 12pt;
        padding-left: 12pt;
        text-indent: 0pt;
        text-align: left;
      ">
            DEAR SIR,
        </h2>
        <p style="
        padding-top: 12pt;
        padding-left: 12pt;
        text-indent: 0pt;
        line-height: 114%;
        text-align: left;
      ">
            I/We hereby request you to please update my/our change in address in your
            records for the Registered
        </p>
        <p style="
        padding-top: 10pt;
        padding-left: 12pt;
        text-indent: 0pt;
        text-align: left;
      ">
            Folio No.
            <u>
                {{data.folioNo}}
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            </u>
        </p>
        <p style="
        padding-top: 12pt;
        padding-left: 12pt;
        text-indent: 0pt;
        text-align: left;
      ">
            Tel/ Mobile no:
            <u>
                {{data.mobile}}

            </u>
        </p>
        <p style="text-indent: 0pt; text-align: left"><br /></p>
        <table style="border-collapse: collapse; margin-left: 6.5pt"
               cellspacing="0">
            <tr style="height: 14pt">
                <td style="
            width: 231pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          ">
                    <p class="s2"
                       style="
              padding-left: 1pt;
              text-indent: 0pt;
              line-height: 13pt;
              text-align: center;
            ">
                        Old Address
                    </p>
                </td>
                <td style="
            width: 231pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          ">
                    <p class="s2"
                       style="
              padding-left: 1pt;
              text-indent: 0pt;
              line-height: 13pt;
              text-align: center;
            ">
                        New Address
                    </p>
                </td>
            </tr>
            <tr style="height: 16pt">
                <td style="
            width: 231pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
border-bottom-width: 1pt;
            border-left-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          ">
                    <p class="s2"
                       style="
              padding-left: 5pt;
              text-indent: 0pt;
              line-height: 14pt;
              text-align: left;
            ">
                        {{data.newAddress}}
                    </p>
                </td>
                <td style="
            width: 231pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
border-bottom-width: 1pt;
            border-left-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          ">
                    <p class="s2"
                       style="
              padding-left: 5pt;
              text-indent: 0pt;
              line-height: 14pt;
              text-align: left;
            ">
                        {{data.address}}
                    </p>
                </td>
            </tr>


        </table>
        <p style="padding-top: 12pt; text-indent: 0pt; text-align: left"><br /></p>
        <p style="padding-left: 12pt; text-indent: 0pt; text-align: left">
            Yours faithfully
        </p>
        <p style="text-indent: 0pt; text-align: left"><br /></p>
        <p style="padding-left: 12pt; text-indent: 0pt; text-align: left">
            {{data.holders}}
        </p>
        <p style="
        padding-top: 2pt;
        padding-left: 12pt;
        text-indent: 0pt;
        line-height: 183%;
        text-align: left;
      ">
            Signature of the First and Jt. Holder(s)
        </p>
        <p class="s5"
           style="padding-left: 12pt; text-indent: 0pt; text-align: left">
            As per specimen Registered)Executed before me
            <u>&nbsp;..........................................................................</u>
        </p>
        <p style="text-indent: 0pt; text-align: left"><br /></p>
        <p class="s5" style="text-indent: 0pt; text-align: center">
            (Should be attested by Notary)
        </p>
    </div>
    <button class="btn btn-store" ng-click="printDiv('printForm')">Print</button>
</body>

<script>
    angular.module('Stock-CMS', []).controller('FormController', function ($scope, $http) {
            $scope.data = undefined;
            $scope.hDiv = true;
            var params = new URLSearchParams(window.location.search);
            var id = params.get('id');
            var id2 = params.get('id2');
            var isProcessing = false;

        // showLoader();

        // Load Customers

        $scope.loadCustomers = function () {
             if(id){
                 $scope.hDiv = true;
            $http.get('/Enquiry/GetStocksById/'+id).then(function (response) {
                var result = response.data;
                       let holders = [
                        result.firstHolder || '',
                        result.secondHolder || '',
                        result.thirdHolder || ''
                    ].filter(holder => holder.trim() !== '');
                $scope.data = {
                   companyName : result.companyName,
                   mobile : result.customer.mobile,
                   folioNo : result.folioNo,
                   address : result.customer.address,
                   newAddress : '',
                   holders : holders.length > 0 ? `(${holders.join(') (')})` : ''
                };

                hideLoader();
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }

            if(id2){
                 $scope.hDiv = false;
            $http.get('/Form/GetGenratedFormById/'+id2).then(function (response) {
                var result = response.data;
                var obj = JSON.parse(result.jsonString);
                $scope.data = {
                   companyName : obj.companyName,
                   mobile : obj.mobile,
                   folioNo : obj.folioNo,
                   address : obj.address,
                   newAddress : obj.newAddress,
                   holders : obj.holders
                };
                hideLoader();
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }
        };

        //Genrate Form
         $scope.genrateForm = function () {
             if(id){
             let jsonString = JSON.stringify($scope.data, null, 2);
             var data ={
                 formName : 'ChangeOfAddress',
                 StockId : id,
                 url : `/Form/ChangeOfAddress?id2=`,
                 jsonString : jsonString,
                 IsActive : true
             }

             const url = '/Form/GenrateForm';
                $http.post(url, data).then(function (response) {
                    if (response.data.success) {
                        Swal.fire({
                            title: 'Success',
                            text: response.data.message || 'Operation successful!',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        });
                        $scope.loadCustomers();
                    } else {
                        Swal.fire({
                            title: 'Error!',
                            text: response.data.message || 'There was an issue adding the customer.',
                            icon: 'error',
                            confirmButtonText: 'Try Again'
                        });
                    }
                    isProcessing = false;
                }, function (error) {
                    Swal.fire({
                        title: 'Error',
                        text: 'An error occurred.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                    isProcessing = false;
                });
            //console.log(dataString);
            }
         }

        //Function
        $scope.printDiv = function (divId) {
            var css = '<style type="text/css">* { margin: 0; padding: 0; text-indent: 0; } p { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; margin: 0pt; } h2 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; } .s1 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; } .s2 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; } .s3 { color: black; font-family: Cambria, serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; } .s4 { color: black; font-family: Cambria, serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; } .s5 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; } table, tbody { vertical-align: top; overflow: visible; }</style >  ';
            var innerContents = document.getElementById(divId).innerHTML;
            var popupWinindow = window.open('', '_blank', 'width=600,height=700,scrollbars=no,menubar=no,toolbar=no,location=no,status=no,titlebar=no');
            popupWinindow.document.open();
            popupWinindow.document.write('<html><head><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">' + css + '</head > <body style="padding-left: 10%;" onload="window.print()">' + innerContents + '</html>');
            popupWinindow.document.close();
        };
        //Initialize
        $scope.loadCustomers();
    });
</script>
</html>
