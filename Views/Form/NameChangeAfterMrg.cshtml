<html lang="en" ng-app="Stock-CMS">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Name Change After Mrg</title>
    <style type="text/css">
      * {
        margin: 0;
        padding: 0;
        text-indent: 0;
      }
      h1 {
        color: black;
        font-family: Calibri, sans-serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: none;
        font-size: 18pt;
      }
      .s1 {
        color: black;
        font-family: Calibri, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 14pt;
      }
      h3 {
        color: black;
        font-family: Calibri, sans-serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: none;
        font-size: 11pt;
      }
      .s2 {
        color: black;
        font-family: "Times New Roman", serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: underline;
        font-size: 11pt;
      }
      .s3 {
        color: black;
        font-family: "Times New Roman", serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 11pt;
      }
      .s4 {
        color: black;
        font-family: Calibri, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 12pt;
      }
      p {
        color: black;
        font-family: Calibri, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 11pt;
        margin: 0pt;
      }
      .s5 {
        color: black;
        font-family: Calibri, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 12pt;
      }
      .s6 {
        color: black;
        font-family: Arial, sans-serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: underline;
        font-size: 11pt;
      }
      .s7 {
        color: #212121;
        font-family: Arial, sans-serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: none;
        font-size: 11pt;
      }
      .s8 {
        color: black;
        font-family: Calibri, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 12pt;
      }
      h2 {
        color: black;
        font-family: "Times New Roman", serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: none;
        font-size: 12pt;
      }
      table,
      tbody {
        vertical-align: top;
        overflow: visible;
      }

        .card {
            border-radius: 10px;
            overflow: hidden;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .form-select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 1rem;
        }

        .btn-primary {
            width: 100%;
            padding: 12px 16px;
            text-transform: uppercase;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

            .btn-primary:hover {
                background-color: #0056b3;
                transform: scale(1.05);
            }

        .mybtn {
            background-color: #51b37f !important;
            color: white !important;
            width: auto !important;
        }

        .myarea {
            justify-content: center !important;
            display: flex !important;
            margin-top: 25px !important;
        }
    </style>
  </head>

      <body style="padding: 5%;" ng-controller="FormController">
    <div class="row align-items-center">
        <!-- Arrow Icon aligned to the left -->
        <a class="col-md-1 text-start" style="font-size:35px;" ng-click="navtogenerateform()">
            <i class="bi bi-arrow-left"></i>
        </a>

        <!-- Centered Heading -->
        <div class="col-md-10 text-center">
            <h3>Name Change After Mrg</h3>
        </div>
    </div>
    <div ng-if="hDiv" class="container my-5">
        <div class="card shadow-sm">
            <div class="card-body">
                <form name="gForm" ng-submit="genrateForm()">
                    <h4 class="card-title text-center mb-4" style="color:#51b37f;">Generate Form</h4>

                    <div class="row">
                        <!-- Select Customer Dropdown -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="seletedId" class="form-label">Select Customer</label>
                                <select class="form-select" id="seletedId" ng-options="f.id as f.name for f in docs" ng-model="seletedId" ng-change="loadCustomers(seletedId, heirId)">
                                    <option selected disabled value="">Select customer</option>
                                </select>
                            </div>
                        </div>

                        <!-- Select Heir Dropdown -->
                        <div class="col-md-4 mb-3" ng-show="legalheirlist">
                            <div class="form-group">
                                <label for="heirId" class="form-label">Select Heir</label>
                                <select class="form-select" id="heirId" ng-options="g.id as g.name for g in heir" ng-model="heirId" ng-change="loadCustomers(seletedId, heirId)">
                                    <option selected disabled value="">Select Heir</option>
                                </select>
                            </div>
                        </div>

                        <!-- Old Name -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="newName" class="form-label">Old Name</label>
                                <input type="text" ng-model="data.newName" class="form-control" placeholder="Old Name">
                            </div>
                        </div>
                    </div>
                    <!-- Submit Button -->
                    <div class="col-md-4 text-center mt-4">
                        <button type="submit" ng-disabled="processdone" class="btn btn-primary px-4" style="background-color:#51b37f; color:white; border-radius: 5px;">
                            Generate Form
                        </button>
                    </div>
                    
                </form>
            </div>
        </div>
    </div>
    <div id="printForm">
    <h1
      style="
        /* padding-left: 181pt; */
        text-indent: 0pt;
        line-height: 22pt;
        text-align: right;
      "
    >
            {{data.customerName}}
        </h1>
    <p
      class="s1"
      style="
        padding-left: 280pt;
        text-indent: 31pt;
        line-height: 106%;
        text-align: right;
      "
    >
      {{data.address}}
    </p>
    <p
      class="s1"
      style="text-indent: 0pt; line-height: 16pt; text-align: right"
    >
      M. No. {{data.mobile}}
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <hr style="border-top: 2px solid #000;">

    <p
      style="
        padding-left: 5pt;
        text-indent: 0pt;
        line-height: 1pt;
        text-align: left;
      "
    />
    <h3
      style="
        padding-top: 2pt;
        padding-left: 293pt;
        text-indent: 0pt;
        text-align: left;
      "
    >
      Date:
      <span class="s2"
        >{{data.date | date:'dd/MM/yyyy'}}</span
      >
    </h3>
    <p style="text-indent: 0pt; text-align: left"></p>
    <p class="s3" style="padding-left: 5pt; text-indent: 0pt; text-align: left">
      TO
    </p>
    <p class="s4" style="padding-left: 5pt; text-indent: 0pt; text-align: left">
     {{data.officename}},
    </p>
    <p class="s4" style="padding-left: 5pt; text-indent: 0pt; text-align: left">
      {{data.officeaddress}}
    </p>
    <p
      style="
        padding-top: 13pt;
        padding-left: 5pt;
        text-indent: 0pt;
        text-align: left;
      "
    >
      Unit: <span class="s5">{{data.unit}}<br /> Folio No.: - {{data.folioNo}}</span>
    </p>
    <p style="padding-top: 12pt; text-indent: 0pt; text-align: left"></p>
    <h3 style="text-indent: 0pt; text-align: center">
      SUB: Change of Name in Share Certificate.
    </h3>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: left">
      Dear sir / madam,
    </p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: left">
      I am exsting shareholder of the company i.e.
      <span class="s6">{{data.officename}} </span>I had acquired shares of the
      company in the year<span class="s3"> </span>and I have been a shareholder
      ever since I want to bring to your notice that my
    </p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: left">
      name has undergone a change. Hence, I would like to have my new name
      updated in the records of register of members of the company.
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: left">
      Kindly find below the details of my name change:
    </p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: left">
            Old name: <b>{{data.newName }}</b>
    </p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: left">
            New name: <b>{{data.customerName}}</b>
    </p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: left">
      Further, kindly find below my shareholding details in the company:
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <table
      style="border-collapse: collapse; margin-left: 155.5pt"
      cellspacing="0"
    >
      <tr style="height: 15pt">
        <td
          style="
            width: 93pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
        >
          <p
            class="s7"
            style="
              padding-top: 1pt;
              padding-left: 1pt;
              text-indent: 0pt;
              line-height: 13pt;
              text-align: center;
            "
          >
            Folio. No
          </p>
        </td>
        <td
          style="
            width: 93pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
        >
          <p
            class="s7"
            style="padding-left: 1pt; text-indent: 0pt; text-align: center"
          >
            No Of Shares
          </p>
        </td>
      </tr>
      <tr style="height: 14pt">
        <td
          style="
            width: 93pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
        >
          <p
            class="s8"
            style="
              padding-left: 1pt;
              text-indent: 0pt;
              line-height: 13pt;
              text-align: center;
            "
          >
            {{data.folioNo}}
          </p>
        </td>
        <td
          style="
            width: 93pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
        >
          <p
            class="s8"
            style="
              padding-left: 1pt;
              text-indent: 0pt;
              line-height: 13pt;
              text-align: center;
            "
          >
            {{data.qty}}
          </p>
        </td>
      </tr>
    </table>
    <p style="padding-top: 8pt; text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: justify">
      I am enclosing hear with original share certificate as per the details
      above.
    </p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: justify">
      I hear by kindly request you to consider my letter along with the
      documents provided hear with for updation of my new name in the Register
      of members of the company and dematerialize the same. Kindly acknowledge
      the receipt and please do the needful the earliest.
    </p>
    <p
      style="
        padding-top: 13pt;
        padding-left: 5pt;
        text-indent: 0pt;
        text-align: justify;
      "
    >
      I am enclosing the duly attested copies of the following documents support
      of my name change:
    </p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: left">
      (1) Gazette (2) Pan Card and Aadhar Card
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: left">
      Thanking you, Yours faithfully,
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: left">
      (Signature)
    </p>
    <p
      style="
        padding-left: 5pt;
        text-indent: 0pt;
        line-height: 13pt;
        text-align: left;
      "
    >
      Name of the shareholder
    </p>
    <h2
      style="
        padding-left: 5pt;
        text-indent: 0pt;
        line-height: 14pt;
        text-align: left;
      "
    >
            {{data.customerName}}
    </h2>
     </div>
    <div class="myarea">
        <button class="btn btn-store mybtn" ng-click="printDiv('printForm')">PRINT</button>
    </div>
</body>
<script>
    angular.module('Stock-CMS', []).controller('FormController', function ($scope, $http,$timeout) {
        $scope.customers = [];
        $scope.hDiv = true;
            var params = new URLSearchParams(window.location.search);
            var id = params.get('id');
            var id2 = params.get('id2');
        var isProcessing = false;
        $scope.processdone = false;

        // showLoader();

        // Load Customers
         $scope.loadCustomers = function (sid,hid) {
             if(id){
                 hideLoader();
                 var docid = $scope.seletedid == undefined ? 0 : $scope.seletedid;
                 var currentDate = new Date();
             var monthsOfYear = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                 $scope.hDiv = true;
            $http.get('/Enquiry/GetStocksById/'+id).then(function (response) {
                var result = response.data;
                $http.get('/Form/GetHolderByStockId/' + id).then(function (response) {
                     $scope.docs = response.data;
                    var doc = $scope.docs.find(x => x.id === sid);

                     var isDeceased = !!doc?.dateOfDeath;

                if (isDeceased) {
                    $scope.heirId = null;
    $scope.legalheirlist = isDeceased;
    document.getElementById('heirId').value = '';
                    $http.get('/LegalHeir/GetClaimentLegalHeir/' + doc.id).then(function (response) {
                        $scope.heir = response.data;
                        var heirs = response.data.find(x => x.id === hid); // `hid` needs to be in scope
                        var holder = heirs;

                        populateData(holder, result,$scope.heir,isDeceased);
                    }, function (error) {
                        console.error('Error loading legal heir data:', error);
                        hideLoader();
                    });
                } else {
                    $scope.heirId = null;
    $scope.data = null;
    $scope.legalheirlist = isDeceased;
    document.getElementById('heirId').value = '';
                    var holder = doc;
                    populateData(holder, result,$scope.heir,isDeceased);
                }

                hideLoader();
                }, function (error) {
                    console.error('Error loading Docs:', error);
                    hideLoader();
                });
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }

            if(id2){
                 $scope.hDiv = false;
            $http.get('/Form/GetGenratedFormById/'+id2).then(function (response) {
                var result = response.data;
                var obj = JSON.parse(result.jsonString);
                $scope.data = {
                    docid: obj.docid,
                    customerName: obj.customerName,
                    folioNo : obj.folioNo,
                    qty : obj.qty,
                    address:obj.address,
                    mobile: obj.mobile,
                    officename: obj.officename,
                    officeaddress: obj.officeaddress,
                    unit: obj.unit,
                    clientid:obj.clientid,
                    date:new Date(obj.date),
                    newName:obj.newName,
                                        condition: obj.condition,

                };
                                id = result.stockId;

                checkData();
                hideLoader();
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }

            function populateData(holder, result, heirlist,isDeceased) {

                $scope.data = {
                    docid: holder.id,
                   customerName : holder.name,
                   qty:result.qty,
                   folioNo : result.folioNo,
                   mobile: holder.mobile,
                   address : holder.addressAsPerAadhar,
                   officename : result.company.rtaName,
                   officeaddress: result.company.rtaAddress,
                   unit: result.companyName,
                   date:new Date(),
                   newName:'',
				   condition: isDeceased,
                };
            }
        };

                        function checkData() {
        if ($scope.data !== undefined) {
            // Delay the printDiv execution until the next digest cycle
            $timeout(function() {
                $scope.printDiv('printForm');
            }, 0);  // 0 delay to ensure it runs after the view update
        } else {
            setTimeout(checkData, 1000); // Retry after 1000ms if data is not yet available
        }
    }

        $scope.navtogenerateform = function () {
        window.open('/Form/GenerateForm/'+id, '_self');
    };

        //Genrate Form
         $scope.genrateForm = function () {
             if(id){
                 $scope.processdone = true;
             let jsonString = JSON.stringify($scope.data, null, 2);
             var data ={
                 formName : 'Name Change After Marriage',
                 StockId : id,
                 url : `/Form/NameChangeAfterMrg?id2=`,
                 jsonString : jsonString,
                 ClientName: $scope.data.customerName,
                  ClientId: $scope.data.docid,
                 IsActive : true
             }

             const url = '/Form/GenrateForm';
                $http.post(url, data).then(function (response) {
                    if (response.data.success) {
                        Swal.fire({
                            title: 'Success',
                            text: response.data.message || 'Operation successful!',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        });
                        $scope.processdone = false;
                        // $scope.loadCustomers();
                                                window.open(response.data.data.url + response.data.data.id,'_self')

                    } else {
                        Swal.fire({
                         title: 'This Form is already Exits',
                         text: "do you want to go to that form?",
                         icon: 'warning',
                         showCancelButton: true,
                         confirmButtonText: 'Yes',
                         cancelButtonText: 'No'
                     }).then((result) => {
                         if (result.isConfirmed) {
                             window.open(response.data.message, '_self');
                         }
                 });
                 $scope.processdone = false;
                    }
                    isProcessing = false;
                }, function (error) {
                    Swal.fire({
                        title: 'Error',
                        text: 'An error occurred.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                    $scope.processdone = false;
                    isProcessing = false;
                });
            //console.log(dataString);
            }
         }

        // $scope.loadCustomers = function () {
        //     $http.get('/Master/GetCustomers').then(function (response) {
        //         $scope.customers = response.data[0];
        //         hideLoader();
        //     }, function (error) {
        //         console.error('Error loading customers:', error);
        //         hideLoader();
        //     });
        // };

        // $scope.loadDocs = function () {
        //     if (true) {
        //         $http.get('/doc/getDocs/' + 1).then(function (response) {
        //             $scope.docs = response.data;
        //             hideLoader();
        //         }, function (error) {
        //             console.error('Error loading Docs:', error);
        //             hideLoader();
        //         });
        //     }
        // };

        //Function
        $scope.printDiv = function (divId) {
                    var css ='<style type="text/css"> * { margin: 0; padding: 0; text-indent: 0; } h1 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 18pt; } .s1 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 14pt; } h3 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; } .s2 { color: black; font-family: "Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 11pt; } .s3 { color: black; font-family: "Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; } .s4 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; } p { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; margin: 0pt; } .s5 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; } .s6 { color: black; font-family: Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: underline; font-size: 11pt; } .s7 { color: #212121; font-family: Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; } .s8 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; } h2 { color: black; font-family: "Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; } table, tbody { vertical-align: top; overflow: visible; } </style>';
            var innerContents = document.getElementById(divId).innerHTML;
            var popupWinindow = window.open('', '_blank', 'width=600,height=700,scrollbars=no,menubar=no,toolbar=no,location=no,status=no,titlebar=no');
            popupWinindow.document.open();
            popupWinindow.document.write('<html><head><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">' + css + '</ head > <body style="padding-left: 0 8% 0 8%;"onload="window.print()">' + innerContents + '</html>');
            popupWinindow.document.close();
        };
        //Initialize
        $scope.loadCustomers();
        // $scope.loadDocs();
    });
</script>

</html>
