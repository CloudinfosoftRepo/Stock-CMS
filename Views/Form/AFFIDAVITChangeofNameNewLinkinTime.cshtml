<html lang="en" ng-app="Stock-CMS">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>AFFIDAVIT Change of Name - New LinkinTime</title>
</head>
<style type="text/css">
    * {
        margin: 0;
        padding: 0;
        text-indent: 0;
    }

    h1 {
        color: black;
        font-family: Calibri, sans-serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: underline;
        font-size: 12pt;
    }

    .p,
    p {
        color: black;
        font-family: Calibri, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 11pt;
        margin: 0pt;
    }

    .s1 {
        color: black;
        font-family: Calibri, sans-serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: none;
        font-size: 11pt;
    }

    .s2 {
        color: black;
        font-family: "Times New Roman", serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: underline;
        font-size: 11pt;
    }

    li {
        display: block;
    }

    #l1 {
        padding-left: 0pt;
        counter-reset: c1 1;
    }

        #l1 > li > *:first-child:before {
            counter-increment: c1;
            content: counter(c1, decimal) ". ";
            color: black;
            font-family: Calibri, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 11pt;
        }

        #l1 > li:first-child > *:first-child:before {
            counter-increment: c1 0;
        }

    .card {
        border-radius: 10px;
        overflow: hidden;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-label {
        font-size: 1.1rem;
        font-weight: 600;
    }

    .form-select {
        width: 100%;
        padding: 0.75rem;
        border-radius: 5px;
        border: 1px solid #ddd;
        font-size: 1rem;
    }

    .btn-primary {
        width: 100%;
        padding: 12px 16px;
        text-transform: uppercase;
        font-weight: bold;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

        .btn-primary:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }
</style>
<body style="padding: 5%;" ng-controller="FormController">
    <div class="row align-items-center">
        <!-- Arrow Icon aligned to the left -->
        <a class="col-md-1 text-start" style="font-size:35px;" ng-click="navtogenerateform()">
            <i class="bi bi-arrow-left"></i>
        </a>

        <!-- Centered Heading -->
        <div class="col-md-10 text-center">
            <h3>AFFIDAVIT Change of Name - New LinkinTime</h3>
        </div>
    </div>
    <div ng-if="hDiv" class="container my-5">
        <div class="card shadow-sm">
            <div class="card-body">
                <form name="gForm" ng-submit="genrateForm()">
                    <h4 class="card-title text-center mb-4" style="color:#003980;">Generate Form</h4>

                    <div class="row">
                        <!-- Customer Selection Dropdown -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="seletedid" class="form-label">Select Customer</label>
                                <select class="form-select" ng-options="f.id as f.name for f in docs" ng-model="seletedid" ng-change="loadCustomers(seletedid)">
                                    <option selected disabled value="">Select customer</option>
                                </select>
                            </div>
                        </div>

                        <!-- Old Name Input Field -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="newName" class="form-label">Old Name</label>
                                <input type="text" ng-model="data.newName" class="form-control" placeholder="Old Name">
                            </div>
                        </div>

                        <!-- Name Change Date Input Field -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="namechagedate" class="form-label">Name Change Date</label>
                                <input type="date" ng-model="data.namechagedate" class="form-control" placeholder="Name Change Date">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <!-- Place of Submission Input Field -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="place" class="form-label">Place</label>
                                <input type="text" ng-model="data.place" class="form-control" placeholder="Place of Form Submission">
                            </div>
                        </div>
                    </div>
                        <!-- Submit Button -->
                        <div class="col-md-4 d-flex align-items-center justify-content-center mb-3">
                            <button type="submit" class="btn btn-primary px-4" style="background-color:#003980; color:white; border-radius: 5px;">
                                Generate Form
                            </button>
                        </div>
                </form>
            </div>
        </div>
    </div>
    <div id="printForm">
    <h1 style="
        padding-top: 2pt;
        padding-left: 6pt;
        text-indent: 0pt;
        text-align: center;
      ">
        AFFIDAVIT
    </h1>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="
        padding-left: 5pt;
        text-indent: 0pt;
        line-height: 150%;
        text-align: left;
      ">
            I, <u><b>{{data.customerName}}</b></u><b> </b>{{data.relationship}} <u><b>{{data.sonof}}</b></u><b> </b>aged <u><b>{{data.age}}</b></u>, residing at <u>
            <b>{{data.address}}</b></u><b> </b><u>
            @* <b>NAGAR, BEHIND KRISHNA PARK, AJWA ROAD, VADODARA, GUJARAT, 390019,</b> *@
        </u><b> </b>do hereby solemnly
    </p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: left">
        affirm and declare as under:
    </p>
    <p style="padding-top: 1pt; text-indent: 0pt; text-align: left"><br /></p>
    <ol id="l1">
        <li data-list-text="1.">
            <p style="padding-left: 40pt; text-indent: -17pt; text-align: left">
                    That my name earlier was <u><b>{{data.newName}}</b></u>
            </p>
        </li>
        <li data-list-text="2.">
            <p style="
            padding-top: 13pt;
            padding-left: 40pt;
            text-indent: -17pt;
            text-align: left;
          ">
                    That I have changed my name as <u><b>{{data.customerName}}</b></u><b> </b>on/from {{data.namechagedate | date:'dd-MM-yyyy'}}(date of change of name).
            </p>
            <p style="text-indent: 0pt; text-align: left"><br /></p>
        </li>
        <li data-list-text="3.">
            <p style="padding-left: 40pt; text-indent: -17pt; text-align: left">
                At present all the records have my new name
                    <u><b>{{data.customerName}}</b></u>
            </p>
            <p style="text-indent: 0pt; text-align: left"><br /></p>
        </li>
        <li data-list-text="4.">
            <p style="padding-left: 40pt; text-indent: -17pt; text-align: left">
                I have not published in the Gazette for change of name.
            </p>
            <p style="text-indent: 0pt; text-align: left"><br /></p>
        </li>
        <li data-list-text="5.">
            <p class="s1"
               style="
            padding-left: 41pt;
            text-indent: -18pt;
            line-height: 200%;
            text-align: left;
          ">
                    <span class="p">I state that </span><u><b>{{data.newName}}</b></u>
                <span class="p">(earlier name) and the </span>
                    <u>{{data.customerName}}</u>
                @* <u>PANCHAL</u> *@
                <span class="p">
                    (present name) is the name of one and the same person and that is
                    myself.
                </span>
            </p>
        </li>
    </ol>
    <p style="
        padding-top: 8pt;
        padding-left: 23pt;
        text-indent: 0pt;
        line-height: 108%;
        text-align: left;
      ">
        I am executing this declaration to be submitted to the concerned
        authorities for the change of name.
    </p>
    <p style="
        padding-top: 8pt;
        padding-left: 23pt;
        text-indent: 0pt;
        line-height: 167%;
        text-align: left;
      ">
        I hereby state that whatever is stated herein above are true to the best
        of my knowledge. Solemnly affirmed at
        @* <span class="s2">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>) *@
        <span class="s2">{{data.place}} </span>)
    </p>
    <p style="padding-left: 23pt; text-indent: 0pt; text-align: left">
        On this

        <span class="s2 ">
            @* {{data.day}} *@ <u>&emsp;&emsp;</u>
        </span>

        day of
        @* <span class="s2 "> *@
        @*     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *@
        @* </span>  *@
        <span class="s2 ">
           {{data.month}}
        </span>
            {{data.year}} )
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 257pt; text-indent: 0pt; text-align: left">
        (Signature of the Applicant)
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 293pt; text-indent: 0pt; text-align: left">
        Deponent
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 23pt; text-indent: 0pt; text-align: left">
        Identified by me Before Me
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 23pt; text-indent: 0pt; text-align: left">
        Advocate S.E.O./Oaths Commissioner/Notary
    </p>
    </div>
    <button class="btn btn-store" ng-click="printDiv('printForm')">Print</button>
</body>
<script>
    angular.module('Stock-CMS', []).controller('FormController', function ($scope, $http,$timeout) {
        $scope.customers = [];
         $scope.data = undefined;
            $scope.hDiv = true;
            var params = new URLSearchParams(window.location.search);
            var id = params.get('id');
            var id2 = params.get('id2');
        var isProcessing = false;

        // showLoader();

        // Load Customers
        // $scope.loadCustomers = function () {
        //     $http.get('/Master/GetCustomers').then(function (response) {
        //         $scope.customers = response.data[0];
        //         hideLoader();
        //     }, function (error) {
        //         console.error('Error loading customers:', error);
        //         hideLoader();
        //     });
        // };

        // Load Customers
         $scope.loadCustomers = function (sid) {

             if(id){
                 hideLoader();
                 var currentDate = new Date();
             var monthsOfYear = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                 $scope.hDiv = true;
            $http.get('/Enquiry/GetStocksById/'+id).then(function (response) {
                var result = response.data;
                 $http.get('/Form/GetHolderByStockId/' +  id).then(function (response) {
                     $scope.docs = response.data;
                    var doc = $scope.docs.find(x => x.id === sid);
                    var Age = $scope.calculateAge(doc.dob,doc.dateOfDeath);
                $scope.data = {
                    docid: doc.id,
                   customerName : doc.name,
                   newName: '',
                   age : Age,
                   relationship: doc.relationship,
                   sonof: doc.relativesName,
                   address : doc.addressAsPerAadhar,
                   namechagedate: '',
                   place:'Vadodara',
                   day: currentDate.getDate(),
                   month: monthsOfYear[currentDate.getMonth()],
                   year: currentDate.getFullYear(),
                };

                hideLoader();
                }, function (error) {
                    console.error('Error loading Docs:', error);
                    hideLoader();
                });
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }

            if(id2){
                 $scope.hDiv = false;
            $http.get('/Form/GetGenratedFormById/'+id2).then(function (response) {
                var result = response.data;
                var obj = JSON.parse(result.jsonString);
                $scope.data = {
                    docid: obj.docid,
                    customerName: obj.customerName,
                    newName: obj.newName,
                    age:obj.age,
                    relationship: obj.relationship,
                    sonof:obj.sonof,
                    address:obj.address,
                    namechagedate: obj.namechagedate,
                    place: obj.place,
                    day:obj.day,
                    month:obj.month,
                    year: obj.year,
                };
                id = result.stockId;
                checkData();
                hideLoader();
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }
        };

                        function checkData() {
        if ($scope.data !== undefined) {
            // Delay the printDiv execution until the next digest cycle
            $timeout(function() {
                $scope.printDiv('printForm');
            }, 0);  // 0 delay to ensure it runs after the view update
        } else {
            setTimeout(checkData, 1000); // Retry after 1000ms if data is not yet available
        }
    }

        //Genrate Form
         $scope.genrateForm = function () {
             if(id){
             let jsonString = JSON.stringify($scope.data, null, 2);
             var data ={
                 formName : 'AFFIDAVIT Change of NameNew LinkinTime',
                 StockId : id,
                 url : `/Form/AFFIDAVITChangeofNameNewLinkinTime?id2=`,
                 jsonString : jsonString,
                 ClientName: $scope.data.customerName,
                  ClientId: $scope.data.docid,
                 IsActive : true
             }

             const url = '/Form/GenrateForm';
                $http.post(url, data).then(function (response) {
                    if (response.data.success) {
                        Swal.fire({
                            title: 'Success',
                            text: response.data.message || 'Operation successful!',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        });
                        // $scope.loadCustomers(null);
                                                window.open(response.data.data.url + response.data.data.id,'_self')

                    } else {
                       Swal.fire({
                         title: 'This Form is already Exits',
                         text: "do you want to go to that form?",
                         icon: 'warning',
                         showCancelButton: true,
                         confirmButtonText: 'Yes',
                         cancelButtonText: 'No'
                     }).then((result) => {
                         if (result.isConfirmed) {
                             window.open(response.data.message, '_self');
                         }
                 });

                    }
                    isProcessing = false;
                }, function (error) {
                    Swal.fire({
                        title: 'Error',
                        text: 'An error occurred.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                    isProcessing = false;
                });
            //console.log(dataString);
            }
         }

    $scope.navtogenerateform = function () {
        window.open('/Form/GenerateForm/'+id, '_self');
    };

    $scope.calculateAge = function(dob, deathDate) {
            if (!dob) {
                return '';
            }

            var birthDate = new Date(dob);
            var currentDate = new Date();
            var age = currentDate.getFullYear() - birthDate.getFullYear();
            var m = currentDate.getMonth() - birthDate.getMonth();

            if (m < 0 || (m === 0 && currentDate.getDate() < birthDate.getDate())) {
                age--;
            }

            // If deathDate is provided, calculate age at the time of death
            if (deathDate) {
                var deathDateObj = new Date(deathDate);
                age = deathDateObj.getFullYear() - birthDate.getFullYear();
                var mDeath = deathDateObj.getMonth() - birthDate.getMonth();

                if (mDeath < 0 || (mDeath === 0 && deathDateObj.getDate() < birthDate.getDate())) {
                    age--;
                }
                return age;
                // return age + ' (deceased)';
            }

            return age;
        };

        // $scope.loadDocs = function () {
        //     if (true) {
        //         $http.get('/doc/getDocs/' + 1).then(function (response) {
        //             $scope.docs = response.data;
        //             hideLoader();
        //         }, function (error) {
        //             console.error('Error loading Docs:', error);
        //             hideLoader();
        //         });
        //     }
        // };
        //Function
        $scope.printDiv = function (divId) {
            var css = '<style type="text/css">* {margin: 0; padding: 0; text-indent: 0;} h1 {color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: underline; font-size: 12pt;} .p, p {color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; margin: 0pt;} .s1 {color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt;} .s2 {color: black; font-family: "Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 11pt;} li {display: block;} #l1 {padding-left: 0pt; counter-reset: c1 1;} #l1 > li > *:first-child:before {counter-increment: c1; content: counter(c1, decimal) ". "; color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt;} #l1 > li:first-child > *:first-child:before {counter-increment: c1 0;}</style>';
            var innerContents = document.getElementById(divId).innerHTML;
            var popupWinindow = window.open('', '_blank', 'width=600,height=700,scrollbars=no,menubar=no,toolbar=no,location=no,status=no,titlebar=no');
            popupWinindow.document.open();
            popupWinindow.document.write('<html><head><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">' + css + '</ head > <body style="padding-left: 0 5% 0 5%;"onload="window.print()">' + innerContents + '</html>');
            popupWinindow.document.close();
        };
        //Initialize
        $scope.loadCustomers(null);
        // $scope.loadDocs();
    });
</script>

</html>
