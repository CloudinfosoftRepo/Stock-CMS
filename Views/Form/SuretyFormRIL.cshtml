<html lang="en" ng-app="Stock-CMS">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>sureity form RIL</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        h1 {
            color: black;
            font-family: "Times New Roman", serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 14pt;
        }

        .s1 {
            color: black;
            font-family: "Times New Roman", serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 12pt;
        }

        p {
            color: black;
            font-family: Calibri, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 11pt;
            margin: 0pt;
        }

        .s2 {
            color: black;
            font-family: "Times New Roman", serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: underline;
            font-size: 11pt;
        }

        .s3 {
            color: black;
            font-family: Calibri, sans-serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 11pt;
        }

        h2 {
            color: black;
            font-family: Calibri, sans-serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 12pt;
        }

        table,
        tbody {
            vertical-align: top;
            overflow: visible;
        }

        .table {
            border-collapse: collapse;
            margin-left: 5.5pt;
        }

            .table td {
                border: 1pt solid black;
                padding: 0 5pt;
            }

                .table td p {
                    text-indent: 0pt;
                    margin: 0;
                }

            .table .s3 {
                line-height: 12pt;
            }

            .table .text-left {
                text-align: left;
            }

            .table .text-center {
                text-align: center;
            }


        .card {
            border-radius: 10px;
            overflow: hidden;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .form-select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 1rem;
        }

        .btn-primary {
            width: 100%;
            padding: 12px 16px;
            text-transform: uppercase;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

            .btn-primary:hover {
                background-color: #0056b3;
                transform: scale(1.05);
            }

        .mybtn {
            background-color: #003980 !important;
            color: white !important;
            width: auto !important;
        }

        .myarea {
            justify-content: center !important;
            display: flex !important;
            margin-top: 25px !important;
        }
    </style>
</head>
<body style="padding: 5%;" ng-controller="FormController">
    <div class="row align-items-center">
        <!-- Arrow Icon aligned to the left -->
        <a class="col-md-1 text-start" style="font-size:35px;" ng-click="navtogenerateform()">
            <i class="bi bi-arrow-left"></i>
        </a>

        <!-- Centered Heading -->
        <div class="col-md-10 text-center">
            <h3>sureity form RIL</h3>
        </div>
    </div>
    <div ng-if="hDiv" class="container my-5">
        <div class="card shadow-sm">
            <div class="card-body">
                <form name="gForm" ng-submit="genrateForm()">
                    <h4 class="card-title text-center mb-4" style="color:#003980;">Generate Form</h4>

                    <div class="row">
                        <!-- Select Customer Dropdown -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="seletedId" class="form-label">Select Customer</label>
                                <select class="form-select" id="seletedId" ng-options="f.id as f.name for f in doc" ng-model="seletedId" ng-change="loadCustomers(seletedId, heirId)">
                                    <option selected disabled value="">Select customer</option>
                                </select>
                            </div>
                        </div>

                        <!-- Select Heir Dropdown -->
                        <div class="col-md-4 mb-3" ng-show="legalheirlist">
                            <div class="form-group">
                                <label for="heirId" class="form-label">Select Heir</label>
                                <select class="form-select" id="heirId" ng-options="g.id as g.name for g in heir" ng-model="heirId" ng-change="loadCustomers(seletedId, heirId)">
                                    <option selected disabled value="">Select Heir</option>
                                </select>
                            </div>
                        </div>

                        <!-- Surety 1 Name -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="Surety1Name" class="form-label">Surety 1 Name</label>
                                <input type="text" ng-model="data.surety1Name" class="form-control" placeholder="Surety 1 Name">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <!-- Surety 1 Address -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="Surety1Address" class="form-label">Surety 1 Address</label>
                                <textarea id="surety1Address" ng-model="data.surety1Address" class="form-control" placeholder="Surety 1 Address"></textarea>
                            </div>
                        </div>
                    
                        <!-- Surety 2 Name -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="Surety2Name" class="form-label">Surety 2 Name</label>
                                <input type="text" ng-model="data.surety2Name" class="form-control" placeholder="Surety 2 Name">
                            </div>
                        </div>

                        <!-- Surety 2 Address -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="surety2Address" class="form-label">Surety 2 Address</label>
                                <textarea id="surety2Address" ng-model="data.surety2Address" class="form-control" placeholder="Surety 2 Address"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <!-- Place -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="place" class="form-label">Place</label>
                                <input type="text" ng-model="data.place" class="form-control" placeholder="Place">
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="col-md-4 text-center m-2">
                        <button type="submit" ng-disabled="processdone" class="btn btn-primary" style="background-color:#003980; color:white; border-radius: 5px;">
                            Generate Form
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="printForm">
        <h1 style="
        padding-top: 3pt;
        padding-left: 6pt;
        text-indent: 0pt;
        text-align: center;
      ">
            Security Affidavit by Sureties
        </h1>
        <p class="s1"
           style="
        padding-top: 5pt;
        padding-left: 6pt;
        text-indent: 0pt;
        text-align: center;
      ">
            (To be executed on a non-judicial stamp paper of Rs.100/-, duly notarized)
        </p>
        <p style="padding-top: 11pt; text-indent: 0pt; text-align: left"><br /></p>
        <p style="
        padding-left: 10pt;
        text-indent: 0pt;
        line-height: 108%;
        text-align: left;
      ">
            WHEREAS <span class="s2">
                {{data.customerName}}
            </span>has / have applied to the Company for the issue of duplicate Share
            Certificate(s) in lieu of the original share certificate bearing No(s).
            and distinctive No(s). under the folio No. (as mentioned below),
        </p>
        <p style="text-indent: 0pt; text-align: left"><br /></p>
        <table class="table">
            <tr style="height: 14pt">
                <td rowspan="2" style="width: 90pt;">
                    <p class="s3 text-left" style="padding-top: 8pt; padding-left: 24pt;">Folio No.</p>
                </td>
                <td colspan="2" style="width: 189pt;">
                    <p class="s3 text-left" style="padding-left: 54pt;">Distinctive no.(s).</p>
                </td>
                <td rowspan="2" style="width: 103pt;">
                    <p class="s3 text-left" style="padding-top: 8pt; padding-left: 12pt;">Certificate No(s).</p>
                </td>
                <td rowspan="2" style="width: 87pt;">
                    <p class="s3 text-left" style="padding-top: 8pt; padding-left: 14pt;">No of Shares</p>
                </td>
            </tr>
            <tr style="height: 15pt">
                <td style="width: 94pt;">
                    <p class="s3 text-center" style="padding-top: 1pt;">From</p>
                </td>
                <td style="width: 95pt;">
                    <p class="s3 text-center" style="padding-top: 1pt; padding-left: 2pt;">TO</p>
                </td>
            </tr>

            <!-- Repeat the following rows for content -->
            <tr style="height: 14pt" ng-repeat="tmp in shares">
                <td><p>{{tmp.folioNo}}</p></td>
                <td><p>{{tmp.distinctiveNosFrom}}</p></td>
                <td><p>{{tmp.distinctiveNosTo}}</p></td>
                <td><p>{{tmp.certificateNo}}</p></td>
                <td><p>{{tmp.actualQty}}</p></td>
            </tr>
        </table>
        <!-- <p style="padding-top: 9pt; text-indent: 0pt; text-align: left"><br /></p> -->
        <p style="padding-left: 10pt; text-indent: 0pt; text-align: justify;line-height: 1.5;">
            BY THIS BOND Shri <span class="s2">{{data.surety1Name}} </span>r/o <span class="s2">
                {{data.surety1Address}}
            </span>hereinafter referred to as the “SURETY-1” acknowledges himself to be bound to
            <b>RELIANCE INDUSTRIES LTD (RIL</b>)
            equity an amount equivalent to the value of shares of the Company as prevailing at the time
            of invoking the security bond. BY THIS BOND Shri <span class="s2">{{data.surety2Name}} </span>r/o <span class="s2">
                {{data.surety2Address}}
            </span>hereinafter referred to as the “SURETY-2” acknowledges himself to be
            bound to <b>RELIANCE INDUSTRIES LTD (RIL</b>) hereinafter referred to as the Company to an amount equivalent to the value of shares of the Company as prevailing at the time of invoking the security bond.
        </p>
        <p style="
        padding-top: 6pt;
        padding-left: 10pt;
        text-indent: 0pt;
        line-height: 23pt;
        text-align: justify;
      ">

        </p>
        <p style="
        padding-top: 1pt;
        padding-left: 10pt;
        text-indent: 0pt;
        line-height: 108%;
        text-align: justify;
      ">

        </p>
        <p style="
        padding-top: 7pt;
        padding-left: 12pt;
        text-indent: 0pt;
        text-align: justify;
      ">
            NOW THIS DEED WITNESSETH-
        </p>
        <p style="
        padding-top: 9pt;
        padding-left: 10pt;
        text-indent: 0pt;
        line-height: 1.5;
        text-align: justify;
      ">
            In consideration of the Company issuing such duplicate Share
            Certificate(s), the Surety and his respective heirs, executors and
            administrators do hereby covenant with the Company, its successors and
            assigns that Surety and his/her heirs, executors and administrators
            respectively will at all times and from time to time save, defend and keep
            harmless and indemnified the Company, its successors and assigns and the
            Directors thereof and their respective heirs, executors, and
            administrators and each of their estates and effects from and against all
            actions, causes, suits, proceedings, accounts, claims and demands
            whatsoever on account of the said shares or any of them or the loss or non
            – production of the Certificates thereof on the part of any person or
            persons whomsoever and against all damages, costs, charges, and expenses
            and sums of money incurred in respect thereof or otherwise in relation to
            the premises.And the condition of the Bond is that it will be void if the <span lass="s2">{{data.customerName}} </span>(shareholder) pays the said amount to the Company within the time
            stipulated by the Company and failing which this Bond will remain in full
            force and effect.
        </p>
        <p style="
        padding-top: 7pt;
        padding-left: 10pt;
        text-indent: 0pt;
        line-height: 108%;
        text-align: justify;
      ">

        </p>

        <h2 style="
        padding-top: 1pt;
        padding-left: 10pt;
        text-indent: 0pt;
        line-height: 108%;
        text-align: left;
      ">
            Signed and delivered by the within named Surety along with the copy of
            self attested Pan and Aadhaar.
        </h2>
        <p style="
        padding-top: 7pt;
        padding-left: 10pt;
        text-indent: 0pt;
        text-align: left;
      ">
            Surety 1 :
        </p>
        <p style="
        padding-top: 9pt;
        padding-left: 10pt;
        text-indent: 0pt;
        text-align: left;
      ">
            Name : {{data.surety1Name}}
        </p>
        <p style="
        padding-top: 9pt;
        padding-left: 10pt;
        text-indent: 0pt;
        text-align: left;
      ">
            Address: {{data.surety1Address}}
        </p>
        <p style="text-indent: 0pt; text-align: left"><br /></p>
        <p style="padding-left: 10pt; text-indent: 0pt; text-align: left">
            Surety 2:
        </p>
        <p style="
        padding-top: 9pt;
        padding-left: 10pt;
        text-indent: 0pt;
        text-align: left;
      ">
            Name : {{data.surety2Name}}
        </p>
        <p style="
        padding-top: 9pt;
        padding-left: 10pt;
        text-indent: 0pt;
        text-align: left;
      ">
            Address: {{data.surety2Address}}
        </p>
        <p style="text-indent: 0pt; text-align: left"><br /></p>
        <p style="padding-left: 10pt; text-indent: 0pt; text-align: left">Date :@* {{data.today | date:'__-MM-yyyy'}} *@ <u>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;</u></p>
        <p style="
        padding-top: 9pt;
        padding-left: 10pt;
        text-indent: 0pt;
        text-align: left;
      ">
            Place : {{data.place}}
        </p>
        <p style="text-indent: 0pt; text-align: left"><br /></p>
    </div>
    <div class="myarea">
        <button class="btn btn-store mybtn" ng-click="printDiv('printForm')">PRINT</button>
    </div>
</body>
<script>
            angular.module('Stock-CMS', []).controller('FormController', function ($scope, $http,$timeout) {
                $scope.customers = [];
                           $scope.hDiv = true;
            var params = new URLSearchParams(window.location.search);
            var id = params.get('id');
            var id2 = params.get('id2');
                var isProcessing = false;
                $scope.processdone = false;

                // showLoader();

                 // Load Customers
         $scope.loadCustomers = function (sid,hid) {
                if(id){
                    hideLoader();
                 var currentDate = new Date();
             var monthsOfYear = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                 $scope.hDiv = true;
            $http.get('/Enquiry/GetStocksById/'+id).then(function (response) {
                var result = response.data;

                 $http.get('/Form/GetHolderByStockId/' + id).then(function (response) {
                    $scope.doc = response.data;
                    var docs = $scope.doc.find(x => x.id === sid);

                     var isDeceased = !!docs?.dateOfDeath;

                if (isDeceased) {
                    $scope.heirId = null;
    $scope.legalheirlist = isDeceased;
    document.getElementById('heirId').value = '';
                    $http.get('/LegalHeir/GetClaimentLegalHeir/' + docs.id).then(function (response) {
                        $scope.heir = response.data;
                        var heirs = response.data.find(x => x.id === hid); // `hid` needs to be in scope
                        var holder = heirs;

                        populateData(holder, result,$scope.heir,isDeceased);
                    }, function (error) {
                        console.error('Error loading legal heir data:', error);
                        hideLoader();
                    });
                } else {
                    $scope.heirId = null;
    $scope.data = null;
    $scope.legalheirlist = isDeceased;
    document.getElementById('heirId').value = '';
                    var holder = docs;
                    populateData(holder, result,$scope.heir,isDeceased);
                }

                hideLoader();
                }, function (error) {
                    console.error('Error loading Docs:', error);
                    hideLoader();
                });
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }

            if(id2){
                 $scope.hDiv = false;
            $http.get('/Form/GetGenratedFormById/'+id2).then(function (response) {
                var result = response.data;
                var obj = JSON.parse(result.jsonString);
                $scope.data = {
                    docid: obj.docid,
                    customerName: obj.customerName,
                    address: obj.address,
                    today: new Date(obj.today),
                    mobile: obj.mobile,
                    qty : obj.qty,
                    folioNo : obj.folioNo,
                    place: obj.place,
                    surety1Name:obj.surety1Name,
                    surety1Address:obj.surety1Address,
                    surety2Name:obj.surety2Name,
                    surety2Address:obj.surety2Address,
                    jsondata: obj.jsondata,
					condition: obj.condition,
                };
                                id = result.stockId;
                                $scope.shares = JSON.parse($scope.data.jsondata);
                checkData();
                hideLoader();
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }

             function populateData(holder, result, heirlist,isDeceased) {
                 $scope.data = {
                    docid: holder.id,
                    customerName : holder.name,
                       address : holder.addressAsPerAadhar,
                       mobile: holder.mobile,
                           qty : result.qty,
                       folioNo : result.folioNo,
                       today: new Date(),
                       place: 'Vadodara',
                       surety1Name:'',
                       surety1Address:'',
                       surety2Name:'',
                       surety2Address:'',
                       jsondata: result.stockJson,
                        condition: isDeceased,
                };
                $scope.shares = JSON.parse($scope.data.jsondata);
             }
        };

            $scope.navtogenerateform = function () {
        window.open('/Form/GenerateForm/'+id, '_self');
    };

                        function checkData() {
        if ($scope.data !== undefined) {
            // Delay the printDiv execution until the next digest cycle
            $timeout(function() {
                $scope.printDiv('printForm');
            }, 0);  // 0 delay to ensure it runs after the view update
        } else {
            setTimeout(checkData, 1000); // Retry after 1000ms if data is not yet available
        }
    }



        //Genrate Form
         $scope.genrateForm = function () {
             if(id){
                 $scope.processdone = true;
                  if($scope.data.jsondata == undefined){
                     Swal.fire({
                            title: 'Error!',
                            text:  'Please Enter Stock Qty data in Custome\'s Stock Page',
                            icon: 'error',
                            confirmButtonText: 'Try Again'
                        });
                        $scope.processdone = false;
                return;
                 }
             let jsonString = JSON.stringify($scope.data, null, 2);
             var data ={
                     formName :'Surety Form RIL',
                 StockId : id,
                     url : `/Form/SuretyFormRIL?id2=`,
                 jsonString : jsonString,
                 ClientName: $scope.data.customerName,
                  ClientId: $scope.data.docid,
                 IsActive : true
             }

             const url = '/Form/GenrateForm';
                $http.post(url, data).then(function (response) {
                    if (response.data.success) {
                        Swal.fire({
                            title: 'Success',
                            text: response.data.message || 'Operation successful!',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        });
                        $scope.processdone = false;
                        // $scope.loadCustomers();
                        window.open(response.data.data.url + response.data.data.id,'_self')
                    } else {
                       Swal.fire({
                         title: 'This Form is already Exits',
                         text: "do you want to go to that form?",
                         icon: 'warning',
                         showCancelButton: true,
                         confirmButtonText: 'Yes',
                         cancelButtonText: 'No'
                     }).then((result) => {
                         if (result.isConfirmed) {
                             window.open(response.data.message, '_self');
                         }
                 });
                 $scope.processdone = false;
                    }
                    isProcessing = false;
                }, function (error) {
                    Swal.fire({
                        title: 'Error',
                        text: 'An error occurred.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                    $scope.processdone = false;
                    isProcessing = false;
                });
            //console.log(dataString);
            }
         }

                // Load Customers
                // $scope.loadCustomers = function () {
                //     $http.get('/Master/GetCustomers').then(function (response) {
                //         $scope.customers = response.data[0];
                //         hideLoader();
                //     }, function (error) {
                //         console.error('Error loading customers:', error);
                //         hideLoader();
                //     });
                // };

                // $scope.loadDocs = function () {
                //     if (true) {
                //         $http.get('/doc/getDocs/' + 1).then(function (response) {
                //             $scope.docs = response.data;
                //             hideLoader();
                //         }, function (error) {
                //             console.error('Error loading Docs:', error);
                //             hideLoader();
                //         });
                //     }
                // };

                //Function
                $scope.printDiv = function (divId) {
                        var css ='<style type="text/css">* { margin: 0; padding: 0; text-indent: 0; } h1 { color: black; font-family: "Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 14pt; } .s1 { color: black; font-family: "Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; } p { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; margin: 0pt; } .s2 { color: black; font-family: "Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 11pt; } .s3 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; } h2 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; } table, tbody { vertical-align: top; overflow: visible; } .table { border-collapse: collapse; margin-left: 5.5pt; } .table td { border: 1pt solid black; padding: 0 5pt; } .table td p { text-indent: 0pt; margin: 0; } .table .s3 { line-height: 12pt; } .table .text-left { text-align: left; } .table .text-center { text-align: center; }</style>';
                    var innerContents = document.getElementById(divId).innerHTML;
                    var popupWinindow = window.open('', '_blank', 'width=600,height=700,scrollbars=no,menubar=no,toolbar=no,location=no,status=no,titlebar=no');
                    popupWinindow.document.open();
                    popupWinindow.document.write('<html><head><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">' + css + '</ head > <body style="padding: 0% 5% 0 5%;"onload="window.print()">' + innerContents + '</html>');
                    popupWinindow.document.close();
                };
                //Initialize
                $scope.loadCustomers();
                // $scope.loadDocs();
            });
</script>
</html>
