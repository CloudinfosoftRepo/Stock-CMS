<html lang="en" ng-app="Stock-CMS">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Revalidation-red-div</title>
    <style type="text/css">
      * {
        margin: 0;
        padding: 0;
        text-indent: 0;
      }
      h1 {
        color: black;
        font-family: "Trebuchet MS", sans-serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: underline;
        font-size: 11pt;
      }
      p {
        color: black;
        font-family: "Trebuchet MS", sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 10pt;
        margin: 0pt;
      }
      .s1 {
        color: black;
        font-family: Arial, sans-serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: none;
        font-size: 11pt;
      }
      .s2 {
        color: black;
        font-family: Arial, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 11pt;
      }
      .s4 {
        color: black;
        font-family: "Trebuchet MS", sans-serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: none;
        font-size: 10pt;
      }
      .s5 {
        color: black;
        font-family: "Trebuchet MS", sans-serif;
        font-style: italic;
        font-weight: bold;
        text-decoration: none;
        font-size: 9pt;
      }
      .s6 {
        color: black;
        font-family: "Times New Roman", serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 9pt;
      }
      .s7 {
        color: black;
        font-family: "Trebuchet MS", sans-serif;
        font-style: italic;
        font-weight: normal;
        text-decoration: none;
        font-size: 8pt;
      }
      .s8 {
        color: black;
        font-family: "Times New Roman", serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: underline;
        font-size: 10pt;
      }
      table,
      tbody {
        vertical-align: top;
        overflow: visible;
      }
    </style>
  </head>
<body style="padding: 5% 8% 0 8% ;" ng-controller="FormController">
    <div class="row align-items-center">
        <!-- Arrow Icon aligned to the left -->
        <a class="col-md-1 text-start" style="font-size:35px;" ng-click="navtogenerateform()">
            <i class="bi bi-arrow-left"></i>
        </a>

        <!-- Centered Heading -->
        <div class="col-md-10 text-center">
            <h3>Revalidation-red-div</h3>
        </div>
    </div>
    <div ng-if="hDiv">
        <form name="gForm" ng-submit="genrateForm()">
            <div class="row">
                @* <div class="col-md-4"> *@
                <div class="form-group mb-3">
                    <label for="seletedId" class="form-label">select customer</label>
                    <select class="form-select w-auto" ng-options="f.id as f.name for f in doc" ng-model="seletedId" ng-change="loadCustomers(seletedId)">
                        <option selected disabled value="">Select customer</option>
                    </select>
                    </div>
                    <div class="form-group mb-3 col-md-3">
                        <label for="warrentno" class="form-label">Warrent No</label>
                        <input type="text" ng-model="data.warrentno" class="form-control search-orders" placeholder="Warrent No">
                    </div>
                    <div class="form-group mb-3 col-md-3">
                        <label for="dateofwarrent" class="form-label">Date Of Warrent</label>
                        <input type="date" ng-model="data.dateofwarrent" class="form-control search-orders" placeholder="Date Of Warrent">
                    </div>
                    <div class="form-group mb-3 col-md-3">
                        <label for="amount" class="form-label">Amount</label>
                        <input type="text" ng-model="data.amount" class="form-control search-orders" placeholder="Amount">
                    </div>
                @* </div> *@
                <div class="text-center m-2 col-md-4">
                    <button type="submit" class="btn" style="background-color:#003980; color:white;">
                        Genrate Form
                    </button>
                </div>
            </div>
        </form>
    </div>
    <div id="printForm">
    <br>
    <br>
    <br>
    <h1 style="padding-top: 4pt; text-indent: 0pt; text-align: center">
      Request Form for Revalidation of Redemption/Dividend warrant
    </h1>
    <br>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: left">To</p>
    <p class="s1" style="padding-left: 5pt; text-indent: 0pt; text-align: left">
            @* KFin Technologies Ltd, *@ {{data.officename}}
    </p>
    <p class="s2" style="padding: 0 360px 0 5px;; text-indent: 0pt; text-align: left">
      @* Karvy Selenium Tower B, Plot No.31 &amp; 32, Gachibowli, Financial *@
            @* District, Nanakramguda, Serilingampally, Hyderabad, Telangana, 500032 *@{{data.officeaddress}}
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p
      style="
        padding-left: 5pt;
        text-indent: 0pt;
        line-height: 109%;
        text-align: left;
      "
    >
            Sub:Revalidation of Redemption/Dividend Warrant Ref:{{data.warrentno}} Folio No(s):<b>{{data.folioNo}}</b>
    </p>
    <p
      style="
        padding-top: 4pt;
        padding-left: 5pt;
        text-indent: 0pt;
        text-align: left;
      "
    >
      DearSir/Madam,
    </p>
    <p style="padding-top: 2pt; text-indent: 0pt; text-align: left"><br /></p>
    <p
      style="
        padding-left: 5pt;
        text-indent: 0pt;
        line-height: 109%;
        text-align: justify;
      "
    >
      I am unable to deposit then closed redemption/dividend warrantno.<u><b>{{data.warrentno}}</b></u>_ dated <u>
                <b>
                    {{ data.dateofwarrent | date: 'dd MMMM, yyyy'}}
                </b>
            </u>for Rs.<u><b>{{data.amount}}</b></u>, issued by you, as the bank account mentioned on the warrant is closed /
      incorrect.
      Hence I request you to update my New Bankdetails in your records,as mentioned below:
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <table
      style="border-collapse: collapse; margin-left: 7.5pt"
      cellspacing="0"
    >
      <tr style="height: 13pt">
        <td
          style="
            width: 120pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
          bgcolor="#BFBFBF"
        >
          <p style="text-indent: 0pt; text-align: left"><br /></p>
        </td>
        <td
          style="
            width: 365pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
          bgcolor="#BFBFBF"
        >
          <p
            class="s4"
            style="
              padding-left: 29pt;
              text-indent: 0pt;
              line-height: 11pt;
              text-align: left;
            "
          >
            Bank Particulars<span class="s5"
              >[Attach cancelled cheque copy orrelated documents]</span
            >
          </p>
        </td>
      </tr>
      <tr style="height: 17pt">
        <td
          style="
            width: 120pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
        >
          <p
            class="s4"
            style="
              padding-top: 3pt;
              padding-left: 3pt;
              text-indent: 0pt;
              text-align: left;
            "
          >
            BankName*
          </p>
        </td>
        <td
          style="
            width: 365pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
        >
          <p
            class="s6"
            style="
              padding-top: 3pt;
              padding-left: 3pt;
              text-indent: 0pt;
              text-align: left;
            "
          >
                        @* STATE BANK OF INDIA *@ {{data.bankname}}
          </p>
        </td>
      </tr>
      <tr style="height: 17pt">
        <td
          style="
            width: 120pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
        >
          <p
            class="s4"
            style="
              padding-top: 3pt;
              padding-left: 3pt;
              text-indent: 0pt;
              text-align: left;
            "
          >
            Branch
          </p>
        </td>
        <td
          style="
            width: 365pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
        >
          <p
            class="s6"
            style="
              padding-top: 3pt;
              padding-left: 3pt;
              text-indent: 0pt;
              text-align: left;
            "
          >
                        @* ALKAPURI BARODA *@ {{data.branch}}
          </p>
        </td>
      </tr>
      <tr style="height: 17pt">
        <td
          style="
            width: 120pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
        >
          <p
            class="s4"
            style="
              padding-top: 3pt;
              padding-left: 3pt;
              text-indent: 0pt;
              text-align: left;
            "
          >
            A/cType–A/cNo*
          </p>
        </td>
        <td
          style="
            width: 365pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
        >
          <p
            class="s6"
            style="
              padding-top: 3pt;
              padding-left: 3pt;
              text-indent: 0pt;
              text-align: left;
            "
          >
                        @* SAVING, 31********* *@ {{data.accounttype}}, {{data.accountno}}
          </p>
        </td>
      </tr>
      <tr style="height: 17pt">
        <td
          style="
            width: 120pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
        >
          <p
            class="s4"
            style="
              padding-top: 3pt;
              padding-left: 3pt;
              text-indent: 0pt;
              text-align: left;
            "
          >
            BankCity*
          </p>
        </td>
        <td
          style="
            width: 365pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
        >
          <p
            class="s6"
            style="
              padding-top: 3pt;
              padding-left: 3pt;
              text-indent: 0pt;
              text-align: left;
            "
          >
                        @* VADODARA, 390007 *@ {{data.bankcity}}
          </p>
        </td>
      </tr>
      <tr style="height: 17pt">
        <td
          style="
            width: 120pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
        >
          <p
            class="s4"
            style="
              padding-top: 3pt;
              padding-left: 3pt;
              text-indent: 0pt;
              text-align: left;
            "
          >
            MICRCode(9Digit)
          </p>
        </td>
        <td
          style="
            width: 365pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
        >
          <p
            class="s6"
            style="
              padding-top: 3pt;
              padding-left: 3pt;
              text-indent: 0pt;
              text-align: left;
            "
          >
                        {{data.micrcode}}
          </p>
        </td>
      </tr>
      <tr style="height: 17pt">
        <td
          style="
            width: 120pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
        >
          <p
            class="s4"
            style="
              padding-top: 3pt;
              padding-left: 3pt;
              text-indent: 0pt;
              text-align: left;
            "
          >
            IFSCCode(11Digit)
          </p>
        </td>
        <td
          style="
            width: 365pt;
            border-top-style: solid;
            border-top-width: 1pt;
            border-left-style: solid;
            border-left-width: 1pt;
            border-bottom-style: solid;
            border-bottom-width: 1pt;
            border-right-style: solid;
            border-right-width: 1pt;
          "
        >
          <p
            class="s6"
            style="
              padding-top: 3pt;
              padding-left: 3pt;
              text-indent: 0pt;
              text-align: left;
            "
          >
                        {{data.ifsccode}}
          </p>
        </td>
      </tr>
    </table>
    <p
      class="s7"
      style="padding-left: 5pt; text-indent: 0pt; text-align: justify"
    >
      * mandatory
    </p>
    <p style="padding-top: 4pt; text-indent: 0pt; text-align: left"><br /></p>
    <p
      style="
        padding-left: 5pt;
        text-indent: 0pt;
        line-height: 109%;
        text-align: left;
      "
    >
      Kindly arrange for the new redemption/dividend warrant of amount Rs.<u><b>{{data.amount}} </b></u>in my favor, with the above mentioned accountnumber to my registered address.
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="text-indent: 0pt; text-align: left" />
    <p style="text-indent: 0pt; text-align: left" />
    <p
      style="
        padding-left: 5pt;
        text-indent: 0pt;
        line-height: 217%;
        text-align: left;
      "
    >
      Encl.: □ Redemption Warrant □ Dividend Warrant First</span>
    </p>
    <p
    style="
      padding-left: 5pt;
      text-indent: 0pt;
      line-height: 217%;
      text-align: left;
    "
  >
      HolderName:<b>{{data.customerName}} </b></span>
  </p>
    <p
    style="
      padding-left: 5pt;
      text-indent: 0pt;
      line-height: 217%;
      text-align: left;
    "
  >SignatureoftheFirstHolder:<span class="s8"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
  </p>
    <p style="padding-top: 5pt; text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: left">
      Date:<span class="s8"> {{data.today | date:'dd/MM/yyyy'}}</span>
    </p>
     </div>
    <button class="btn btn-store" ng-click="printDiv('printForm')">Print</button>
  </body>
  <script>
        angular.module('Stock-CMS', []).controller('FormController', function ($scope, $http,$timeout) {
            $scope.customers = [];
             $scope.hDiv = true;
            var params = new URLSearchParams(window.location.search);
            var id = params.get('id');
            var id2 = params.get('id2');
            var isProcessing = false;

            // showLoader();

            $scope.nameofmonth = function(id){
                var monthsOfYear = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

                return monthsOfYear[id];
            }

             // Load Customers
        $scope.loadCustomers = function (sid) {

             if(id){
             var monthsOfYear = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                 $scope.hDiv = true;
            $http.get('/Enquiry/GetStocksById/'+id).then(function (response) {
                var result = response.data;
                 $http.get('/doc/getDocs/' + result.customer.id).then(function (response) {
                    $scope.doc = response.data;
                    var docs = $scope.doc.find(x => x.id === sid);
                      $http.get('/doc/GetBank/'+ docs.id).then(function (response) {
         var bank = response.data[0];
                $scope.data = {
                   customerName : docs.name,
                   today: new Date(),
                   folioNo : result.folioNo,
                   qty : result.qty,
                   officename : result.companyName,
                   officeaddress: 'C 101, 247 Park, L.B.S. Marg, Vikhroli (West), Mumbai, Maharashtra, 400083',
                   warrentno:'',
                   dateofwarrent:'',
                   amount:'',
                   bankname:bank.bankName,
                   branch: bank.branch,
                   accountno: bank.accountNo,
                   accounttype: bank.accountType,
                   bankcity:bank.postalAddress,
                   micrcode: bank.micrcode,
                   ifsccode: bank.ifsccode,
                };

             
                hideLoader();
                                    }, function (error) {
        console.error('Error loading Bank Deatails:', error);
        hideLoader();
    });
                }, function (error) {
                    console.error('Error loading Docs:', error);
                    hideLoader();
                });
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }

            if(id2){
                 $scope.hDiv = false;
            $http.get('/Form/GetGenratedFormById/'+id2).then(function (response) {
                var result = response.data;
                var obj = JSON.parse(result.jsonString);
                $scope.data = {
                    customerName: obj.customerName,
                    today: obj.today,
                    folioNo : obj.folioNo,
                    qty:obj.qty,
                   officename: obj.officename,
                   officeaddress: obj.officeaddress,
                   warrentno: obj.warrentno,
                   dateofwarrent: new Date(obj.dateofwarrent),
                   amount: obj.amount,
                   bankname: obj.bankname,
                   branch: obj.branch,
                   accountno: obj.accountno,
                   accounttype: obj.accounttype,
                   bankcity: obj.bankcity,
                   micrcode: obj.micrcode,
                   ifsccode: obj.ifsccode,
                };
                                id = result.stockId;

                   checkData();
                hideLoader();
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }
        };

                        function checkData() {
        if ($scope.data !== undefined) {
            // Delay the printDiv execution until the next digest cycle
            $timeout(function() {
                $scope.printDiv('printForm');
            }, 0);  // 0 delay to ensure it runs after the view update
        } else {
            setTimeout(checkData, 1000); // Retry after 1000ms if data is not yet available
        }
    }

          $scope.calculateAge = function(dob) {
      if (!dob) {
        return '';
      }
      var birthDate = new Date(dob);
      var currentDate = new Date();
      var age = currentDate.getFullYear() - birthDate.getFullYear();
      var m = currentDate.getMonth() - birthDate.getMonth();

      // Adjust age if the current month is before the birth month or if the birth day hasn't occurred yet
      if (m < 0 || (m === 0 && currentDate.getDate() < birthDate.getDate())) {
        age--;
      }
      return age;
    };

        $scope.navtogenerateform = function () {
        window.open('/Form/GenerateForm/'+id, '_self');
    };

        //Genrate Form
         $scope.genrateForm = function () {
             if(id){
             let jsonString = JSON.stringify($scope.data, null, 2);
             var data ={
                 formName : 'Revalidation red div',
                 StockId : id,
                 url : `/Form/Revalidationreddiv?id2=`,
                 jsonString : jsonString,
                 ClientName: $scope.data.customerName,
                 IsActive : true
             }

             const url = '/Form/GenrateForm';
                $http.post(url, data).then(function (response) {
                    if (response.data.success) {
                        Swal.fire({
                            title: 'Success',
                            text: response.data.message || 'Operation successful!',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        });
                        // $scope.loadCustomers();
                                                window.open(response.data.data.url + response.data.data.id,'_self')

                    } else {
                        Swal.fire({
                            title: 'Error!',
                            text: response.data.message || 'There was an issue adding the customer.',
                            icon: 'error',
                            confirmButtonText: 'Try Again'
                        });
                    }
                    isProcessing = false;
                }, function (error) {
                    Swal.fire({
                        title: 'Error',
                        text: 'An error occurred.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                    isProcessing = false;
                });
            //console.log(dataString);
            }
         }

            // Load Customers
            // $scope.loadCustomers = function () {
            //     $http.get('/Master/GetCustomers').then(function (response) {
            //         $scope.customers = response.data[0];
            //         hideLoader();
            //     }, function (error) {
            //         console.error('Error loading customers:', error);
            //         hideLoader();
            //     });
            // };

            // $scope.loadDocs = function () {
            //     if (true) {
            //         $http.get('/doc/getDocs/' + 1).then(function (response) {
            //             $scope.docs = response.data;
            //             hideLoader();
            //         }, function (error) {
            //             console.error('Error loading Docs:', error);
            //             hideLoader();
            //         });
            //     }
            // };

            //Function
            $scope.printDiv = function (divId) {
                        var css ='<style type="text/css">* { margin: 0; padding: 0; text-indent: 0; } h1 { color: black; font-family: "Trebuchet MS", sans-serif; font-style: normal; font-weight: bold; text-decoration: underline; font-size: 11pt; } p { color: black; font-family: "Trebuchet MS", sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 10pt; margin: 0pt; } .s1 { color: black; font-family: Arial, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; } .s2 { color: black; font-family: Arial, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; } .s4 { color: black; font-family: "Trebuchet MS", sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 10pt; } .s5 { color: black; font-family: "Trebuchet MS", sans-serif; font-style: italic; font-weight: bold; text-decoration: none; font-size: 9pt; } .s6 { color: black; font-family: "Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 9pt; } .s7 { color: black; font-family: "Trebuchet MS", sans-serif; font-style: italic; font-weight: normal; text-decoration: none; font-size: 8pt; } .s8 { color: black; font-family: "Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 10pt; } table, tbody { vertical-align: top; overflow: visible; }</style>';
                var innerContents = document.getElementById(divId).innerHTML;
                var popupWinindow = window.open('', '_blank', 'width=600,height=700,scrollbars=no,menubar=no,toolbar=no,location=no,status=no,titlebar=no');
                popupWinindow.document.open();
                popupWinindow.document.write('<html><head><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">' + css + '</ head > <body style="padding-left: 0 8% 0 8% ;"onload="window.print()">' + innerContents + '</html>');
                popupWinindow.document.close();
            };
            //Initialize
            $scope.loadCustomers();
            // $scope.loadDocs();
        });
</script>
</html>
