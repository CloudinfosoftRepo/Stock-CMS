<html lang="en" ng-app="Stock-CMS">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Surety affidavit</title>
    <style type="text/css">
      * {
        margin: 0;
        padding: 0;
        text-indent: 0;
      }
      h1 {
        color: black;
        font-family: "Times New Roman", serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: none;
        font-size: 12pt;
      }
      .p,
      p {
        color: black;
        font-family: "Times New Roman", serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 12pt;
        margin: 0pt;
      }
      .s3 {
        color: black;
        font-family: "Times New Roman", serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 12pt;
      }
      table,
      tbody {
        vertical-align: top;
        overflow: visible;
      }
      .table-container {
    border-collapse: collapse;
    margin-left: 5.5pt;
  }
  .table-cell {
    border: 1px solid black;
    padding: 2pt;
    vertical-align: middle;
  }
  .table-cell p {
    margin: 0;
    text-indent: 0;
    text-align: left;
  }
  .table-header {
    padding-top: 3pt;
  }
  .table-subheader {
    padding-top: 2pt;
  }
  .table-subheader-name {
    padding-top: 2pt;
    padding-left: 1pt;
  }

        .card {
            border-radius: 10px;
            overflow: hidden;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .form-select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 1rem;
        }

        .btn-primary {
            width: 100%;
            padding: 12px 16px;
            text-transform: uppercase;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

            .btn-primary:hover {
                background-color: #0056b3;
                transform: scale(1.05);
            }

        .mybtn {
            background-color: #51b37f !important;
            color: white !important;
            width: auto !important;
        }

        .myarea {
            justify-content: center !important;
            display: flex !important;
            margin-top: 25px !important;
        }
    </style>
  </head>
<body style="padding: 5%;" ng-controller="FormController">
    <div class="row align-items-center">
        <!-- Arrow Icon aligned to the left -->
        <a class="col-md-1 text-start" style="font-size:35px;" ng-click="navtogenerateform()">
            <i class="bi bi-arrow-left"></i>
        </a>

        <!-- Centered Heading -->
        <div class="col-md-10 text-center">
            <h3>Surety affidavit</h3>
        </div>
    </div>
    <div ng-if="hDiv" class="container my-5">
        <div class="card shadow-sm">
            <div class="card-body">
                <form name="gForm" ng-submit="addSurityData()">
                    <h4 class="card-title text-center mb-4" style="color:#51b37f;">Add Surety Data</h4>

                    <div class="row">
                        <!-- Select Customer Dropdown -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="seletedId" class="form-label">Select Customer</label>
                                <select class="form-select" id="seletedId" ng-options="f.id as f.name for f in docs" ng-model="seletedId" ng-change="loadCustomers(seletedId, heirId)">
                                    <option selected disabled value="">Select customer</option>
                                </select>
                            </div>
                        </div>

                        <!-- Select Heir Dropdown -->
                        <div class="col-md-4 mb-3" ng-show="legalheirlist">
                            <div class="form-group">
                                <label for="heirId" class="form-label">Select Heir</label>
                                <select class="form-select" id="heirId" ng-options="g.id as g.name for g in heir" ng-model="heirId" ng-change="loadCustomers(seletedId, heirId)">
                                    <option selected disabled value="">Select Heir</option>
                                </select>
                            </div>
                        </div>

                        <!-- Surety Name -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="suretyname" class="form-label">Surety Name</label>
                                <input type="text" ng-model="surity.suretyname" class="form-control" placeholder="Surety Name">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <!-- Age -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="age" class="form-label">Age</label>
                                <input type="text" ng-model="surity.age" class="form-control" placeholder="Age">
                            </div>
                        </div>
                       
                        <!-- Surety Address -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="suretyaddress" class="form-label">Surety Address</label>
                                <textarea id="suretyaddress" ng-model="surity.suretyaddress" class="form-control" placeholder="Surety Address"></textarea>
                            </div>
                        </div>

                        <!-- Know The Applicant in Years -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="knowtheapplicant" class="form-label">Know The Applicant in Years</label>
                                <input type="text" ng-model="surity.knowtheapplicant" class="form-control" placeholder="Know The Applicant in Years">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <!-- Business Address -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="bussinessaddress" class="form-label">Business Address</label>
                                <textarea id="bussinessaddress" ng-model="surity.bussinessaddress" class="form-control" placeholder="Business Address"></textarea>
                            </div>
                        </div>
                       
                        <!-- PAN No -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="panno" class="form-label">PAN No</label>
                                <input type="text" ng-model="surity.panno" class="form-control" placeholder="PAN No">
                            </div>
                        </div>

                        <!-- Net Assets Worth -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="netassetsworth" class="form-label">Net Assets Worth</label>
                                <input type="text" ng-model="surity.netassetsworth" class="form-control" placeholder="Net Assets Worth">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <input type="radio" ng-model="incomesource" value="Employed" /> Employed
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <input type="radio" ng-model="incomesource" value="Self Bussiness" /> Self Bussiness
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <input type="radio" ng-model="incomesource" value="Self Assets" /> Self Assets
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <!-- Annual Salary Income -->
                        <div class="col-md-4 mb-3" ng-show="incomesource == 'Employed'">
                            <div class="form-group">
                                <label for="annualsalaryincome" class="form-label">Annual Salary Income</label>
                                <input type="text" ng-model="surity.annualsalaryincome" class="form-control" placeholder="Annual Salary Income">
                            </div>
                        </div>

                        <!-- Employer Name -->
                        <div class="col-md-4 mb-3" ng-show="incomesource == 'Employed'">
                            <div class="form-group">
                                <label for="employername" class="form-label">Employer Name</label>
                                <input type="text" ng-model="surity.employername" class="form-control" placeholder="Employer Name">
                            </div>
                        </div>

                        <!-- Self Owned Business Annual Income -->
                        <div class="col-md-4 mb-3" ng-show="incomesource == 'Self Bussiness'">
                            <div class="form-group">
                                <label for="selfbussinessannualincome" class="form-label">Self Owned Business Annual Income</label>
                                <input type="text" ng-model="surity.selfbussinessannualincome" class="form-control" placeholder="Self Owned Business Annual Income">
                            </div>
                        </div>

                        <!-- Asset worth of self-owned Immovable Property -->
                        <div class="col-md-4 mb-3" ng-show="incomesource == 'Self Assets'">
                            <div class="form-group">
                                <label for="worthofselfimmovableproperty" class="form-label">Asset Worth of Self Owned Immovable Property</label>
                                <input type="text" ng-model="surity.worthofselfimmovableproperty" class="form-control" placeholder="Asset Worth of Self Owned Immovable Property">
                            </div>
                        </div>
                     </div>
                    <div class="row">
                        <!-- Witness Name -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="witnessname" class="form-label">Witness Name</label>
                                <input type="text" ng-model="surity.witnessname" class="form-control" placeholder="Witness Name">
                            </div>
                        </div>

                        <!-- Witness Address -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="witnessaddress" class="form-label">Witness Address</label>
                                <textarea id="witnessaddress" ng-model="surity.witnessaddress" class="form-control" placeholder="Witness Address"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="col-md-4 text-center m-2">
                        <button type="submit" class="btn btn-primary" style="background-color:#51b37f; color:white; border-radius: 5px;">
                            ADD
                        </button>
                    </div>
                </form>

                <!-- Generate Form Button -->
                <div class="text-center m-2 col-md-4">
                    <button type="submit" ng-disabled="processdone" class="btn btn-primary" ng-click="genrateForm()" style="background-color:#51b37f; color:white; border-radius: 5px;">
                        Generate Form
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="printForm">
    <h1
      style="
        padding-top: 30pt;
        padding-left: 5pt;
        text-indent: 0pt;
        text-align: left;
      "
    >
      Surety
    </h1>
    <p
      style="
        padding-top: 6pt;
        padding-left: 5pt;
        text-indent: 0pt;
        text-align: left;
        line-height: 1.5;
      "
    >
            We<div ng-repeat="s in surityList">
                <u>
                    {{s.suretyname}}
                </u>(name of the Surety No.{{$index+1}}) aged <u> {{s.age}} </u>years,an Indian inhabitant presently residing at<u>
                    {{s.suretyaddress}}
      </u>
                (residential address of Surety No.{{ $index+1 }}) know the applicant(s) for last
                <u>{{ s.knowtheapplicant}}</u> years and having business address at  <u>
                    {{s.bussinessaddress}}
            </u>
                (official address of Surety No.{{ $index+1 }}), having PAN Card No.<u>
                    {{ s.panno}}
            </u>with net assets worth of Rs.
      <u>
                    {{s.netassetsworth}}
                </u><span ng-show="surityList.length > 1">and</span>
            </div>
    @*   and  <u> *@
    @*   7VE3 </u *@
    @*   >(name of the Surety No.2) aged <u>53 </u>years, an Indian inhabitant *@
    @*   residing at      (residential address of Surety No.2) know the applicant(s) for last *@
    @*   <u>10 </u>years and having PAN Card No.<u> *@
    @*     BDFRGDXGFB </u *@
    @*   >,business address at      <u> *@
    @*     VDF153VD </u *@
    @*   >(official address of Surety No.2) and with the net assets worth of Rs. *@
    @*   <u> DSVVDSV DS DV DF FD</u>. *@
    @* </p> *@
    
    <p
      style="
        padding-top: 6pt;
        padding-left: 5pt;
        text-indent: 0pt;
        text-align: justify;
      "
    >

    </p>
    <p
      style="
        padding-top: 6pt;
        padding-left: 5pt;
        text-indent: 0pt;
        text-align: justify;
      "
    >
      We, the undersigned certify that the above facts are true to the best of
      our knowledge. We bind ourselves as sureties to make good all claims,
      charges, costs, damages, demands, expenses and losses which the issuer
      Company, its successors and assigns its estate and effects and its
      directors, manager, secretary and shareholders may sustain, incur or be
      liable for in consequence of complying with the request contained above
      and the issuer Company, its successors, assigns, directors, manager,
      secretary and shareholders will be entitled to realise all claims,
      charges, cots, damages, demands, expenses and losses from our persons and
      our properties, as the case may be.
    </p>
        <div ng-repeat="s in surityList">
    <h1
      style="
        padding-top: 13pt;
        padding-left: 5pt;
        text-indent: 0pt;
        text-align: justify;
      "
    >
                <u>SURETY</u> {{$index+1}} :
        </h1>
            <button ng-show="btnhide" type="button" class="btn btnp-del" ng-click="DeleteData(s)" style="background-color:red; color:white;">
                Remove
            </button>
    <p style="padding-top: 1pt; text-indent: 0pt; text-align: left"></p>
    <table class="table-container" cellspacing="0">
      <tr style="height: 42pt">
        <td class="table-cell table-header" style="width: 198pt;">
          <p>Name :</p>
        </td>
        <td class="table-cell" style="width: 300pt;">
                    <p>{{s.suretyname}}</p>
        </td>
      </tr>
      <tr style="height: 41pt">
        <td class="table-cell table-subheader" style="width: 198pt;">
          <p>Annual Salary Income :</p>
        </td>
        <td class="table-cell" style="width: 300pt;">
                    <p>{{s.annualsalaryincome}}</p>
        </td>
      </tr>
      <tr style="height: 41pt">
        <td class="table-cell table-subheader-name" style="width: 198pt;">
          <p>Name of Employer :</p>
        </td>
        <td class="table-cell" style="width: 300pt;">
                    <p>{{s.employername}}</p>
        </td>
      </tr>
    </table>
    <p style="text-indent: 0pt; line-height: 13pt; text-align: left"><br /></p>
    <p style="text-indent: 0pt; text-align: center">OR</p>
    <p style="text-indent: 0pt; line-height: 13pt; text-align: left"><br /></p>
    <table style="border-collapse: collapse; margin-left: 5.5pt" cellspacing="0">
      <tr style="height: 41pt">
        <td class="table-cell table-subheader-name" style="width: 198pt; border: 1px solid black; padding: 5px;">
          <p style="margin: 0;">Self owned Business Annual Income:</p>
        </td>
        <td class="table-cell" style="width: 300pt; border: 1px solid black; padding: 5px;">
                    <p style="margin: 0;">{{s.selfbussinessannualincome}}</p>
        </td>
      </tr>
    </table>
       
    
    <!-- <p style="text-indent: 0pt; line-height: 13pt; text-align: left">
      Self owned Business Annual Income
    </p> -->

    <p style="padding-top: 7pt; text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 2pt; text-indent: 0pt; text-align: center">OR</p>
    <p style="text-indent: 0pt; line-height: 13pt; text-align: left"><br /></p>
    <table class="table-container" cellspacing="0">
      <tr style="height: 34pt">
        <td class="table-cell table-asset" style="width: 198pt;">
          <p class="s3 table-header">Asset worth of self owned Immovable Property :</p>
        </td>
        <td class="table-cell" style="width: 198pt;">
                    <p class="table-empty-cell">{{s.worthofselfimmovableproperty}}</p>
        </td>
      </tr>
      <tr style="height: 35pt">
        <td class="table-cell table-cell-center" style="width: 198pt;">
          <p class="s3 table-header">Signature of Surety :</p>
        </td>
        <td class="table-cell" style="width: 198pt;">
          <p class="table-empty-cell"></p>
        </td>
      </tr>
    </table>
    
    <table class="table-container" cellspacing="0">
      <tr style="height: 61pt">
        <td class="table-cell table-cell-left" style="width: 160pt;">
          <p class="s3 table-header">Name and Address of Witness :</p>
        </td>
        <td class="table-cell" style="width: 298pt;">
                    <p class="table-empty-cell">{{s.witnessname}},<br />{{s.witnessaddress}}</p>
        </td>
      </tr>
      <br>
      <tr style="height: 20pt">
        <td class="table-cell table-cell-left" style="width: 160pt;">
          <p class="s3 table-header">Signature of Witness:</p>
        </td>
        <td class="table-cell" style="width: 298pt;">
          <p class="table-empty-cell"></p>
        </td>
      </tr>
    </table>
        </div>


    @* <p style="text-indent: 0pt; text-align: left"><br /></p> *@
    @* <h1 style="padding-left: 5pt; text-indent: 0pt; text-align: left"> *@
    @*   <u>SURETY</u> 2 : *@
    @* </h1> *@
    @* <p style="padding-top: 2pt; text-indent: 0pt; text-align: left"><br /></p> *@
    @* <table style="border-collapse: collapse; margin-left: 5.5pt" cellspacing="0"> *@
    @*   <tr style="height: 41pt"> *@
    @*     <td class="table-cell" style="width: 198pt; border: 1px solid black; padding: 2px;"> *@
    @*       <p style="margin: 0; text-align: left;">Name :</p> *@
    @*     </td> *@
    @*     <td class="table-cell" style="width: 300pt; border: 1px solid black; padding: 2px;"> *@
    @*       <p style="margin: 0; text-align: left;">travdk yhbc</p> *@
    @*     </td> *@
    @*   </tr> *@
    @*   <tr style="height: 41pt"> *@
    @*     <td class="table-cell" style="width: 198pt; border: 1px solid black; padding: 3px;"> *@
    @*       <p style="margin: 0; text-align: left;">Annual Salary Income :</p> *@
    @*     </td> *@
    @*     <td class="table-cell" style="width: 300pt; border: 1px solid black; padding: 3px;"> *@
    @*       <p style="margin: 0; text-align: left;">150000</p> *@
    @*     </td> *@
    @*   </tr> *@
    @*   <tr style="height: 41pt"> *@
    @*     <td class="table-cell" style="width: 198pt; border: 1px solid black; padding: 3px;"> *@
    @*       <p style="margin: 0; text-align: left;">Name of Employer :</p> *@
    @*     </td> *@
    @*     <td class="table-cell" style="width: 300pt; border: 1px solid black; padding: 3px;"> *@
    @*       <p style="margin: 0; text-align: left;">trewq</p> *@
    @*     </td> *@
    @*   </tr> *@
    @* </table> *@
    
    @* <p style="text-indent: 0pt; text-align: left"><br /></p> *@
    @* <p style="text-indent: 0pt; text-align: center">OR</p> *@
    @* <table style="border-collapse: collapse; margin-left: 5.5pt" cellspacing="0"> *@
    @*   <tr style="height: 20pt"> *@
    @*     <td class="table-cell" style="width: 249pt; border: 1px solid black; padding: 2px;"> *@
    @*       <p style="margin: 0; text-align: left;">Self owned Business Annual Income :</p> *@
    @*     </td> *@
    @*     <td class="table-cell" style="width: 249pt; border: 1px solid black; padding: 2px;"> *@
    @*       <p style="margin: 0; text-align: left;">qsczse124</p> *@
    @*     </td> *@
    @*   </tr> *@
    @* </table> *@
    
    @* <p style="padding-left: 2pt; text-indent: 0pt; text-align: center">OR</p> *@
    @* <table style="border-collapse: collapse; margin-left: 5.5pt" cellspacing="0"> *@
    @*   <tr style="height: 34pt"> *@
    @*     <td class="table-cell" style="width: 249pt; border: 1px solid black; padding: 2px;"> *@
    @*       <p style="margin: 0; text-align: left;">Asset worth of self owned Immovable Property :</p> *@
    @*     </td> *@
    @*     <td class="table-cell" style="width: 249pt; border: 1px solid black; padding: 2px;"> *@
    @*       <p style="margin: 0; text-align: left;"></p> *@
    @*     </td> *@
    @*   </tr> *@
    @* </table> *@
    
    @* <p style="padding-top: 1pt; text-indent: 0pt; text-align: left"><br /></p> *@
    @* <table style="border-collapse: collapse; margin-left: 5.5pt" cellspacing="0"> *@
    @*   <tr style="height: 48pt"> *@
    @*     <td class="table-cell" style="width: 249pt; border: 1px solid black; padding: 3px;"> *@
    @*       <p style="margin: 0; text-align: left;">Signature of Second Surety:</p> *@
    @*     </td> *@
    @*     <td class="table-cell" style="width: 249pt; border: 1px solid black; padding: 3px;"> *@
    @*       <p style="margin: 0; text-align: left;">trgw</p> *@
    @*     </td> *@
    @*   </tr> *@
    @* </table> *@
    
    @* <p style="padding-top: 8pt; text-indent: 0pt; text-align: left"><br /></p> *@
    @* <table style="border-collapse: collapse; margin-left: 5.5pt" cellspacing="0"> *@
    @*   <tr style="height: 60pt"> *@
    @*     <td class="table-cell" style="width: 200pt; border: 1px solid black; padding: 2px; text-align: center;"> *@
    @*       Name and Address of Witness: *@
    @*     </td> *@
    @*     <td class="table-cell" style="width: 298pt; border: 1px solid black; padding: 2px; text-align: left;"> *@
    @*       hrGSE516G15 51GSE561 *@
    @*     </td> *@
    @*   </tr> *@
    @*   <tr style="height: 20pt"> *@
    @*     <td class="table-cell" style="width: 200pt; border: 1px solid black; padding: 3px; text-align: center;"> *@
    @*       Signature of Witness: *@
    @*     </td> *@
    @*     <td class="table-cell" style="width: 298pt; border: 1px solid black; padding: 3px; text-align: left;"> *@
    @*       UIAEL *@
    @*     </td> *@
    @*   </tr> *@
    @* </table> *@
    
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <h1 style="padding-left: 5pt; text-indent: 0pt; text-align: left">
      Dated this
      <u
        >@* {{data.day}} *@ &emsp; &emsp; </u
      >day of
            <u>@* {{data.month}}  *@<u> &emsp;&emsp;&emsp;</u></u><span class="p"> </span>@* {{data.year}} *@20<u> &emsp;&emsp;</u>.
    </h1>
    </div>
    <div class="myarea">
        <button class="btn btn-store mybtn" ng-click="printDiv('printForm')">PRINT</button>
    </div>
  </body>
<script>
            angular.module('Stock-CMS', []).controller('FormController', function ($scope, $http,$timeout) {
                $scope.surity = {};
                 $scope.surityList = [];
                $scope.data = undefined;
                $scope.hDiv = true;
                var params = new URLSearchParams(window.location.search);
                var id = params.get('id');
                var id2 = params.get('id2');
                $scope.incomesource = "Employed";
                $scope.btnhide = id2 === null ? true : false;
                var isProcessing = false;
                $scope.processdone = false;

                // showLoader();

            $scope.addSurityData = function() {
                if ($scope.surity != {}) {
                    $scope.surityList.push($scope.surity);

                    $scope.surity = {};

                    console.log('Surity data added:', $scope.surityList);
                } else {
                    alert('Please fill in the required fields');
                }
            }

                // Load Customers
         $scope.loadCustomers = function (sid,hid) {
         if(id){
             hideLoader();
             var currentDate = new Date();
         var monthsOfYear = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
             $scope.hDiv = true;
        $http.get('/Enquiry/GetStocksById/'+id).then(function (response) {
            var result = response.data;
            $http.get('/Form/GetHolderByStockId/' +  id).then(function (response) {
                 $scope.docs = response.data;
                var doc = $scope.docs.find(x => x.id === sid);

                 var isDeceased = !!doc?.dateOfDeath;

                if (isDeceased) {
                    $scope.heirId = null;
    $scope.legalheirlist = isDeceased;
    document.getElementById('heirId').value = '';
                    $http.get('/LegalHeir/GetClaimentLegalHeir/' + doc.id).then(function (response) {
                        $scope.heir = response.data;
                        var heirs = response.data.find(x => x.id === hid); // `hid` needs to be in scope
                        var holder = heirs;

                        populateData(holder, result,$scope.heir,isDeceased);
                    }, function (error) {
                        console.error('Error loading legal heir data:', error);
                        hideLoader();
                    });
                } else {
                    $scope.heirId = null;
    $scope.data = null;
    $scope.legalheirlist = isDeceased;
    document.getElementById('heirId').value = '';
                    var holder = doc;
                    populateData(holder, result,$scope.heir,isDeceased);
                }

            hideLoader();
            }, function (error) {
                console.error('Error loading Docs:', error);
                hideLoader();
            });
        }, function (error) {
            console.error('Error loading customers:', error);
            hideLoader();
        });
        }

        if(id2){
             $scope.hDiv = false;
        $http.get('/Form/GetGenratedFormById/'+id2).then(function (response) {
            var result = response.data;
            var obj = JSON.parse(result.jsonString);
            $scope.data = {
                docid: obj.docid,
                customerName: obj.customerName,
                surity : JSON.parse(obj.surity),
                day: obj.day,
                month:obj.month,
                year:obj.year,
                condition: obj.condition,
            };  
            $scope.surityList =  $scope.data.surity;
                            id = result.stockId;

            checkData();
            hideLoader();
        }, function (error) {
            console.error('Error loading customers:', error);
            hideLoader();
        });
        }

        function populateData(holder, result, heirlist,isDeceased) {
             var arr = angular.copy($scope.surityList);
            $scope.data = {
                docid: holder.id,
                customerName: holder.name,
                surity: JSON.stringify(arr, null, 2),
                day: currentDate.getDate(),
                month: monthsOfYear[currentDate.getMonth()],
                year: currentDate.getFullYear(),
                condition: isDeceased,
            };
        }
    };

        $scope.navtogenerateform = function () {
        window.open('/Form/GenerateForm/'+id, '_self');
    };

    $scope.DeleteData = function(item) {
        var index = $scope.surityList.indexOf(item);
                if (index !== -1) {
                    $scope.surityList.splice(index, 1);
                }
    }

    function checkData() {
        if ($scope.data !== undefined) {
            // Delay the printDiv execution until the next digest cycle
            $timeout(function() {
            $scope.printDiv('printForm');
            }, 0);  // 0 delay to ensure it runs after the view update
        } else {
            setTimeout(checkData, 1000); // Retry after 1000ms if data is not yet available
        }
    }

    //Genrate Form
     $scope.genrateForm = function () {

          var arr = angular.copy($scope.surityList);
                      $scope.data.surity = JSON.stringify(arr, null, 2);
         if(id){
             $scope.processdone = true;
         let jsonString = JSON.stringify($scope.data, null, 2);
         var data ={
             formName : 'Surety Affidavi',
             StockId : id,
             url : `/Form/SuretyAffidavit?id2=`,
             jsonString : jsonString,
             ClientName: $scope.data.customerName,
              ClientId: $scope.data.docid,
             IsActive : true
         }

         const url = '/Form/GenrateForm';
            $http.post(url, data).then(function (response) {
                if (response.data.success) {
                    Swal.fire({
                        title: 'Success',
                        text: response.data.message || 'Operation successful!',
                        icon: 'success',
                        confirmButtonText: 'OK'
                    });
                    $scope.processdone = false;
                    // $scope.loadCustomers();
                    window.open(response.data.data.url + response.data.data.id,'_self')

                } else {
                    Swal.fire({
                         title: 'This Form is already Exits',
                         text: "do you want to go to that form?",
                         icon: 'warning',
                         showCancelButton: true,
                         confirmButtonText: 'Yes',
                         cancelButtonText: 'No'
                     }).then((result) => {
                         if (result.isConfirmed) {
                             window.open(response.data.message, '_self');
                         }
                 });
                 $scope.processdone = false;
                }
                isProcessing = false;
            }, function (error) {
                Swal.fire({
                    title: 'Error',
                    text: 'An error occurred.',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
                $scope.processdone = false;
                isProcessing = false;
            });
        //console.log(dataString);
        }
     }

                // Load Customers
                // $scope.loadCustomers = function () {
                //     $http.get('/Master/GetCustomers').then(function (response) {
                //         $scope.customers = response.data[0];
                //         hideLoader();
                //     }, function (error) {
                //         console.error('Error loading customers:', error);
                //         hideLoader();
                //     });
                // };

                // $scope.loadDocs = function () {
                //     if (true) {
                //         $http.get('/doc/getDocs/' + 1).then(function (response) {
                //             $scope.docs = response.data;
                //             hideLoader();
                //         }, function (error) {
                //             console.error('Error loading Docs:', error);
                //             hideLoader();
                //         });
                //     }
                // };

                //Function
                $scope.printDiv = function (divId) {
                        var css ='<style type="text/css"> * { margin: 0; padding: 0; text-indent: 0; } h1 { color: black; font-family: "Times New Roman", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; } .p, p { color: black; font-family: "Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; margin: 0pt; } .s3 { color: black; font-family: "Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; } table, tbody { vertical-align: top; overflow: visible; } .table-container { border-collapse: collapse; margin-left: 5.5pt; } .table-cell { border: 1px solid black; padding: 2pt; vertical-align: middle; } .table-cell p { margin: 0; text-indent: 0; text-align: left; } .table-header { padding-top: 3pt; } .table-subheader { padding-top: 2pt; } .table-subheader-name { padding-top: 2pt; padding-left: 1pt; }.btnp-del { display: none; }</style>';
                    var innerContents = document.getElementById(divId).innerHTML;
                    var popupWinindow = window.open('', '_blank', 'width=600,height=700,scrollbars=no,menubar=no,toolbar=no,location=no,status=no,titlebar=no');
                    popupWinindow.document.open();
                    popupWinindow.document.write('<html><head><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">' + css + '</ head > <body style="padding-left: 0 8% 0 8% ;"onload="window.print()">' + innerContents + '</html>');
                    popupWinindow.document.close();
                };
                //Initialize
                $scope.loadCustomers();
                // $scope.loadDocs();
            });
</script>
</html>
