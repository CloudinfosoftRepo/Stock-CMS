<html lang="en" ng-app="Stock-CMS">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Change of Address - correspondence</title>
    <style type="text/css">
      * {
        margin: 0;
        padding: 0;
        text-indent: 0;
      }
      h1 {
        color: black;
        font-family: Calibri, sans-serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: none;
        font-size: 16pt;
      }
      .s1 {
        color: black;
        font-family: Calibri, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 14pt;
      }
      .s2 {
        color: black;
        font-family: Calibri, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 12pt;
      }
      h3 {
        color: black;
        font-family: Calibri, sans-serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: none;
        font-size: 11pt;
      }
      .p,
      p {
        color: black;
        font-family: Calibri, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 11pt;
        margin: 0pt;
      }
      h2 {
        color: black;
        font-family: Calibri, sans-serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: none;
        font-size: 12pt;
      }
    </style>
  </head>
<body style="padding-left: 15%;" ng-controller="FormController">
    <div ng-if="hDiv">
        <form name="gForm" ng-submit="genrateForm()">
            <div class="row">
                <div class="form-group mb-3">
                    <label for="seletedid" class="form-label">select customer</label>
                    <select class="form-select w-auto" ng-options="f.id as f.name for f in doc" ng-model="seletedid" ng-change="loadCustomers(seletedid)">
                        <option selected disabled value="">Select customer</option>
                    </select>
                </div>
                @* <div class="col-md-4"> *@
                <div class="form-group mb-3 col-md-4">
                    <label for="newaddress" class="form-label">Address</label>
                    <textarea id="address" ng-model="data.newaddress"
                              class="form-control" style="height: 100px; width: 100%;" placeholder="Old Address" rows="5" cols="5" required></textarea>
                </div>
                @* </div> *@
                <div class="text-center m-2 col-md-4">
                    <button type="submit" class="btn" style="background-color:#003980; color:white;">
                        Genrate Form
                    </button>
                </div>
            </div>
        </form>
    </div>
    <div id="printForm">
    <table style="border-collapse: collapse; margin-left: 6.5pt"
    cellspacing="0">
 <tr style="height: 14pt">
     <td style="
     width: 231pt;
   ">
         <p class="s2"
            style="
       padding-left: 1pt;
       text-indent: 0pt;
       line-height: 13pt;
       text-align: left;
     ">
             
         </p>
     </td>
  
 </tr>
 <tr style="height: 16pt">
     <td style="
     width: 231pt;
   ">
         <p class="s2"
            style="
       padding-left: 5pt;
       text-indent: 0pt;
       line-height: 14pt;
       text-align: left;
     ">
                        {{data.customerName}},{{data.holders}}
                 {{data.address}}
                        {{data.mobile}}
         </p>
     </td>
      
 </tr>

 
</table>
      <!-- <p style="padding-left: 5pt; text-indent: 0pt; text-align: left;"> 
          <h1>
            JYOTSNABEN G PATEL <br />
          GHANSHYAMBHAI G PATEL<br />
          </h1>
          51 W DEVON AVE<br />
          GLENDALE HEIGHTS, ILLINOIS 60139  <br />
          M. No. 9428171249<br />
      </p> -->
    
    <hr>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="text-indent: 0pt; text-align: left" />
    <p
      class="s2"
      style="padding-left: 41pt; text-indent: 0pt; text-align: left"
    >
      TO
    </p>
    <p
      class="s2"
      style="padding-left: 41pt; text-indent: 0pt; text-align: left"
    >
            @* KFINTECH PVT. LTD *@{{data.officename}}
    </p>
    <p
      class="s2"
      style="
        padding-top: 2pt;
        padding-left: 41pt;
        text-indent: 0pt;
        line-height: 114%;
        text-align: left;
      "
    >
      @* KARVY SELENIUM, TOWER- B, PLOT NO. 31 &amp; 32., FINANCIAL DISTRICT, *@
            @* NANAKRAMGUDA, HYDERABAD, TELANGANA, 500032. *@{{data.officeaddress}}
    </p>
    <p style="padding-top: 1pt; text-indent: 0pt; text-align: left"><br /></p>
    <h3 style="padding-left: 207pt; text-indent: 0pt; text-align: left">
      SUB: Change of Address: <span class="p">-</span>
    </h3>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <h3 style="padding-left: 41pt; text-indent: 0pt; text-align: left">
            Unit: <u>@* APOLLO TYRES LTD *@{{data.officename}}</u>
            <span class="p">(Company Name) Folio No. : -{{data.folioNo}}</span>
    </h3>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 41pt; text-indent: 0pt; text-align: left">
      Dear Sir/Madam,
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <h3 style="padding-left: 41pt; text-indent: 0pt; text-align: left">
      Please update my correspondence address as mentioned below in your
      records.
    </h3>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <h2 style="padding-left: 41pt; text-indent: 0pt; text-align: left">
            {{data.customerName}},{{data.holders}}
    </h2>
    <p
      class="s2"
      style="padding-left: 41pt; text-indent: 0pt; text-align: left"
    >
      c/o @* KRUNAL VINODKUMAR CHHAGANI *@
    </p>
    <p
      class="s2"
      style="padding-left: 41pt; text-indent: 0pt; text-align: left"
    >
      @* B-204, RATNADEEP GREENS APPARTMENT, DABHOI ROAD, B/S M M VOHRA SHOW ROOM, *@
            @* SOMA TALAV, VADODARA, GUJARAT, 390025 *@{{data.newaddress}}
    </p>
    <p
      style="
        padding-top: 13pt;
        padding-left: 41pt;
        text-indent: 0pt;
        text-align: left;
      "
    >
      My current Address as per your records is as below (Give current address
      for verification from our record)
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p
      class="s2"
      style="padding-left: 106pt; text-indent: 0pt; text-align: left"
    >
            @* 51 W DEVON AVE GLENDALE HEIGHTS, ILLINOIS - 60139 *@{{data.address}}
    </p>
    <p
      style="
        padding-top: 13pt;
        padding-left: 41pt;
        text-indent: 0pt;
        text-align: left;
      "
    >
      I/We hereby certify that the particulars given above are true to the best
      of my knowledge and all future communication related to my holding in the
      company should be sent to my new address.
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 41pt; text-indent: 0pt; text-align: left">
      Holder(s) Signature(s)
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <h3 style="padding-left: 42pt; text-indent: 0pt; text-align: left">
            @* JYOTSNABEN G PATEL GHANSHYAMBHAI G PATEL *@{{data.customerName}},{{data.holders}}
    </h3>
    </div>
        <button class="btn btn-store" ng-click="printDiv('printForm')">Print</button>
  </body>
 <script>
    angular.module('Stock-CMS', []).controller('FormController', function ($scope, $http) {
        $scope.customers = [];
         $scope.hDiv = true;
            var params = new URLSearchParams(window.location.search);
            var id = params.get('id');
            var id2 = params.get('id2');
        var isProcessing = false;

        // showLoader();

        // Load Customers

        $scope.loadCustomers = function (sid) {

             if(id){
                 var currentDate = new Date();
             var monthsOfYear = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                 $scope.hDiv = true;
            $http.get('/Enquiry/GetStocksById/'+id).then(function (response) {
                var result = response.data;
                let holders = [
                        result.firstHolder || '',
                        result.secondHolder || '',
                        result.thirdHolder || ''
                    ].filter(holder => holder.trim() !== '');
                 $http.get('/doc/getDocs/' + result.customer.id).then(function (response) {
                    $scope.doc = response.data;
                    var docs = response.data[sid - 1];
                    var Age = $scope.calculateAge(docs.dob);


                $scope.data = {
                   customerName : result.customer.customerName,
                   today: new Date(),
                   age : Age,
                   folioNo : result.folioNo,
                   sonof: 'fathersname',
                   newaddress : '',
                   address : result.customer.address,
                   mobile: result.customer.mobile,
                   officename : result.companyName,
                   officeaddress: 'C 101, 247 Park, L.B.S. Marg, Vikhroli (West), Mumbai, Maharashtra, 400083',
                                       holders : holders.length > 0 ? `(${holders.join(') (')})` : ''

                };

                hideLoader();
                }, function (error) {
                    console.error('Error loading Docs:', error);
                    hideLoader();
                });
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }

            if(id2){
                 $scope.hDiv = false;
            $http.get('/Form/GetGenratedFormById/'+id2).then(function (response) {
                var result = response.data;
                var obj = JSON.parse(result.jsonString);
                $scope.data = {
                    customerName: obj.customerName,
                    today: obj.today,
                    age:obj.age,
                    folioNo : obj.folioNo,
                    sonof:obj.sonof,
                    newaddress:obj.newaddress,
                    address:obj.address,
                    mobile: obj.mobile,
                   officename: obj.officename,
                   officeaddress: obj.officeaddress,
                   holders: obj.holders,
                };
                hideLoader();
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }
        };

          $scope.calculateAge = function(dob) {
      if (!dob) {
        return '';
      }
      var birthDate = new Date(dob);
      var currentDate = new Date();
      var age = currentDate.getFullYear() - birthDate.getFullYear();
      var m = currentDate.getMonth() - birthDate.getMonth();

      // Adjust age if the current month is before the birth month or if the birth day hasn't occurred yet
      if (m < 0 || (m === 0 && currentDate.getDate() < birthDate.getDate())) {
        age--;
      }
      return age;
    };

        //Genrate Form
         $scope.genrateForm = function () {
             if(id){
             let jsonString = JSON.stringify($scope.data, null, 2);
             var data ={
                 formName : 'Change of Address Correspondence',
                 StockId : id,
                 url : `/Form/ChangeofAddressCorrespondence?id2=`,
                 jsonString : jsonString,
                 IsActive : true
             }

             const url = '/Form/GenrateForm';
                $http.post(url, data).then(function (response) {
                    if (response.data.success) {
                        Swal.fire({
                            title: 'Success',
                            text: response.data.message || 'Operation successful!',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        });
                        $scope.loadCustomers();
                    } else {
                        Swal.fire({
                            title: 'Error!',
                            text: response.data.message || 'There was an issue adding the customer.',
                            icon: 'error',
                            confirmButtonText: 'Try Again'
                        });
                    }
                    isProcessing = false;
                }, function (error) {
                    Swal.fire({
                        title: 'Error',
                        text: 'An error occurred.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                    isProcessing = false;
                });
            //console.log(dataString);
            }
         }


        // Load Customers
        // $scope.loadCustomers = function () {
        //     $http.get('/Master/GetCustomers').then(function (response) {
        //         $scope.customers = response.data[0];
        //         hideLoader();
        //     }, function (error) {
        //         console.error('Error loading customers:', error);
        //         hideLoader();
        //     });
        // };

        // $scope.loadDocs = function () {
        //     if (true) {
        //         $http.get('/doc/getDocs/' + 1).then(function (response) {
        //             $scope.docs = response.data;
        //             hideLoader();
        //         }, function (error) {
        //             console.error('Error loading Docs:', error);
        //             hideLoader();
        //         });
        //     }
        // };

        //Function
        $scope.printDiv = function (divId) {
            var innerContents = document.getElementById(divId).innerHTML;
            var popupWinindow = window.open('', '_blank', 'width=600,height=700,scrollbars=no,menubar=no,toolbar=no,location=no,status=no,titlebar=no');
            popupWinindow.document.open();
            popupWinindow.document.write('<html><head><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"><style type="text/css"> * { margin: 0; padding: 0; text-indent: 0; } h1 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 16pt; } .s1 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 14pt; } .s2 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; } h3 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11pt; } .p, p { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; margin: 0pt; } h2 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 12pt; } </style>< /head > <body onload="window.print()">' + innerContents + '</html>');
            popupWinindow.document.close();
        };
        //Initialize
        $scope.loadCustomers();
        // $scope.loadDocs();
    });
</script>
</html>
