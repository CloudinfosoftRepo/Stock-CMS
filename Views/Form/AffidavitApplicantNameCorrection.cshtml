<html lang="en" ng-app="Stock-CMS">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Affidavit Applicant Name Correction</title>
    <style type="text/css">
        * {
          margin: 0;
          padding: 0;
          text-indent: 0;
        }
        h1 {
          color: black;
          font-family: "Bookman Old Style", serif;
          font-style: normal;
          font-weight: bold;
          text-decoration: none;
          font-size: 15pt;
        }
        .p,
        p {
          color: black;
          font-family: "Bookman Old Style", serif;
          font-style: normal;
          font-weight: normal;
          text-decoration: none;
          font-size: 12pt;
          margin: 0pt;
        }
        .s1 {
          color: black;
          font-family: Calibri, sans-serif;
          font-style: normal;
          font-weight: normal;
          text-decoration: none;
          font-size: 12pt;
        }
        .s2 {
          color: black;
          font-family: Calibri, sans-serif;
          font-style: normal;
          font-weight: normal;
          text-decoration: underline;
          font-size: 12pt;
        }
        .s4 {
          color: black;
          font-family: Calibri, sans-serif;
          font-style: normal;
          font-weight: normal;
          text-decoration: none;
          font-size: 11pt;
        }
        .s5 {
          color: black;
          font-family: "Times New Roman", serif;
          font-style: normal;
          font-weight: normal;
          text-decoration: none;
          font-size: 11pt;
        }
        .s6 {
          color: #1f497d;
          font-family: "Bookman Old Style", serif;
          font-style: italic;
          font-weight: bold;
          text-decoration: none;
          font-size: 11.5pt;
        }
        .s8 {
          color: black;
          font-family: "Bookman Old Style", serif;
          font-style: normal;
          font-weight: bold;
          text-decoration: none;
          font-size: 11.5pt;
        }
        li {
          display: block;
        }
        #l1 {
          padding-left: 0pt;
          counter-reset: c1 1;
        }
        #l1 > li > *:first-child:before {
          counter-increment: c1;
          content: counter(c1, decimal) ". ";
          color: black;
          font-style: normal;
          font-weight: normal;
          text-decoration: none;
        }
        #l1 > li:first-child > *:first-child:before {
          counter-increment: c1 0;
        }
    </style>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        h1 {
            color: black;
            font-family: "Bookman Old Style", serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 15pt;
        }

        .p,
        p {
            color: black;
            font-family: "Bookman Old Style", serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 12pt;
            margin: 0pt;
        }

        .s1 {
            color: black;
            font-family: Calibri, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 12pt;
        }

        .s2 {
            color: black;
            font-family: Calibri, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: underline;
            font-size: 12pt;
        }

        .s4 {
            color: black;
            font-family: Calibri, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 11pt;
        }

        .s5 {
            color: black;
            font-family: "Times New Roman", serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 11pt;
        }

        .s6 {
            color: #1f497d;
            font-family: "Bookman Old Style", serif;
            font-style: italic;
            font-weight: bold;
            text-decoration: none;
            font-size: 11.5pt;
        }

        .s8 {
            color: black;
            font-family: "Bookman Old Style", serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 11.5pt;
        }

        li {
            display: block;
        }

        #l1 {
            padding-left: 0pt;
            counter-reset: c1 1;
        }

            #l1 > li > *:first-child:before {
                counter-increment: c1;
                content: counter(c1, decimal) ". ";
                color: black;
                font-style: normal;
                font-weight: normal;
                text-decoration: none;
            }

            #l1 > li:first-child > *:first-child:before {
                counter-increment: c1 0;
            }
    </style>
</head>

<body style="padding-left: 10%;" ng-controller="FormController">
    <div ng-if="hDiv">
        <form name="gForm" ng-submit="genrateForm()">
            <div class="row">
                @* <div class="col-md-12"> *@
                <div class="form-group mb-3">
                    <label for="seletedid" class="form-label">select customer</label>
                    <select class="form-select w-auto" ng-options="f.id as f.name for f in docs" ng-model="seletedid" ng-change="loadCustomers(seletedid)">
                        <option selected disabled value="">Select customer</option>
                    </select>
                </div>
                    <div class="form-group mb-3 col-md-3">
                        <label for="dpid" class="form-label">DP Id</label>
                        <input type="text" ng-model="data.dpid" class="form-control search-orders" placeholder="DP Id">
                    </div>
                    <div class="form-group mb-3 col-md-3">
                        <label for="clientid" class="form-label">Client Id</label>
                        <input type="text" ng-model="data.clientid" class="form-control search-orders" placeholder="Client Id">
                    </div>
                    <div class="form-group mb-3 col-md-3">
                        <label for="lfno" class="form-label">LF No</label>
                        <input type="text" ng-model="data.lfno" class="form-control search-orders" placeholder="LF No">
                    </div>
                    <div class="form-group mb-3 col-md-3">
                        <label for="accountno" class="form-label">Account No</label>
                        <input type="text" ng-model="data.accountno" class="form-control search-orders" placeholder="Account No">
                    </div>
                <div class="form-group mb-3 col-md-3">
                    <label for="bankname" class="form-label">Bank Name</label>
                    <input type="text" ng-model="data.bankname" class="form-control search-orders" placeholder="Bank Name">
                </div>
                <div class="form-group mb-3 col-md-3">
                    <label for="branch" class="form-label">Branch</label>
                    <input type="text" ng-model="data.branch" class="form-control search-orders" placeholder="Branch">
                </div>
                @* </div> *@
                <div class="text-center m-2 col-md-4">
                    <button type="submit" class="btn" style="background-color:#003980; color:white;">
                        Genrate Form
                    </button>
                </div>
            </div>
        </form>
    </div>
    <div id="printForm">
    <h1 style="text-indent: 0pt; text-align: center">Affidavit</h1>
    <p style="padding-top: 5pt; text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: justify">
            I, <span class="s1">{{data.customerName}} </span>{{data.relationship}}
            <span class="s1">{{data.sonof}}</span>, aged {{data.age}} years, having PAN {{data.pan}} <span class="s1"> </span>and Aadhar no
            <u>{{data.aadhar}}</u> presently residing at presently residing at {{data.address}}<span class="p">.</span>
    </p>

    <p style="
        padding-top: 13pt;
        padding-left: 5pt;
        text-indent: 0pt;
        text-align: left;
      ">
        do solemnly and sincerely swear and state as under:
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <ol id="l1">
        <li data-list-text="1.">
            <p style="padding-left: 41pt; text-indent: -18pt; text-align: justify">
                That the following Equity Shares are registered in (name)
                    <span class="s2">{{data.customerName}}</span><span class="s1"> </span>
                    @* <span class="s2">PRABHULAL THAKKER </span> *@
                    jointly with (name)
                    <span class="s2">{{data.holders}}</span><span class="s1"> </span>under LF No <u>{{data.lfno}} </u>in the books of
                    <span class="s2">{{data.officename}}</span><span class="s1"> </span>having its Registered Office at
                <span class="s2">
                        {{data.officeaddress}}
                @* </span><span class="s1"> </span><span class="s2">Mumbai, Maharashtra, 400051</span><span class="s4">.</span> *@
            </p>
        </li>
        <li data-list-text="2.">
            <p style="
            padding-top: 12pt;
            padding-left: 41pt;
            text-indent: -18pt;
            text-align: left;
          ">
                That in my PAN Card having no
                    <span class="s1">{{data.pan}}</span> my name has been recorded |
                    mentioned as <span class="s1">{{data.nameonpan}}</span>.
            </p>
            <p style="padding-top: 11pt; text-indent: 0pt; text-align: left">
                <br />
            </p>
        </li>
        <li data-list-text="3.">
            <p style="padding-left: 41pt; text-indent: -18pt; text-align: left">
                    That in my Aadhar card having no. <u>{{data.aadhar}}</u> my name has
                been recorded | mentioned as
                    <span class="s1">{{data.nameonaadhar}}</span>.
            </p>
            <p style="padding-top: 11pt; text-indent: 0pt; text-align: left">
                <br />
            </p>
        </li>
        <li data-list-text="4.">
            <p style="
            padding-left: 40pt;
            text-indent: -18pt;
            line-height: 14pt;
            text-align: justify;
          ">
                    That in my Demat account having DP ID {{data.dpid}} and CL ID <span class="s5"> {{data.clientid}}</span> my name has been recorded | mentioned as {{data.customerName}}
            </p>
          
            <p style="padding-top: 12pt; text-indent: 0pt; text-align: left">
                <br />
            </p>
        </li>
        <li data-list-text="5.">
            <p style="padding-left: 41pt; text-indent: -18pt; text-align: left">
                That in my bank account having no <u>{{data.accountno}}</u> with
                    <span class="s1">{{data.bankname}}</span>,
                    <span class="s1">{{data.branch}} </span>Branch, my name has been recorded |
                    mentioned as <span class="s1">{{data.customerName}}</span>.
            </p>
            <p style="text-indent: 0pt; text-align: left"><br /></p>
        </li>
        <li data-list-text="6.">
            <p style="padding-left: 41pt; text-indent: -18pt; text-align: justify">
                That
                <span class="s1">
                        {{data.customerName}}, and {{data.nameonaadhar}},
                        {{data.nameonpan}}, {{data.customerName}} as mentioned above in Sr no 2 to 5 is one and the same person
                </span>
            </p>
           
            <p style="padding-top: 12pt; text-indent: 0pt; text-align: left">
                <br />
            </p>
        </li>
        <li data-list-text="7.">
            <p style="
            padding-left: 41pt;
            text-indent: -18pt;
            line-height: 92%;
            text-align: left;
          ">
                I execute this affidavit to be submitted to concerned authority for
                claiming shares and dividend thereof.
            </p>
        </li>
    </ol>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p class="s6"
       style="padding-left: 5pt; text-indent: 0pt; text-align: justify">
        <span style="color: #000">
            I, the undersigned declare that whatsoever is stated in Sr No.01 to 07
            above is true and correct
        </span>and
        <u>
            I&nbsp; know&nbsp; that&nbsp; giving&nbsp; of&nbsp; false&nbsp;
            affidavit&nbsp; invites legal
        </u>
        <u>consequences including criminal prosecution</u><span class="s8">.</span>
    </p>
    <p style="padding-top: 11pt; text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: left">
            Solemnly affirmed at Ahmedabad, this {{data.day}} day of <span class="s5">{{data.month}} </span>,
        {{data.year}}
    </p>
    <p style="padding-top: 11pt; text-indent: 0pt; text-align: left"><br /></p>

        <div style="padding-left: 5pt; text-indent: 0pt; display: flex; justify-content: space-between;">
            <div>
                Before me
            </div>
            <div>
                Deponent/s
            </div>
        </div>

    </div>

    <button class="btn btn-store" ng-click="printDiv('printForm')">Print</button>
</body>
<script>
    angular.module('Stock-CMS', []).controller('FormController', function ($scope, $http) {
        $scope.customers = [];
        $scope.data = undefined;
            $scope.hDiv = true;
            var params = new URLSearchParams(window.location.search);
            var id = params.get('id');
            var id2 = params.get('id2');
        var isProcessing = false;

        // showLoader();

        // Load Customers
        // $scope.loadCustomers = function () {
        //     $http.get('/Master/GetCustomers').then(function (response) {
        //         $scope.customers = response.data[0];
        //         hideLoader();
        //     }, function (error) {
        //         console.error('Error loading customers:', error);
        //         hideLoader();
        //     });
        // };

        // Load Customers
         $scope.loadCustomers = function (sid) {
             if(id){
                 var docid = $scope.seletedid == undefined ? 0 : $scope.seletedid;
                 var currentDate = new Date();
             var monthsOfYear = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                 $scope.hDiv = true;
            $http.get('/Enquiry/GetStocksById/'+id).then(function (response) {
                var result = response.data;
                let holders = [
                        result.firstHolder || '',
                        result.secondHolder || '',
                        result.thirdHolder || ''
                    ].filter(holder => holder.trim() !== '');
                $http.get('/doc/getDocs/' +  result.customer.id).then(function (response) {
                     $scope.docs = response.data;
                    var doc = $scope.docs.find(x => x.id === sid)
                    var Age = $scope.calculateAge(doc.dob);
                $scope.data = {
                   customerName : doc.name,
                   age : Age,
                   relationship: doc.relationship,
                   sonof: doc.relativesName,
                   pan: doc.pan,
                   aadhar: doc.aadhar,
                   address : doc.addressAsPerAadhar,
                   officename : result.companyName,
                   officeaddress: '1101, Crescenzo, G-Block, Opp. MCA Club, Bandra-Kurla Complex, Bandra (East), Mumbai, Maharashtra, 400051',
                   nameonpan: doc.nameAsPerPan,
                   nameonaadhar: doc.nameAsPerAadhar,
                   bankname: '',
                   branch: '',
                   lfno: '',
                   dpid: '',
                   clientid: '',
                   accountno:'',
                   day: currentDate.getDate(),
                   month: monthsOfYear[currentDate.getMonth()],
                   year: currentDate.getFullYear(),
                    holders : holders.length > 0 ? `(${holders.join(') (')})` : ''
                };

                hideLoader();
                }, function (error) {
                    console.error('Error loading Docs:', error);
                    hideLoader();
                });
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }

            if(id2){
                 $scope.hDiv = false;
            $http.get('/Form/GetGenratedFormById/'+id2).then(function (response) {
                var result = response.data;
                var obj = JSON.parse(result.jsonString);
                $scope.data = {
                    customerName: obj.customerName,
                    age:obj.age,
                    relationship: obj.relationship,
                    sonof:obj.sonof,
                    pan:obj.pan,
                    aadhar:obj.aadhar,
                    address:obj.address,
                    officename: obj.officename,
                    officeaddress: obj.officeaddress,
                    nameonpan: obj.nameonpan,
                    bankname: obj.bankname,
                    branch: obj.branch,
                    nameonaadhar: obj.nameonaadhar,
                    lfno: obj.lfno,
                    dpid:obj.dpid,
                    clientid:obj.clientid,
                    accountno: obj.accountno,
                    day:obj.day,
                    month:obj.month,
                    year:obj.year,
                    holders: obj.holders,
                };
                hideLoader();
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }
        };

          $scope.calculateAge = function(dob) {
      if (!dob) {
        return '';
      }
      var birthDate = new Date(dob);
      var currentDate = new Date();
      var age = currentDate.getFullYear() - birthDate.getFullYear();
      var m = currentDate.getMonth() - birthDate.getMonth();

      // Adjust age if the current month is before the birth month or if the birth day hasn't occurred yet
      if (m < 0 || (m === 0 && currentDate.getDate() < birthDate.getDate())) {
        age--;
      }
      return age;
    };

        //Genrate Form
         $scope.genrateForm = function () {
             if(id){
             let jsonString = JSON.stringify($scope.data, null, 2);
             var data ={
                 formName : 'Affidavit ApplicantName Correction',
                 StockId : id,
                 url : `/Form/AffidavitApplicantNameCorrection?id2=`,
                 jsonString : jsonString,
                 IsActive : true,
                 ClientName: $scope.data.customerName,

             }

             const url = '/Form/GenrateForm';
                $http.post(url, data).then(function (response) {
                    if (response.data.success) {
                        Swal.fire({
                            title: 'Success',
                            text: response.data.message || 'Operation successful!',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        });
                        // $scope.loadCustomers();
                                                window.open(response.data.data.url + response.data.data.id,'_self')

                    } else {
                        Swal.fire({
                            title: 'Error!',
                            text: response.data.message || 'There was an issue adding the customer.',
                            icon: 'error',
                            confirmButtonText: 'Try Again'
                        });
                    }
                    isProcessing = false;
                }, function (error) {
                    Swal.fire({
                        title: 'Error',
                        text: 'An error occurred.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                    isProcessing = false;
                });
            //console.log(dataString);
            }
         }

        // $scope.loadDocs = function () {
        //     if (true) {
        //         $http.get('/doc/getDocs/' + 1).then(function (response) {
        //             $scope.docs = response.data;
        //             hideLoader();
        //         }, function (error) {
        //             console.error('Error loading Docs:', error);
        //             hideLoader();
        //         });
        //     }
        // };
        //Function
        $scope.printDiv = function (divId) {
            var innerContents = document.getElementById(divId).innerHTML;
            var popupWinindow = window.open('', '_blank', 'width=600,height=700,scrollbars=no,menubar=no,toolbar=no,location=no,status=no,titlebar=no');
            popupWinindow.document.open();
            popupWinindow.document.write('<html><head><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"><style type="text/css"> * { margin: 0; padding: 0; text-indent: 0; h1 { color: black; font-family: "Bookman Old Style", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 15pt; } .p, p { color: black; font-family: "Bookman Old Style", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; margin: 0pt; } .s1 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 12pt; } .s2 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: underline; font-size: 12pt; } .s4 { color: black; font-family: Calibri, sans-serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; } .s5 { color: black; font-family: "Times New Roman", serif; font-style: normal; font-weight: normal; text-decoration: none; font-size: 11pt; } .s6 { color: #1f497d; font-family: "Bookman Old Style", serif; font-style: italic; font-weight: bold; text-decoration: none; font-size: 11.5pt; } .s8 { color: black; font-family: "Bookman Old Style", serif; font-style: normal; font-weight: bold; text-decoration: none; font-size: 11.5pt; } li { display: block; } #l1 { padding-left: 0pt; counter-reset: c1 1; } #l1 > li > *:first-child:before { counter-increment: c1; content: counter(c1, decimal) ". "; color: black; font-style: normal; font-weight: normal; text-decoration: none; } #l1 > li:first-child > *:first-child:before { counter-increment: c1 0; } </style></head > <body onload="window.print()">' + innerContents + '</html>');
            popupWinindow.document.close();
        };
        //Initialize
        $scope.loadCustomers(null);
        // $scope.loadDocs();
    });
</script>

</html>
