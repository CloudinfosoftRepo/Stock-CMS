<html lang="en" ng-app="Stock-CMS">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Dup.-Indemnity-B.DOCX</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            text-indent: 0;
        }

        h1 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 11pt;
        }

        .s1 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: bold;
            text-decoration: none;
            font-size: 12pt;
        }

        .p,
        p {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 12pt;
            margin: 0pt;
        }

        .s3 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 11pt;
        }

        .s4 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: underline;
            font-size: 11pt;
        }

        .s5 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 11pt;
        }

        .s6 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: underline;
            font-size: 12pt;
        }

        .s7 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 12pt;
        }

        .s8 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 12pt;
        }

        .s9 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 10pt;
        }

        .s10 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 10pt;
        }

        .s11 {
            color: #d0d1d4;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 12pt;
        }

        .s12 {
            color: #d0d1d4;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: underline;
            font-size: 12pt;
        }

        .s13 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 8pt;
            vertical-align: 4pt;
        }

        .s14 {
            color: black;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 10pt;
        }

        .s16 {
            color: #a6a6a6;
            font-family: Arial, sans-serif;
            font-style: normal;
            font-weight: normal;
            text-decoration: none;
            font-size: 12pt;
        }

        li {
            display: block;
        }

        #l1 {
            padding-left: 0pt;
            counter-reset: c1 1;
        }

            #l1 > li > *:first-child:before {
                counter-increment: c1;
                content: counter(c1, decimal) ". ";
                color: black;
                font-family: Arial, sans-serif;
                font-style: normal;
                font-weight: normal;
                text-decoration: none;
                font-size: 12pt;
            }

            #l1 > li:first-child > *:first-child:before {
                counter-increment: c1 0;
            }

        table,
        tbody {
            vertical-align: top;
            overflow: visible;
        }
        /* General table styles */
        .myTable {
            border-collapse: collapse;
            margin-left: 17.5pt;
        }

            /* Cell styles */
            .myTable td {
                border: 1px solid #babdbf;
                padding: 3pt;
            }

            /* Header row styles */
            .myTable tr:first-child td {
                font-weight: bold; /* Or use a class for header cells */
            }

            /* Column width adjustments */
            .myTable td:nth-child(1) {
                width: 104pt;
            }

            .myTable td:nth-child(2) {
                width: 108pt;
            }

            .myTable td:nth-child(3) {
                width: 99pt;
            }

            .myTable td:nth-child(4) {
                width: 71pt;
            }

            .myTable td:nth-child(5) {
                width: 95pt;
            }

            /* Text alignment and indentation */
            .myTable p {
                margin: 0;
                text-align: left;
            }

            .myTable td:nth-child(3) p {
                padding-right: 36pt;
            }

            /* Line height */
            .myTable p {
                line-height: 114%;
            }

        /* Classes for specific styles */
        .s1 { /* For header text */
            font-weight: bold;
        }

        .s8 { /* For special characters */
            font-weight: bold;
        }

        .s9 { /* For row numbers */
            font-weight: bold;
        }

        .card {
            border-radius: 10px;
            overflow: hidden;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .form-select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 1rem;
        }

        .btn-primary {
            width: 100%;
            padding: 12px 16px;
            text-transform: uppercase;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

            .btn-primary:hover {
                background-color: #0056b3;
                transform: scale(1.05);
            }

        .mybtn {
            background-color: #51b37f !important;
            color: white !important;
            width: auto !important;
        }

        .myarea {
            justify-content: center !important;
            display: flex !important;
            margin-top: 25px !important;
        }
    </style>
</head>

<body style="padding-left: 1%;" ng-controller="FormController">
    <div class="row align-items-center">
        <!-- Arrow Icon aligned to the left -->
        <a class="col-md-1 text-start" style="font-size:35px;" ng-click="navtogenerateform()">
            <i class="bi bi-arrow-left"></i>
        </a>

        <!-- Centered Heading -->
        <div class="col-md-10 text-center">
            <h3>Dup.-Indemnity-B</h3>
        </div>
    </div>
    <div ng-if="hDiv" class="container my-5">
        <div class="card shadow-sm">
            <div class="card-body">
                <form name="gForm" ng-submit="genrateForm()">
                    <h4 class="card-title text-center mb-4" style="color:#51b37f;">Generate Form</h4>

                    <div class="row">
                        <!-- Select Customer Dropdown -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="seletedId" class="form-label">Select Customer</label>
                                <select class="form-select" id="seletedId" ng-options="f.id as f.name for f in docs" ng-model="seletedId" ng-change="loadCustomers(seletedId, heirId)">
                                    <option selected disabled value="">Select customer</option>
                                </select>
                            </div>
                        </div>

                        <!-- Select Heir Dropdown -->
                        <div class="col-md-4 mb-3" ng-show="legalheirlist">
                            <div class="form-group">
                                <label for="heirId" class="form-label">Select Heir</label>
                                <select class="form-select" id="heirId" ng-options="g.id as g.name for g in heir" ng-model="heirId" ng-change="loadCustomers(seletedId, heirId)">
                                    <option selected disabled value="">Select Heir</option>
                                </select>
                            </div>
                        </div>

                        <!-- Year of Share Acquisition 
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="yearofshareaquisition" class="form-label">Year of Share Acquisition</label>
                                <input type="text" ng-model="data.yearofshareaquisition" class="form-control" placeholder="Year Of Share Acquisition">
                            </div>
						</div>-->
                    </div>

                    <div class="row">
                        <!-- Place -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="place" class="form-label">Place</label>
                                <input type="text" ng-model="data.place" class="form-control" placeholder="Place">
                            </div>
                        </div>

                        <!-- Select Witness Dropdown -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="fwitness" class="form-label">Select 1st Witness</label>
                                <select class="form-select" ng-options=" x.witnessname as x.witnessname for x in witnesslist" ng-model="data.fwitness" ng-change="fwitnessselect(data.fwitness,data.switness)">
                                    <option selected disabled value="">Select Witness</option>
                                </select>
                            </div>
                        </div>


                        <!-- Select Witness Dropdown -->
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="switness" class="form-label">Select 2nd Witness</label>
                                <select class="form-select" ng-options=" x.witnessname as x.witnessname for x in witnesslist" ng-model="data.switness" ng-change="switnessselect(data.fwitness,data.switness)">
                                    <option selected disabled value="">Select Witness</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                <label for="selected" class="form-label">Select Certificate No</label>
                                <select class="form-select" ng-options="s.certificateNo as s.certificateNo for s in shares" ng-model="selected" ng-change="AddSelectedShare(selected)">
                                    <option selected disabled value="">Select Shares</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="form-group">
                                {{message}}
                            </div>
                        </div>
                    </div>
                        <!-- Submit Button -->
                        <div class="col-md-4 text-center mt-4">
                        <button type="submit" ng-disabled="processdone" class="btn btn-primary px-4" style="background-color:#51b37f; color:white; border-radius: 5px;">
                                Generate Form
                            </button>
                        </div>
                </form>
            </div>
        </div>
    </div>
    <div id="printForm">
        <h1 style="
        padding-top: 4pt;
        /* padding-left: 222pt; */
        text-indent: 0pt;
        line-height: 200%;
        text-align: center;
      ">
            Form-B
        </h1>
        <h1 style="
      padding-top: 4pt;
      /* padding-left: 222pt; */
      text-indent: 0pt;
      line-height: 200%;
      text-align: center;
    ">
            INDEMNITY
        </h1>
        <h1 style="padding-left: 41pt; text-indent: 0pt; text-align: center">
            [For issuance of duplicate securities]
        </h1>
        <p style="padding-top: 2pt; text-indent: 0pt; text-align: left"><br /></p>
        <div class="textbox"
             style="
        border: 1pt solid #000000;
        display: block;
        min-height: 18pt;
        /* width: 446pt; */
      ">
            <p class="s1" style="text-indent: 0pt; text-align:center">
                Note:
                <i>This indemnity is to be executed in the presence of a Public Notary </i>/ Gazetted Officer
            </p>
        </div>
        <p style="padding-left: 48pt; text-indent: 0pt; text-align: left" />
        <p style="
        padding-top: 12pt;
        padding-left: 48pt;
        text-indent: 0pt;
        text-align: justify;
      ">
            [To be submitted in non-judicial stamp paper of appropriate value]
        </p>
        <p style="text-indent: 0pt; text-align: left"><br /></p>
        <p class="s3"
           style="
        padding-left: 48pt;
        text-indent: 0pt;
        line-height: 112%;
        text-align: justify;
      ">
            I/We,
            <span class="s4" ng-show="!data.condition" ng-class="{'hide-print': !data.condition}">
                {{data.firstHolder}},
                {{data.secondHolder}},
                {{data.thirdHolder}}
            </span>
            <span class="s4" ng-show="data.condition" ng-class="{'hide-print': !data.condition}" ng-repeat="h in data.heirs">
                {{h.name}},</span>s/d/o
                <span class="s4" ng-show="!data.condition" ng-class="{'hide-print': !data.condition}">{{docs[0].sonof}} </span><span class="s4" ng-show="data.condition" ng-class="{'hide-print': !data.condition}"> {{data.heirs[0].sonof}} </span>residing at<span class="s4" ng-show="!data.condition" ng-class="{'hide-print': !data.condition}">{{docs[0].addressAsPerAadhar}}</span><span class="s4" ng-show="data.condition" ng-class="{'hide-print': !data.condition}">{{data.heirs[0].address}}</span><span class="s4"> </span> having Permanent Account No(s)<span class="s4">
                    {{data.accountno}} <span class="s4" ng-show="!data.condition" ng-class="{'hide-print': !data.condition}">
                        {{data.firstHolderpan}},
                        {{data.secondHolderpan}},
                        {{data.thirdHolderpan}}
                    </span>
                    <span class="s4" ng-show="data.condition" ng-class="{'hide-print': !data.condition}" ng-repeat="h in data.heirs">
                        {{h.pan}},
                    </span>do hereby solemnly affirm and state on oath as follows.
        </p>
        <p class="s3"
           style="
        padding-top: 6pt;
        padding-left: 48pt;
        text-indent: 0pt;
        text-align: justify;
      ">

        </p>
        <p style="text-indent: 0pt; text-align: left"><br /></p>
        <ol id="l1">
            <li data-list-text="1.">
                <p style="padding-left: 48pt; text-indent: -18pt; text-align: justify">
                    That I/we,
                    <span class="s4" ng-show="!data.condition" ng-class="{'hide-print': data.condition}">
                        {{data.firstHolder}},
                        {{data.secondHolder}},
                        {{data.thirdHolder}}
                    </span><span class="s4" ng-show="data.condition" ng-class="{'hide-print': !data.condition}" ng-repeat="h in data.heirs">
                        {{h.name}}
                    </span><span class="s7"> </span>am/are the sole/joint holder/s of the
                    Securities in following folios. I/We request you to issue duplicate
                    certificate(s) for securities, as detailed below in my/our name(s):
                </p>
                <p style="padding-top: 10pt; text-indent: 0pt; text-align: left">
                    <br />
                </p>
                <table class="myTable">
                    <tr>
                        <td>
                            <p class="s1">Name of the Company</p>
                        </td>
                        <td>
                            <p class="s1">Certificate No.**</p>
                        </td>
                        <td>
                            <p class="s1">Distinctive No.**</p>
                        </td>
                        <td>
                            <p class="s1">Folio No. <span class="s8">**</span></p>
                        </td>
                        <td>
                            <p class="s1">No. and Face value of</p>
                            <p class="s1">securities held</p>
                        </td>
                    </tr>
                    <tr ng-repeat="tmp in selectedShares">
                        <td class="s9">{{data.officename}}</td>
                        <td>{{tmp.certificateNo}}</td>
                        <td>{{tmp.distinctiveNosFrom}} - {{tmp.distinctiveNosTo}}</td>
                        <td>{{tmp.folioNo}}</td>
                        <td>{{tmp.actualQty}} shares, FV: {{data.faceValue}}</td>
                    </tr>
                </table>

                <p style="padding-top: 3pt; text-indent: 0pt; text-align: left">
                    <br />
                </p>
                <p class="s10"
                   style="
            padding-left: 26pt;
            text-indent: 0pt;
            line-height: 109%;
            text-align: left;
          ">
                    **In case of non-availability of Certificate Nos./Distinctive Nos./
                    Folio nos., security holder shall obtain the same from RTA.
                </p>
                <p style="padding-top: 3pt; text-indent: 0pt; text-align: left">
                    <br />
                </p>
            </li>
            <li data-list-text="2.">
                <p style="padding-left: 48pt; text-indent: -18pt; text-align: justify">
                    That the above securities were acquired by me/us for valuable
                    consideration out of my/our own investment/funds against allotment in
                    Public Issue/allotment in Right Issue or acquired from the
                    market/through inheritance in the year(s) @* {{data.yearofshareaquisition}} *@<u> &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;</u>.
                </p>
                <p style="padding-left: 48pt; text-indent: 0pt; text-align: left">
                    @* ………… *@
                </p>
                <p style="padding-top: 7pt; text-indent: 0pt; text-align: left">
                    <br />
                </p>
            </li>
            <li data-list-text="3.">
                <p style="padding-left: 48pt; text-indent: -18pt; text-align: justify">
                    I/We hereby jointly and severely agree and undertake to indemnify and
                    keep indemnified, saved, defended, harmless, the aforesaid<u>
                        @* Lorem ipsum dolor sit amet, consectetuer adipiscing elit.Lorem ipsum dolor sit amet, consectetuer adipiscing elit.Lorem ipsum dolor sit amet, consectetuer adipiscing elit. *@ {{data.officename}} / {{data.rta}}
                    </u>
                    <span class="p">
                        (Name of the Company/RTA) and its successors and assigns for all time
                        hereafter against all losses, costs, claims, actions, demands, risks,
                        charges, expenses, damages, etc., whatsoever which you may suffer and/or
                        incur by reason of your, at my/our request, issuing the said Duplicate
                        Securities as herein above mentioned, to the undersigned.
                    </span>
                </p>
            </li>
        </ol>
        <br>
        <p style="
        padding-top: 3pt;
        padding-left: 48pt;
        text-indent: 0pt;
        text-align: left;
      ">
            IN WITNESS WHEREOF the said 1) Mr. /Ms.<span class="s6">
                @* Reva Patel *@ {{data.witnessname}}
            </span>
        </p>
        <p style="padding-top: 3pt;padding-left: 48pt; text-indent: 0pt; text-align: left">
            Address: {{data.witness1address}}<br />
        </p><br />
        <p class="s11"
           style="padding-left: 48pt; text-indent: 0pt; text-align: left">
            (Name and signature of the witness)
            <span class="s12">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
        </p>
        <p style="padding-top: 3pt; text-indent: 0pt; text-align: left"><br /></p>
        <p style="padding-left: 48pt; text-indent: 0pt; text-align: left">
            And 2) Mr./Ms.
            <span class="s6">@* Reva Patel *@ {{data.witnessname2}} </span>
        </p>
        <p style="padding-top: 4pt;padding-left: 48pt; text-indent: 0pt; text-align: left">
            Address: {{data.witness2address}}<br />
        </p><br />
        <p class="s11"
           style="padding-left: 48pt; text-indent: 0pt; text-align: left">
            (Name and signature of the witness)
            <span class="s12">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
        </p>
        <p style="text-indent: 0pt; text-align: left" />
        <p style="padding-top: 4pt; text-indent: 0pt; text-align: left"><br /></p>
        <p class="s13"
           style="padding-left: 48pt; text-indent: 0pt; text-align: left">
            <span class="p">{{data.customerName}}</span>#<span class="p">, have hereunto set their respective hands and seals this day of </span><span class="s6">@* {{data.date | date:'dd/MM/yyyy'}} *@ <u>&emsp;&emsp;&emsp;&emsp;</u></span>
        </p>
        <p style="text-indent: 0pt; text-align: left"><br /></p>
        <p class="s14" style="padding-left: 5pt; text-indent: 0pt; text-align: left">
            <div style="display: flex; justify-content: space-between;">

                <!-- Left tables -->
                <div style="flex: 1;">
                    <table border="0" cellspacing="20px" cellpadding="0">
                        <tr>
                            <td>Address of First holder / Applicant:<p>{{data.address}}</p></td>
                        </tr>
                        <tr>
                            <td>Pin code <u>{{data.pincode}}</u></td>
                        </tr>
                    </table>
                    <table border="0">
                        <tr>
                            <td>Tel No:</td>
                            <td>@* {{data.mobile}} *@</td>
                        </tr>
                        <tr>
                            <td>Email:</td>
                            <td>@* {{data.email}} *@</td>
                        </tr>
                        <tr>
                            <td>Date:</td>
                            <td>@* {{data.date | date:'dd/MM/yyyy'}} *@</td>
                        </tr>
                    </table>
                </div>

                <!-- Right table -->
                <div style="flex: 1; text-align: left;">
                    <table border="0" cellspacing="20px" cellpadding="0">
                        <tr>
                            <td>Signature of All holder(s) / Applicant(s)</td>
                        </tr>
                    </table>
                </div>

            </div>
        </p>

        <p class="s14" style="padding-left: 5pt; text-indent: 0pt; text-align: left">
            <div style="display: flex; justify-content: space-between;">

                <!-- Left tables -->
                <div style="flex: 1;">
                    <table border="0" cellspacing="20px" cellpadding="0">
                        <!-- <tr>
                          <td>  FOR OFFICE USE ONLY</td>
                        </tr>
                        <tr>
                          <td>Signature checked by: </td>
                        </tr> -->
                    </table>
                </div>

                <!-- Right table -->
                <div style="flex: 1; text-align: left;">
                    <table border="0" cellspacing="20px" cellpadding="0">
                        <tr>
                            <td>  FOR OFFICE USE ONLY</td>
                        </tr>
                        <tr>
                            <td>Signature checked by: <p></p> </td>
                        </tr>
                    </table>
                </div>

            </div>
        </p>

        <p style="text-indent: 0pt; text-align: left"><br /></p>
        <p style="
        /* padding-left: 47pt;
        text-indent: 166pt;*/
        line-height: 40pt;
        text-align: center;
      ">
            <u>Signed before me</u>
        </p>
        at:
        <span class="s6">{{data.place}}</span>
        <br />
        on:
        <span class="s6">
            @* {{data.date | date:'__/MM/yyyy'}} *@<u>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;</u>
        </span>
        <p style="padding-top: 13pt; text-indent: 0pt; text-align: left"><br /></p>
        <p class="s16"
           style="padding-left: 48pt; text-indent: 0pt; text-align: left">
            Signature of Notary / JMFC
        </p>
        <p style="padding-top: 2pt; text-indent: 0pt; text-align: left"><br /></p>
        <p class="s16"
           style="padding-left: 47pt; text-indent: 0pt; text-align: left">
            Official stamp &amp; seal of the Notary Magistrate/ Notary &amp; Regn.
            No.:
        </p>
    </div>
    <div class="myarea">
        <button class="btn btn-store mybtn" ng-click="printDiv('printForm')">PRINT</button>
    </div>
</body>
<script>
    angular.module('Stock-CMS', []).controller('FormController', function ($scope, $http, $timeout) {
        $scope.customers = [];
        $scope.data = undefined;
                 $scope.selected = null;
         $scope.selectedShares = [];
            $scope.hDiv = true;
            var params = new URLSearchParams(window.location.search);
            var id = params.get('id');
            var id2 = params.get('id2');
        var isProcessing = false;
        $scope.processdone = false;

        // showLoader();
    $scope.AddSelectedShare = function(shr) {
      if (shr) {
        var sShare = $scope.shares.find(x => x.certificateNo === shr);

        if (sShare) {
          // Add the selected share to the selectedShares list
          $scope.selectedShares.push(sShare);

          // Remove the selected share from the available shares list
          $scope.shares = $scope.shares.filter(x => x.certificateNo !== shr);

          // Reset the selected model
          $scope.selected = null;
          $scope.message = shr + ' is Added';
        }
      }
    };

          // Load Customers
         $scope.loadCustomers = function (sid,hid) {
             if(id){
                 hideLoader();
                 $scope.hDiv = true;
            $http.get('/Enquiry/GetStocksById/'+id).then(function (response) {
                var result = response.data;
                $http.get('/Form/GetHolderByStockId/' +  id).then(function (response) {
                     $scope.docs = response.data;
                    var doc = $scope.docs.find(x => x.id === sid);

                    var isDeceased = !!doc?.dateOfDeath;

                if (isDeceased) {
                    $scope.heirId = null;
    $scope.legalheirlist = isDeceased;
    document.getElementById('heirId').value = '';
                    $http.get('/LegalHeir/GetClaimentLegalHeir/' + doc.id).then(function (response) {
                        $scope.heir = response.data;
                        var heirs = response.data.find(x => x.id === hid); // `hid` needs to be in scope
                        var holder = heirs;

                        populateData(holder, result,$scope.heir,isDeceased,doc);
                    }, function (error) {
                        console.error('Error loading legal heir data:', error);
                        hideLoader();
                    });
                } else {
                    $scope.heirId = null;
    $scope.data = null;
    $scope.legalheirlist = isDeceased;
    document.getElementById('heirId').value = '';
                    var holder = doc;
                    populateData(holder, result,$scope.heir,isDeceased,doc);
                }

                    $scope.witnesslist = JSON.parse(doc.witnessJson);
               
                hideLoader();

                }, function (error) {
                    console.error('Error loading Docs:', error);
                    hideLoader();
                });
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }

            if(id2){
                 $scope.hDiv = false;
            $http.get('/Form/GetGenratedFormById/'+id2).then(function (response) {
                var result = response.data;
                var obj = JSON.parse(result.jsonString);
                $scope.data = {
                    docid: obj.docid,
                    customerName: obj.customerName,
                    address: obj.address,
                    mobile: obj.mobile,
                    folioNo: obj.folioNo,
                    qty: obj.qty,
                    rate: obj.rate,
                    sonof: obj.sonof,
                    accountno: obj.accountno,
                    relationship: obj.relationship,
                    jsondata: obj.jsondata,
                    officename: obj.officename,
                    rta: obj.rta,
                    yearofshareaquisition: obj.yearofshareaquisition,
                        firstHolder:obj.firstHolder,
    secondHolder:obj.secondHolder,
    thirdHolder:obj.thirdHolder,
    firstHolderpan: obj.firstHolderpan,
        secondHolderpan: obj.secondHolderpan,
        thirdHolderpan: obj.thirdHolderpan,
		heirs: obj.heirs,
                    place: obj.place,
                    date: new Date(obj.date),
                    witnessname: obj.witnessname,
                    witnessname2: obj.witnessname2,
                    pincode: obj.pincode,
                    email: obj.email,
					faceValue: obj.faceValue,
					condition: obj.condition,
					selectedshareslist: obj.selectedshareslist,
                };
                                id = result.stockId;
                                $scope.shares = JSON.parse($scope.data.jsondata);
                                $scope.selectedShares = JSON.parse($scope.data.selectedshareslist);
                checkData();
                hideLoader();
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }

            function populateData(holder, result, heirlist,isDeceased,doc) {
                 $scope.data = {
                    docid: holder.id,
                    customerName : holder.name,
                    address : holder.addressAsPerAadhar,
                    sonof: holder.relativesName,
                    mobile: holder.mobile,
                    relationship: holder.relationship,
                    accountno:holder.pan,
                    jsondata: result.stockJson,
                    qty: result.qty,
                    rate: result.rate,
                    folioNo : result.folioNo,
                    officename : result.companyName,
                    rta: result.company.rtaName,
                    yearofshareaquisition: '',
                     heirs: isDeceased ? heirlist.map(h => ({ name: h.name, pan: h.pan, address: h.addressAsPerAadhar, sonof: doc.name})) : [],
                      firstHolderpan: result.firstHolderData ? result.firstHolderData.pan : '',
            secondHolderpan: result.secondHolderData ? result.secondHolderData.pan : '',
            thirdHolderpan: result.thirdHolderData ? result.thirdHolderData.pan : '',
                    firstHolder :result.firstHolderName,
                    secondHolder:result.secondHolderName,
                    thirdHolder: result.thirdHolderName,
                    place:'Vadodara',
                    date: new Date(),
                    witnessname: '',
                    witnessname2: '',
                    pincode: holder.pinCode,
                    email: holder.email,
                    faceValue: result.faceValue,
                    condition: isDeceased,
                };
                $scope.shares = JSON.parse($scope.data.jsondata);
            }
        };

        $scope.fwitnessselect = function (fid,sid) {
               // var find1 = $scope.holderlist .find(x => x.id === fid);

              var result =  (fid == sid)
               if(result)
             {
                $scope.data.fwitness = undefined;
                Swal.fire({
                    title: 'Error!',
                    text: 'Same person can not be selected for multiple Witnesses.',
                    icon: 'error',
                    confirmButtonText: 'Try Again'
                });
                $scope.data.witnessname = '';
                $scope.data.witness1address = '';
               }
               else{
                   var witness1 = $scope.witnesslist.find(y => y.witnessname == fid);
                   $scope.data.witnessname = witness1.witnessname;
                   $scope.data.witness1address = witness1.witnessaddress;
               }
            }

             $scope.switnessselect = function (fid,sid) {
               // var find1 = $scope.holderlist .find(x => x.id === fid);

              var result =  (fid == sid)
               if(result)
             {
                $scope.data.switness = undefined ;
                 Swal.fire({
                    title: 'Error!',
                    text: 'Same person can not be selected for multiple Witnesses.',
                    icon: 'error',
                    confirmButtonText: 'Try Again'
                });
                $scope.data.witnessname2 = '';
                $scope.data.witness2address = '';
               }
               else{
                   var witness2 = $scope.witnesslist.find(y => y.witnessname == sid);
                   $scope.data.witnessname2 = witness2.witnessname;
                   $scope.data.witness2address = witness2.witnessaddress;
               }
            }

            $scope.navtogenerateform = function () {
        window.open('/Form/GenerateForm/'+id, '_self');
    };

                        function checkData() {
        if ($scope.data !== undefined) {
            // Delay the printDiv execution until the next digest cycle
            $timeout(function() {
                $scope.printDiv('printForm');
            }, 0);  // 0 delay to ensure it runs after the view update
        } else {
            setTimeout(checkData, 1000); // Retry after 1000ms if data is not yet available
        }
    }

          $scope.calculateAge = function(dob) {
              if (!dob) {
                return '';
              }
              var birthDate = new Date(dob);
              var currentDate = new Date();
              var age = currentDate.getFullYear() - birthDate.getFullYear();
              var m = currentDate.getMonth() - birthDate.getMonth();

              // Adjust age if the current month is before the birth month or if the birth day hasn't occurred yet
              if (m < 0 || (m === 0 && currentDate.getDate() < birthDate.getDate())) {
                age--;
              }
              return age;
          };

        //Genrate Form
         $scope.genrateForm = function () {
             if(id){
                 $scope.processdone = true;
                  if($scope.data.jsondata == undefined){
                     Swal.fire({
                            title: 'Error!',
                            text:  'Please Enter Stock Qty data in Custome\'s Stock Page',
                            icon: 'error',
                            confirmButtonText: 'Try Again'
                        });
                        $scope.processdone = false;
                return;
                 }
                 $scope.data.selectedshareslist= JSON.stringify($scope.selectedShares);
             let jsonString = JSON.stringify($scope.data, null, 2);
             var data ={
                 formName : 'Dup Indemnity B',
                 StockId : id,
                 url : `/Form/DupIndemnityB?id2=`,
                 jsonString : jsonString,
                 ClientName: $scope.data.customerName,
                  ClientId: $scope.data.docid,
                 IsActive : true
             }

             const url = '/Form/GenrateForm';
                $http.post(url, data).then(function (response) {
                    if (response.data.success) {
                        Swal.fire({
                            title: 'Success',
                            text: response.data.message || 'Operation successful!',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        });
                        $scope.processdone = false;
                        // $scope.loadCustomers();
                        window.open(response.data.data.url + response.data.data.id,'_self')
                    } else {
                        Swal.fire({
                         title: 'This Form is already Exits',
                         text: "do you want to go to that form?",
                         icon: 'warning',
                         showCancelButton: true,
                         confirmButtonText: 'Yes',
                         cancelButtonText: 'No'
                     }).then((result) => {
                         if (result.isConfirmed) {
                             window.open(response.data.message, '_self');
                         }
                 });
                 $scope.processdone = false;
                    }
                    isProcessing = false;
                }, function (error) {
                    Swal.fire({
                        title: 'Error',
                        text: 'An error occurred.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                    $scope.processdone = false;
                    isProcessing = false;
                });
            //console.log(dataString);
            }
         }

        // Load Customers
        // $scope.loadCustomers = function () {
        //     $http.get('/Master/GetCustomers').then(function (response) {
        //         $scope.customers = response.data[0];
        //         hideLoader();
        //     }, function (error) {
        //         console.error('Error loading customers:', error);
        //         hideLoader();
        //     });
        // };

        // $scope.loadDocs = function () {
        //     if (true) {
        //         $http.get('/doc/getDocs/' + 1).then(function (response) {
        //             $scope.docs = response.data;
        //             hideLoader();
        //         }, function (error) {
        //             console.error('Error loading Docs:', error);
        //             hideLoader();
        //         });
        //     }
        // };

        //Function
        $scope.printDiv = function (divId) {
                var css = '<style type="text/css">*{margin:0;padding:0;text-indent:0}h1{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:bold;text-decoration:none;font-size:11pt}.s1{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:bold;text-decoration:none;font-size:12pt}.p,p{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:12pt;margin:0pt}.s3{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:11pt}.s4{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:underline;font-size:11pt}.s5{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:11pt}.s6{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:underline;font-size:12pt}.s7{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:12pt}.s8{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:12pt}.s9{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:10pt}.s10{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:10pt}.s11{color:#d0d1d4;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:12pt}.s12{color:#d0d1d4;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:underline;font-size:12pt}.s13{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:8pt;vertical-align:4pt}.s14{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:10pt}.s16{color:#a6a6a6;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:12pt}li{display:block}#l1{padding-left:0pt;counter-reset:c1 1}#l1>li>*:first-child:before{counter-increment:c1;content:counter(c1,decimal)". ";color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:12pt}#l1>li:first-child>*:first-child:before{counter-increment:c1 0}table,tbody{vertical-align:top;overflow:visible}.myTable{border-collapse:collapse;margin-left:17.5pt}.myTable td{border:1px solid #babdbf;padding:3pt}.myTable tr:first-child td{font-weight:bold}.myTable td:nth-child(1){width:104pt}.myTable td:nth-child(2){width:108pt}.myTable td:nth-child(3){width:99pt}.myTable td:nth-child(4){width:71pt}.myTable td:nth-child(5){width:95pt}.myTable p{margin:0;text-align:left}.myTable td:nth-child(3) p{padding-right:36pt}.myTable p{line-height:114%}.s1{font-weight:bold}.s8{font-weight:bold}.s9{font-weight:bold} @@media print {.hide-print {display: none !important;}} @@media print {.hide-print {display: none !important;}}</style>';
            var innerContents = document.getElementById(divId).innerHTML;
            var popupWinindow = window.open('', '_blank', 'width=600,height=700,scrollbars=no,menubar=no,toolbar=no,location=no,status=no,titlebar=no');
            popupWinindow.document.open();
            popupWinindow.document.write('<html><head><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">'+ css +'</ head > <body style="padding-left: 0 5% 0 5%;" onload="window.print()">' + innerContents + '</html>');
            popupWinindow.document.close();
        };
        //Initialize
        $scope.loadCustomers();
        // $scope.loadDocs();
    });
</script>
</html>
