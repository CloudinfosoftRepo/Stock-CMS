<html lang="en" ng-app="Stock-CMS">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Transmission Annexure D.DOCX</title>
    <style type="text/css">
      * {
        margin: 0;
        padding: 0;
        text-indent: 0;
      }
      .s1 {
        color: black;
        font-family: Arial, sans-serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: none;
        font-size: 12pt;
      }
      h1 {
        color: black;
        font-family: Arial, sans-serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: none;
        font-size: 12pt;
      }
      .s2 {
        color: black;
        font-family: Arial, sans-serif;
        font-style: normal;
        font-weight: bold;
        text-decoration: underline;
        font-size: 12pt;
      }
      .s3 {
        color: black;
        font-family: Arial, sans-serif;
        font-style: italic;
        font-weight: normal;
        text-decoration: none;
        font-size: 12pt;
      }
      .s4 {
        color: black;
        font-family: Arial, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: underline;
        font-size: 12pt;
      }
      p {
        color: black;
        font-family: Arial, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 12pt;
        margin: 0pt;
      }
      .s5 {
        color: black;
        font-family: "Times New Roman", serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: underline;
        font-size: 12pt;
      }
      .s6 {
        color: black;
        font-family: "Times New Roman", serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 12pt;
      }
      .s7 {
        color: black;
        font-family: Arial, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 8pt;
        vertical-align: 4pt;
      }
      .s8 {
        color: black;
        font-family: Arial, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 12pt;
      }
      .s9 {
        color: #d9d9d9;
        font-family: Arial, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 12pt;
      }
      .s10 {
        color: #d9d9d9;
        font-family: "Times New Roman", serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: underline;
        font-size: 12pt;
      }
      .s12 {
        color: #a6a6a6;
        font-family: Arial, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 12pt;
      }
      .s13 {
        color: #2e5395;
        font-family: Arial, sans-serif;
        font-style: italic;
        font-weight: normal;
        text-decoration: none;
        font-size: 12pt;
      }
      li {
        display: block;
      }
      #l1 {
        padding-left: 0pt;
      }
      #l1 > li > *:first-child:before {
        /* content: "□ "; */
        color: black;
        font-family: Arial, sans-serif;
        font-style: normal;
        font-weight: normal;
        text-decoration: none;
        font-size: 10pt;
      }
      table,
      tbody {
        vertical-align: top;
        overflow: visible;
      }

  .table-cell {
    width: 184pt;
  }
  .title-cell {
    font-weight: bold;
  }
  .number-cell {
    width: 35pt;
  }
table {
    border-collapse: collapse;
    margin-left: 5.5pt;
  }
  td {
    border: 1px solid #a6a8ab;
    padding-left: 4pt;
    padding-top: 1pt;
    text-align: left;
    vertical-align: top;
  }
  .title {
    padding-left: 20pt;
  }
  .subtitle {
    padding-left: 1pt;
  }
  .short-col {
    width: 35pt;
  }
  .wide-col {
    width: 184pt;
  }
  .name-col {
    width: 183pt;
  }
  .relation-col {
    width: 86pt;
  }
  .number-col {
    padding-left: 10pt;
  }
  .empty-cell {
    padding-left: 0pt;
  }


        .card {
            border-radius: 10px;
            overflow: hidden;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .form-select {
            width: 100%;
            padding: 0.75rem;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 1rem;
        }

        .btn-primary {
            width: 100%;
            padding: 12px 16px;
            text-transform: uppercase;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

            .btn-primary:hover {
                background-color: #0056b3;
                transform: scale(1.05);
            }

        .mybtn {
            background-color: #51b37f !important;
            color: white !important;
            width: auto !important;
        }

        .myarea {
            justify-content: center !important;
            display: flex !important;
            margin-top: 25px !important;
        }
    </style>
  </head>
<body style="padding: 5%;" ng-controller="FormController">
    <div class="row align-items-center">
        <!-- Arrow Icon aligned to the left -->
        <a class="col-md-1 text-start" style="font-size:35px;" ng-click="navtogenerateform()">
            <i class="bi bi-arrow-left"></i>
        </a>

        <!-- Centered Heading -->
        <div class="col-md-10 text-center">
            <h3>Transmission Annexure D</h3>
        </div>
    </div>
    <form name="gForm" ng-submit="genrateForm()">
        <div ng-if="hDiv" class="container my-5">
            <div class="card shadow-sm">
                <div class="card-body">
                    <form name="gForm" ng-submit="genrateForm()">
                        <h4 class="card-title text-center mb-4" style="color:#51b37f;">Generate Form</h4>

                        <div class="row">
                            <!-- Select Customer Dropdown -->
                            <div class="col-md-4 mb-3">
                                <div class="form-group">
                                    <label for="seletedId" class="form-label">Select Customer</label>
                                    <select class="form-select" id="seletedId" ng-options="f.id as f.name for f in docs" ng-model="seletedId" ng-change="loadCustomers(seletedId, heirId)">
                                        <option selected disabled value="">Select customer</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Select Heir Dropdown -->
                            <div class="col-md-4 mb-3" ng-show="legalheirlist">
                                <div class="form-group">
                                    <label for="heirId" class="form-label">Select Heir</label>
                                    <select class="form-select" id="heirId" ng-options="g.id as g.name for g in heir" ng-model="heirId" ng-change="loadCustomers(seletedId, heirId)">
                                        <option selected disabled value="">Select Heir</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Place of Submission -->
                            <div class="col-md-4 mb-3">
                                <div class="form-group">
                                    <label for="place" class="form-label">Place</label>
                                    <input type="text" ng-model="data.place" class="form-control" placeholder="Place">
                                </div>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="col-md-4 text-center m-2">
                            <button type="submit" ng-disabled="processdone" class="btn btn-primary" style="background-color:#51b37f; color:white; border-radius: 5px;">
                                Generate Form
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    <div id="printForm">
    <div
    class="textbox"
    style="
      border: 1pt solid #000000;
      display: block;
      min-height: 15pt;
    "
  >
    <p
      class="s1"
      style="padding: 0; text-indent: 0pt; text-align: center"
    >
      Annexure D
    </p>
  </div>
  
    <p style="padding-left: 370pt; text-indent: 0pt; text-align: left" />
    <p style="padding-top: 8pt; text-indent: 0pt; text-align: left"><br /></p>
    <h1 style="padding-left: 27pt; text-indent: 0pt; text-align: center">
      Individual Affidavits to be given by ALL the Legal Heirs OR Legal Heirs
      named in Succession Certificate*/ Probate of Will*/ Will*/ Letter of
      Administration*/ Legal Heirship Certificate*(or its equivalent
      certificate)*/Court Decree*
    </h1>
    <h1
      style="
        padding-top: 6pt;
        padding-left: 60pt;
        text-indent: 0pt;
        text-align: center;
      "
    >
      (For Transmission of securities on death of Sole Holder where <u>NO</u>
      <u>NOMINATION has been registered</u>)
    </h1>
    <p
      class="s3"
      style="
        padding-top: 13pt;
        padding-left: 26pt;
        text-indent: 0pt;
        text-align: center;
      "
    >
      Each Deponent (legal heir) shall sign separate Affidavits.
    </p>
    <p class="s4" style="text-indent: 0pt; text-align: center">
      (To be executed on a non-judicial stamp of appropriate value and
      Notarized)
    </p>
    <p
      style="
        padding-top: 8pt;
        padding-left: 40pt;
        text-indent: 0pt;
        text-align: justify;
        line-height: 1.4;
      "
    >
      I
      <span class="s5">{{data.customerName}} </span><span class="s6"> </span>{{data.relationWithDead}} of  <span class="s5">
        {{data.sonof}} </span
      >residing at
      <span class="s5"
        >{{data.address}}</span
      ><span class="s5">
         @* BIURSBUISB ESBVHRBSV WERBSARHBGKUYR RSHBKAUYER YRBSFYUEKA REYBUARKUB RBAYUF *@ </span
      >do hereby solemnly affirm and state on oath as follows.
    </p>
    <p style="padding-top: 1pt; text-indent: 0pt; text-align: left"><br /></p>
    <p style="text-indent: 0pt; text-align: left" />
    <p style="padding-left: 38pt; text-indent: 0pt; text-align: left">
                That Mr. /Mrs <span class="s5">@* Gema Traeg *@{{data.sonof}}</span>@@ (“the deceased holder”) held the following securities in his / her name as single holder:
    </p>
    
    <p style="padding-top: 1pt; text-indent: 0pt; text-align: left"><br /></p>
    <table style="border-collapse: collapse; margin-left: 5.5pt;" cellspacing="0">
      <tr style="height: 23pt;">
        <td class="table-cell">
          <p class="s1">Company Name</p>
        </td>
        <td class="table-cell">
          <p class="s1">Folio No.</p>
        </td>
        <td class="table-cell">
          <p class="s1">No. of securities held</p>
        </td>
      </tr>
      <tr style="height: 16pt;">
        <td class="table-cell">
                        <p class="s8">1) {{data.officename}}</p>
        </td> 
        <td class="table-cell">
                        <p>{{data.folioNo}}</p>
        </td>
        <td class="table-cell">
          <p>{{data.qty}}</p>
        </td>
      </tr>
      <!--<tr style="height: 16pt;">
        <td class="table-cell">
          <p class="s8">2) FWEF</p>
        </td>
        <td class="table-cell">
          <p>VVFVSVDS</p>
        </td>
        <td class="table-cell">
          <p>1564</p>
        </td>
      </tr>
      <tr style="height: 17pt;">
        <td class="table-cell">
          <p class="s8">3) FVSD</p>
        </td>
        <td class="table-cell">
          <p>MFNDF</p>
        </td>
        <td class="table-cell">
          <p>14856</p>
        </td>
                </tr>-->
    </table>
    
    <ul id="l1">
      <li data-list-text="□">
                    
        <p
          style="
            padding-top: 3pt;
            padding-left: 49pt;
            text-indent: -11pt;
            text-align: justify;
          "
        >
                        <span ng-if="isPrint" class="s8" ng-bind="radiochk.option1 ? '☑' : '☐'"></span>

                        <input ng-show="!isPrint" ng-disabled="isPrint" type="checkbox" ng-model="radiochk.option1" ng-change="radiocheck('option1')">
          That the aforesaid deceased holder died <i>intestate </i>leaving
          behind him/her, the following persons as the only surviving heirs as per the
          Succession Certificate/ Legal Heirship Certificate(or its equivalent
          certificate)/Court Decree dated
          <span class="s5">@* &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *@{{data.dateofdeath | date:'dd/MM/yyyy'}} </span><span class="s6"> </span>/ according to the Law of Intestate
          Succession by which he/she was governed at the time of his/her death
          and without registering any nominee. *
        </p>

        <p style="padding-top: 9pt; text-indent: 0pt; text-align: center">OR</p>
        <p style="padding-top: 2pt; text-indent: 0pt; text-align: left">
          <br />
        </p>
      </li>
      <li data-list-text="□">

                    <p style="padding-left: 49pt; text-indent: -11pt; text-align: justify">
                        <span ng-if="isPrint" class="s8" ng-bind="radiochk.option2 ? '☑' : '☐'"></span>

                        <input ng-show="!isPrint" ng-disabled="isPrint" type="checkbox" ng-model="radiochk.option2" ng-change="radiocheck('option2')">
          That the aforesaid deceased holder died leaving behind the following persons as the legatees as per the Will/ Probated Will/ Letter of
      Administration dated
      <span class="s5">@* &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *@{{data.dateofdeath | date:'dd/MM/yyyy'}} </span>and without registering any nominee. *
        </p>
      </li>
    </ul>

    <p style="padding-top: 1pt; text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 38pt; text-indent: 0pt; text-align: justify">
      A copy of the
      <b
        >Succession Certificate*/ Probate of Will*/ Will*/ Letter of
        Administration*/ Legal Heirship Certificate*(or its equivalent
        certificate)*/ Court Decree* </b
      >is attached herewith.
    </p>
    <p style="padding-top: 1pt; text-indent: 0pt; text-align: left"><br /></p>
    <table>
      <tr>
        <td class="name-col title">Name of the Legal Heir(s)</td>
        <td class="wide-col subtitle">Address and contact details</td>
        <td class="short-col">Age</td>
        <td class="relation-col">Relation with the Deceased</td>
      </tr>
      
      <!-- Row 1 -->
        <tr ng-repeat="tmp in heirlist">
                    <td class="name-col number-col">{{ $index + 1 }}) {{tmp.name}}</td>
                    <td class="wide-col empty-cell">{{tmp.addressAsPerAadhar}}</td>
                    <td class="short-col empty-cell">{{calculateAge(tmp.dob,tmp.dateOfDeath)}}</td>
                    <td class="relation-col empty-cell">{{tmp.relationWithDead}}</td>
      </tr>
    
      <!-- Row 2 
                <tr>
        <td class="name-col number-col">2) SZDX</td>
        <td class="wide-col empty-cell">FESFE</td>
        <td class="short-col empty-cell">15VES</td>
        <td class="relation-col empty-cell">1235</td>
                </tr>-->
    
      <!-- Row 3 
      <tr>
        <td class="name-col number-col">3) MHFGNDBD</td>
        <td class="wide-col empty-cell">FSEFSE</td>
        <td class="short-col empty-cell">V15E6SV</td>
        <td class="relation-col empty-cell">14523</td>
      </tr>-->
    
      <!-- Row 4 
      <tr>
        <td class="name-col number-col">4)</td>
        <td class="wide-col empty-cell"></td>
        <td class="short-col empty-cell"></td>
        <td class="relation-col empty-cell"></td>
                </tr>-->
    </table>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 5pt; text-indent: 0pt; text-align: left">
      That among the aforesaid legal heirs, Master/ Kum.<span class="s5">
                    @* RVYBUNHBBNJK JKBGHJ *@<u>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;</u>
                </span>aged <span class="s5"><u>&emsp;&emsp;&emsp;&emsp;</u> </span>years is a minor
                and is being represented by Mr./Ms. <span class="s5"><u>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;</u></span> being his / her
      father / mother / legal guardian.
    </p>
    <p style="text-indent: 0pt; text-align: left" />
  
    <p style="padding-top: 1pt; text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 18pt; text-indent: 0pt; text-align: center">
      Signature of the Deponent: <span style="color: #d9d9d9">X</span
      ><span class="s10">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
      >
    </p>
    
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <hr style="border: none; height: 2px; background-color: black;">   
    <p style="padding-top: 1pt; text-indent: 0pt; text-align: left"><br /></p>
    <p
      style="
        padding-left: 6pt;
        text-indent: 0pt;
        line-height: 1pt;
        text-align: left;
      "
    />
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p
      class="s2"
      style="padding-left: 33pt; text-indent: 0pt; text-align: center"
    >
      VERIFICATION
    </p>
    <p
      style="
        padding-top: 5pt;
        padding-left: 38pt;
        text-indent: 0pt;
        text-align: justify;
      "
    >
      I hereby solemnly affirm and state that what is stated herein above is
      true and correct and nothing has been concealed therein and that we I am
      competent to contract and entitled to rights and benefits of the
      abovementioned securities of the deceased.
    </p>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <h1 style="padding-left: 5pt; text-indent: 0pt; text-align: left">
      Solemnly affirmed at Signature of the Deponent:
      <span style="color: #d9d9d9">X</span
      ><span class="s10">
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span
      >
    </h1>
    <p style="text-indent: 0pt; text-align: left"><br /></p>
    <p style="text-indent: 0pt; text-align: left" />
    <h1 style="padding-left: 26pt; text-indent: 0pt; text-align: center">
      Signed before me
    </h1>
    <p style="padding-top: 1pt; text-indent: 0pt; text-align: left"><br /></p>
    <hr style="border: none; height: 2px; background-color: black;">
    <p style="padding-top: 1pt; text-indent: 0pt; text-align: left"><br /></p>
    <p style="padding-left: 38pt; text-indent: 0pt; text-align: left">
      Place:
      <span class="s5"
        >{{data.place}}</span
      >
    </p>
    <p
      style="
        padding-top: 2pt;
        padding-left: 38pt;
        text-indent: 0pt;
        text-align: left;
      "
    >
      Date :
                <span class="s5">@* 12/05/2025 {{data.today | date:'__/MM/yyyy'}}*@ <u>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;</u></span>
    </p>
    <p style="text-indent: 0pt; text-align: left" />
    <p
      class="s9"
      style="
        padding-top: 16pt;
        padding-left: 55pt;
        text-indent: 0pt;
        text-align: center;
      "
    >
      X
    </p>
    <p class="s12" style="text-indent: 0pt; text-align: right">
      Signature of Notary with Official Seal
    </p>
    <p class="s12" style="text-indent: 0pt; text-align: right">
      of Notary&amp; Regn. No.
    </p>
    <p
      class="s3"
      style="
        padding-top: 7pt;
        padding-left: 38pt;
        text-indent: 0pt;
        text-align: left;
      "
    >
      *
      <span style="color: #2e5395">strikeout whichever is not applicable</span>
    </p>
    <p style="padding-left: 38pt; text-indent: 0pt; text-align: left">
      # = <span class="s13">Name of the legal heir </span>@@ =
      <span class="s13">Name of the deceased security holder</span>
    </p>
    <p style="padding-left: 38pt; text-indent: 0pt; text-align: left">
      $ = <span class="s13">Name of the Guardian</span>
    </p>
 </div>
    </form>
    <div class="myarea">
        <button class="btn btn-store mybtn" ng-click="printDiv('printForm')">PRINT</button>
    </div>
  </body>
<script>
    angular.module('Stock-CMS', []).controller('FormController', function ($scope, $http,$timeout) {
        $scope.customers = [];
            $scope.data = undefined;
              $scope.hDiv = true;
              var params = new URLSearchParams(window.location.search);
              var id = params.get('id');
              var id2 = params.get('id2');
              $scope.isPrint = id2 ? true : false
              $scope.radiochk = {
                  option1: false,
                  option2: false
              }
        var isProcessing = false;
        $scope.processdone = false;

        // showLoader();

        $scope.radiocheck = function(val){
            if(val == 'option1'){
                $scope.radiochk.option2 = false;
            }
            else{
                $scope.radiochk.option1 = false;
            }

            $scope.loadCustomers();
        }



        // Load Customers
         $scope.loadCustomers = function (sid,hid) {
             if(id){
                 hideLoader();
                $scope.hDiv = true;
                $http.get('/Enquiry/GetStocksById/'+id).then(function (response) {
                    var result = response.data;
                    $http.get('/Form/GetHolderByStockId/' +  id).then(function (response) {
                        $scope.docs = response.data;
                        var doc = $scope.docs.find(x => x.id === sid);

                        $http.get('/LegalHeir/GetLegalHeir/' + doc.id).then(function (response) {
                            $scope.heirlist = response.data;
                            
                            var isDeceased = !!doc?.dateOfDeath;

                if (isDeceased) {
                    $scope.heirId = null;
    $scope.legalheirlist = isDeceased;
    document.getElementById('heirId').value = '';
                    $http.get('/LegalHeir/GetLegalHeir/' + doc.id).then(function (response) {
                        $scope.heir = response.data;
                        var heirs = response.data.find(x => x.id === hid); // `hid` needs to be in scope
                        var holder = heirs;

                        populateData(holder, result,$scope.heir,isDeceased,doc);
                    }, function (error) {
                        console.error('Error loading legal heir data:', error);
                        hideLoader();
                    });
                } else {
                    $scope.heirId = null;
    $scope.data = null;
    $scope.legalheirlist = isDeceased;
    document.getElementById('heirId').value = '';
                    var holder = doc;
                    populateData(holder, result,$scope.heir,isDeceased,doc);
                }

                                hideLoader();
                        }, function (error) {
                        console.error('Error loading Legal Heirs:', error);
                        hideLoader();
                        });
                    }, function (error) {
                    console.error('Error loading Docs:', error);
                    hideLoader();
                    });
                }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
                });
            }

            if(id2){
                 $scope.hDiv = false;
            $http.get('/Form/GetGenratedFormById/'+id2).then(function (response) {
                var result = response.data;
                var obj = JSON.parse(result.jsonString);
                $scope.data = {
                    docid: obj.docid,
                    customerName: obj.customerName,
                    relationWithDead: obj.relationWithDead,
                    sonof: obj.sonof,
                    address: obj.address,
                    officename: obj.officename,
                    folioNo: obj.folioNo,
                    qty: obj.qty,
                    selectedoptions: JSON.parse(obj.selectedoptions),
                    heirs: JSON.parse(obj.heirs),
                    dateofdeath: new Date(obj.dateofdeath),
                    place: obj.place,
                    today: new Date(obj.today),
					condition: obj.condition,
                };
                $scope.radiochk = $scope.data.selectedoptions;
                $scope.heirlist = $scope.data.heirs;
                id = result.stockId;
                checkData();
                hideLoader();
            }, function (error) {
                console.error('Error loading customers:', error);
                hideLoader();
            });
            }

            function populateData(holder, result, heirlist,isDeceased,doc) {
                $scope.data = {
                    docid: holder.id,
                    customerName :holder.nameAsPerPan,
                    relationWithDead: holder.relationWithDead,
                    sonof: doc.name,
                    address: holder.addressAsPerAadhar,
                    officename : result.companyName,
                    folioNo : result.folioNo,
                    qty: result.qty,
                    dateofdeath: doc.dateOfDeath,
                    place: $scope.data && $scope.data.place || 'Vadodara',
                    today: new Date(),
                    condition: isDeceased,
                };
            }
        };

    function checkData() {
        if ($scope.data !== undefined) {
            // Delay the printDiv execution until the next digest cycle
            $timeout(function() {
                $scope.printDiv('printForm');
            }, 0);  // 0 delay to ensure it runs after the view update
        } else {
            setTimeout(checkData, 1000); // Retry after 1000ms if data is not yet available
        }
    }

     $scope.navtogenerateform = function () {
        window.open('/Form/GenerateForm/'+id, '_self');
    };
        //Genrate Form
         $scope.genrateForm = function () {
             if(id){

                 if(!$scope.data.condition){
                     Swal.fire({
                         title: 'Error',
                         text: 'Customer is still Alive',
                         icon: 'error',
                         confirmButtonText: 'OK'
                     });
                     return;
                 }

                 $scope.processdone = true;
                  var arr = angular.copy($scope.heirlist);
                 $scope.data.heirs = JSON.stringify(arr,null,2);

                 var arr1 = angular.copy($scope.radiochk);
                 $scope.data.selectedoptions = JSON.stringify(arr1,null,2);

             let jsonString = JSON.stringify($scope.data, null, 2);
             var data ={
                 formName : 'Transmission Annexure D',
                 StockId : id,
                 url : `/Form/TransmissionAnnexureD?id2=`,
                 jsonString : jsonString,
                 ClientName: $scope.data.customerName,
                  ClientId: $scope.data.docid,
                 IsActive : true
             }

             const url = '/Form/GenrateForm';
                $http.post(url, data).then(function (response) {
                    if (response.data.success) {
                        Swal.fire({
                            title: 'Success',
                            text: response.data.message || 'Operation successful!',
                            icon: 'success',
                            confirmButtonText: 'OK'
                        });
                        $scope.processdone = false;
                        // $scope.loadCustomers();
                        window.open(response.data.data.url + response.data.data.id,'_self')
                    } else {
                       Swal.fire({
                         title: 'This Form is already Exits',
                         text: "do you want to go to that form?",
                         icon: 'warning',
                         showCancelButton: true,
                         confirmButtonText: 'Yes',
                         cancelButtonText: 'No'
                     }).then((result) => {
                         if (result.isConfirmed) {
                             window.open(response.data.message, '_self');
                         }
                 });
                 $scope.processdone = false;
                    }
                    isProcessing = false;
                }, function (error) {
                    Swal.fire({
                        title: 'Error',
                        text: 'An error occurred.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                    $scope.processdone = false;
                    isProcessing = false;
                });
            //console.log(dataString);
            }
         }

         $scope.calculateAge = function(dob, deathDate) {
        if (!dob) {
            return '';
        }

        var birthDate = new Date(dob);
        var currentDate = new Date();
        var age = currentDate.getFullYear() - birthDate.getFullYear();
        var m = currentDate.getMonth() - birthDate.getMonth();

        if (m < 0 || (m === 0 && currentDate.getDate() < birthDate.getDate())) {
            age--;
        }

        // If deathDate is provided, calculate age at the time of death
        if (deathDate) {
            var deathDateObj = new Date(deathDate);
            age = deathDateObj.getFullYear() - birthDate.getFullYear();
            var mDeath = deathDateObj.getMonth() - birthDate.getMonth();

            if (mDeath < 0 || (mDeath === 0 && deathDateObj.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
            // return age + ' (deceased)';
        }

        return age;
    };

        // Load Legal Heir
        // $scope.loadlegalheir = function () {
        //     $http.get('/LegalHeir/GetLegalHeir/' + docs.id).then(function (response) {
        //         $scope.heirlist = response.data;
        //         hideLoader();
        //     }, function (error) {
        //         console.error('Error loading Legal Heirs:', error);
        //         hideLoader();
        //     });
        // };

        // $scope.loadDocs = function () {
        //     if (true) {
        //         $http.get('/doc/getDocs/' + 1).then(function (response) {
        //             $scope.docs = response.data;
        //             hideLoader();
        //         }, function (error) {
        //             console.error('Error loading Docs:', error);
        //             hideLoader();
        //         });
        //     }
        // };

        //Function
        $scope.printDiv = function (divId) {
                        var css ='<style type="text/css">*{margin:0;padding:0;text-indent:0}.s1{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:bold;text-decoration:none;font-size:12pt}h1{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:bold;text-decoration:none;font-size:12pt}.s2{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:bold;text-decoration:underline;font-size:12pt}.s3{color:black;font-family:Arial,sans-serif;font-style:italic;font-weight:normal;text-decoration:none;font-size:12pt}.s4{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:underline;font-size:12pt}p{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:12pt;margin:0pt}.s5{color:black;font-family:"Times New Roman",serif;font-style:normal;font-weight:normal;text-decoration:underline;font-size:12pt}.s6{color:black;font-family:"Times New Roman",serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:12pt}.s7{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:8pt;vertical-align:4pt}.s8{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:12pt}.s9{color:#d9d9d9;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:12pt}.s10{color:#d9d9d9;font-family:"Times New Roman",serif;font-style:normal;font-weight:normal;text-decoration:underline;font-size:12pt}.s12{color:#a6a6a6;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:12pt}.s13{color:#2e5395;font-family:Arial,sans-serif;font-style:italic;font-weight:normal;text-decoration:none;font-size:12pt}li{display:block}#l1{padding-left:0pt}#l1>li>*:first-child:before{color:black;font-family:Arial,sans-serif;font-style:normal;font-weight:normal;text-decoration:none;font-size:10pt}table,tbody{vertical-align:top;overflow:visible}.table-cell{width:184pt}.title-cell{font-weight:bold}.number-cell{width:35pt}table{border-collapse:collapse;margin-left:5.5pt}td{border:1px solid #a6a8ab;padding-left:4pt;padding-top:1pt;text-align:left;vertical-align:top}.title{padding-left:20pt}.subtitle{padding-left:1pt}.short-col{width:35pt}.wide-col{width:184pt}.name-col{width:183pt}.relation-col{width:86pt}.number-col{padding-left:10pt}.empty-cell{padding-left:0pt}.ng-hide{display:none;}</style>';
            var innerContents = document.getElementById(divId).innerHTML;
            var popupWinindow = window.open('', '_blank', 'width=600,height=700,scrollbars=no,menubar=no,toolbar=no,location=no,status=no,titlebar=no');
            popupWinindow.document.open();
            popupWinindow.document.write('<html><head><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">' + css + '</ head > <body style="padding: 0 5% 0 5%;"onload="window.print()">' + innerContents + '</html>');
            popupWinindow.document.close();
        };
        //Initialize
        $scope.loadCustomers();
        // $scope.loadDocs();
    });
</script>
</html>
